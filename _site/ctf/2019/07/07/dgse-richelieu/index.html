<!DOCTYPE html>
<html lang="en-us">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      dgse - richelieu &middot; Adel ALLAM
    
  </title>

  
  <link rel="canonical" href="/ctf/2019/07/07/dgse-richelieu/">
  

  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
     <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox" >
<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div style="font-size: 2em;" class="sidebar-item">
    <p>Blog-notes</p>
  </div>

  <hr class="sidebar-separator">

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">home</a>

    <!-- categories links -->
    
      
        
          
        
      
        
          
        
      
        
      
        
          
            <a class="sidebar-nav-item-sub sidebar-nav-item" href="/category/ctf/">> ctf</a>
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item-sub sidebar-nav-item" href="/category/linux/">> linux</a>
          
        
      
        
          
            <a class="sidebar-nav-item-sub sidebar-nav-item" href="/category/network/">> network</a>
          
        
      
        
          
            <a class="sidebar-nav-item-sub sidebar-nav-item" href="/category/other/">> other</a>
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item-sub sidebar-nav-item" href="/category/reverse/">> reverse</a>
          
        
      

    
    
      
        
          
        
      
    
      
    
      
        
          
        
      
    
      
        
          
        
      
    
      
        
          
        
      
    
      
        
          
        
      
    
      
        
          
        
      
    
      
        
          
        
      
    
      
        
          
            <a class="sidebar-nav-item" href="/privacy/">privacy</a>
          
        
      
    
      
        
          
            <a class="sidebar-nav-item" href="/about/">about</a>
          
        
      
    

  </nav>


    <hr class="sidebar-separator">

    <div id="sidebar-icon-links">
    
  <a class="icon" title="Root-Me profil" aria-label="Root-Me profil" href="https://www.root-me.org/apges01" target="_blank">
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">  <image id="image0" width="32" height="32" x="0" y="0"
    href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAABGdBTUEAALGPC/xhBQAAACBjSFJN
AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAHdElN
RQfjCwkWHxp+T5UxAAADEklEQVRIx82UX0jdZRjHP7/D4XA4/BCRwyGGmIwlIhLDi00kLGLIGiEx
TCZBFzFG0P6ErCatEUO8iBhD1vAiYsgay5YXMqitM5HlRvRnKY5FFI0Fbph4YSZrk9P5dHGOZ3b8
qUE3PVfv+z7f5/u83/d53gf+owXrOX2ZBJfYwxfB1FqY+BqhGbaxnQbmuc8sQ55mkslg8V8SuItD
3CNLnhiT9HGCHMe474FgekNNpn3Xc9YBWONW8MOiZ4e/ud/YRgRn7LeiIMNRbxovEVR6w8/ds44E
U3QzzQAZF+kmwSkagpxYxSBJLnKJ4wybDz5ZK/tTZg3tc9S99pk2YQIc9G0HPO+YW8BWsyaiw2MO
2Qa+Ym9RxLB3C5pNO+CZIq7XV6MJHnPUNIBxMAbuN1skqHXCpuUSe7mAK3+DncxSbTUQ8yhVvhi8
b4KQBRvp50DwfQEWzJqjnmuF3cqiPM1waT3BFEvAx3RaTT8XgmsrkD+QZrV5wQSYBKtKZ3FH/crm
MuSInZFlJG8zh7zDHz7gCj8R8gYLHAm++0d4nBbORRE8oJ5NhJwPpsAORpjjbHCkLHuS18mxFCXh
oIeNmzFuyt1m7bfOVX/FNsfN+kwUQY1j1triXq87WOiE8uzu8KrtZt20fLZiHljBt/xIkst8xu0g
4pJ208VptpOmK8itfoMUX5LnNfJkyJWFxmnjKC18xDRV5EixsLoPZvmFu0EO2Mo71j3qeBs5wVla
AJjiOT4IFiKqEOS9TSUEee/Z/vuzDxv//DQ5zhIv8fyKNIssMfNoGz3SZoK5uVM3U03vPR6ywM4V
njusZ3a6r7jabNZxT5oxbo9/qQ+9YYcxU140sxZBh0Mmi+tKN5kEK03Y688edjOADU6YXosgaY9Z
S4qN2+4tt5X2lXb6tbvWExHzBcc8WLiHFb7lPtuLvtAhR6zbeKwmvG5r6Q5PLrezb3pydWtHsAVL
zIC1HgdCjhFaZw8Avwa5cnR0GZM0Uc9urxKyhVZq6PIbnuBWRLpIEX00kydknhghi8QImSdFb3CF
/539DagplOU/gNJHAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIwLTA1LTA3VDE5OjAzOjA2KzAyOjAw
95u+EQAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMS0wOVQyMTozMToyNiswMTowMBkgVUYAAAAA
SUVORK5CYII=" />
</svg>

  </a>
  


  <a class="icon" title="Github profil" aria-label="Github profil" href="https://github.com/AdelAlm" target="_blank">
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 28"><path d="M12 2c6.625 0 12 5.375 12 12 0 5.297-3.437 9.797-8.203 11.391-0.609 0.109-0.828-0.266-0.828-0.578 0-0.391 0.016-1.687 0.016-3.297 0-1.125-0.375-1.844-0.812-2.219 2.672-0.297 5.484-1.313 5.484-5.922 0-1.313-0.469-2.375-1.234-3.219 0.125-0.313 0.531-1.531-0.125-3.187-1-0.313-3.297 1.234-3.297 1.234-0.953-0.266-1.984-0.406-3-0.406s-2.047 0.141-3 0.406c0 0-2.297-1.547-3.297-1.234-0.656 1.656-0.25 2.875-0.125 3.187-0.766 0.844-1.234 1.906-1.234 3.219 0 4.594 2.797 5.625 5.469 5.922-0.344 0.313-0.656 0.844-0.766 1.609-0.688 0.313-2.438 0.844-3.484-1-0.656-1.141-1.844-1.234-1.844-1.234-1.172-0.016-0.078 0.734-0.078 0.734 0.781 0.359 1.328 1.75 1.328 1.75 0.703 2.141 4.047 1.422 4.047 1.422 0 1 0.016 1.937 0.016 2.234 0 0.313-0.219 0.688-0.828 0.578-4.766-1.594-8.203-6.094-8.203-11.391 0-6.625 5.375-12 12-12zM4.547 19.234c0.031-0.063-0.016-0.141-0.109-0.187-0.094-0.031-0.172-0.016-0.203 0.031-0.031 0.063 0.016 0.141 0.109 0.187 0.078 0.047 0.172 0.031 0.203-0.031zM5.031 19.766c0.063-0.047 0.047-0.156-0.031-0.25-0.078-0.078-0.187-0.109-0.25-0.047-0.063 0.047-0.047 0.156 0.031 0.25 0.078 0.078 0.187 0.109 0.25 0.047zM5.5 20.469c0.078-0.063 0.078-0.187 0-0.297-0.063-0.109-0.187-0.156-0.266-0.094-0.078 0.047-0.078 0.172 0 0.281s0.203 0.156 0.266 0.109zM6.156 21.125c0.063-0.063 0.031-0.203-0.063-0.297-0.109-0.109-0.25-0.125-0.313-0.047-0.078 0.063-0.047 0.203 0.063 0.297 0.109 0.109 0.25 0.125 0.313 0.047zM7.047 21.516c0.031-0.094-0.063-0.203-0.203-0.25-0.125-0.031-0.266 0.016-0.297 0.109s0.063 0.203 0.203 0.234c0.125 0.047 0.266 0 0.297-0.094zM8.031 21.594c0-0.109-0.125-0.187-0.266-0.172-0.141 0-0.25 0.078-0.25 0.172 0 0.109 0.109 0.187 0.266 0.172 0.141 0 0.25-0.078 0.25-0.172zM8.937 21.438c-0.016-0.094-0.141-0.156-0.281-0.141-0.141 0.031-0.234 0.125-0.219 0.234 0.016 0.094 0.141 0.156 0.281 0.125s0.234-0.125 0.219-0.219z"></path>
</svg>

  </a>



  <a class="icon" title="Linkedin profil" aria-label="Linkedin profil" href="https://www.linkedin.com/in/adel-allam/" target="_blank">
    <?xml version="1.0" encoding="iso-8859-1"?>
<!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="430.117px" height="430.118px" viewBox="0 0 430.117 430.118" style="enable-background:new 0 0 430.117 430.118;"
	 xml:space="preserve">
<g>
	<path id="LinkedIn__x28_alt_x29_" d="M398.355,0H31.782C14.229,0,0.002,13.793,0.002,30.817v368.471
		c0,17.025,14.232,30.83,31.78,30.83h366.573c17.549,0,31.76-13.814,31.76-30.83V30.817C430.115,13.798,415.904,0,398.355,0z
		 M130.4,360.038H65.413V165.845H130.4V360.038z M97.913,139.315h-0.437c-21.793,0-35.92-14.904-35.92-33.563
		c0-19.035,14.542-33.535,36.767-33.535c22.227,0,35.899,14.496,36.331,33.535C134.654,124.415,120.555,139.315,97.913,139.315z
		 M364.659,360.038h-64.966V256.138c0-26.107-9.413-43.921-32.907-43.921c-17.973,0-28.642,12.018-33.327,23.621
		c-1.736,4.144-2.166,9.94-2.166,15.728v108.468h-64.954c0,0,0.85-175.979,0-194.192h64.964v27.531
		c8.624-13.229,24.035-32.1,58.534-32.1c42.76,0,74.822,27.739,74.822,87.414V360.038z M230.883,193.99
		c0.111-0.182,0.266-0.401,0.42-0.614v0.614H230.883z"/>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
</svg>

  </a>



  <a class="icon" title="Twitter profil" aria-label="Twitter profil" href="https://twitter.com/apges01" target="_blank">
    <?xml version="1.0" encoding="iso-8859-1"?>
<!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="510px" height="510px" viewBox="0 0 510 510" style="enable-background:new 0 0 510 510;" xml:space="preserve">
<g>
	<g id="post-twitter">
		<path d="M459,0H51C22.95,0,0,22.95,0,51v408c0,28.05,22.95,51,51,51h408c28.05,0,51-22.95,51-51V51C510,22.95,487.05,0,459,0z
			 M400.35,186.15c-2.55,117.3-76.5,198.9-188.7,204C165.75,392.7,132.6,377.4,102,359.55c33.15,5.101,76.5-7.649,99.45-28.05
			c-33.15-2.55-53.55-20.4-63.75-48.45c10.2,2.55,20.4,0,28.05,0c-30.6-10.2-51-28.05-53.55-68.85c7.65,5.1,17.85,7.65,28.05,7.65
			c-22.95-12.75-38.25-61.2-20.4-91.8c33.15,35.7,73.95,66.3,140.25,71.4c-17.85-71.4,79.051-109.65,117.301-61.2
			c17.85-2.55,30.6-10.2,43.35-15.3c-5.1,17.85-15.3,28.05-28.05,38.25c12.75-2.55,25.5-5.1,35.7-10.2
			C425.85,165.75,413.1,175.95,400.35,186.15z"/>
	</g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
</svg>

  </a>



  <a class="icon" title="Cryptis" aria-label="Cryptis" href="http://teamcryptis.fr/" target="_blank">
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="467px" height="484px" viewBox="0 0 467 484" enable-background="new 0 0 467 484" xml:space="preserve">  <image id="image0" width="467" height="484" x="0" y="0"
    xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdMAAAHkCAMAAABSXzWKAAAABGdBTUEAALGPC/xhBQAAACBjSFJN
AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAY1BMVEUAAAD/////////////
///////////////////////////////////////////////7x3j8x3j7x3j7yHf8x3j8yHf/x3j8
x3j8x3j9xnn9yHf8yHf8xnn/v4D6xXr////8x3jKFOSNAAAAH3RSTlMAIEBwgI+/799QEK8wn89g
QGCAj7+vIN+fcM/vUBAwb4xV9gAAAAFiS0dEAf8CLd4AAAAHdElNRQfjDB8AOw3TjfrBAAAfs0lE
QVR42u1d62KyuhJVRPAOtfZi+1n7/k/5qa2FQICZyYRMYtavs/c+VsNiJmsumUwmERERERERERER
EREREREREREREREREREREREREREREREREREREREREREREREREREREQFhmiSzNJ1nF+TnNhbX/5Cm
6TJJVq5/akQ/VsnySuQZhUW2TtNk4/q3RzSxWaZbJJdtbudpMnW9kIjJ1TbT9c6MTQXZfJa4XtMD
40rngpHOCrvtLDrj0TEttpzWqbXYdBkV1Fi48GnHPDUGO4+8WsdqPD4rXuMGaw+b1La/7UC+LqIi
toDlNjcnx8Rc0yibOLEq1k75/MViHmnlgRBCI61sWG5d09imNe6tBtjM3e6hXdjNYoRDwmrmSOWC
sF26fj7+IRHnc5tYpNEHI7CajZ1YoGEbsxFATB1HohgsirizDiMxrIOOjTy64AEUfjhdFdvIaidW
qY+MXpHFjVWLVerPNhpZhcBvRiOrbfjPaGRVRRiMRlZrSHxVRlpWY93mgtQ1DcyIkc1EfF4Xj/TB
c0sBUno+5zPXj9UlQnO8d+weVywlrp+9PawfdFtdhaR4m8hT14/XCUL1vL94RAe8CiXV0In5wyng
wM30ivzR2pZC3k3/sH4oU924ftzj4KFMdeb6aY+FBzLVIFNIWjyOqXrWTGaERxHAdp/iLsvmaTpL
brh/5eb2T0Waphl25o7pz3mMGpyVZ5dn6wuRwAc4vQ1UGkl+P0Ren/mZLbK0IM4l2yx5B/Lo8QhS
iZHOdcowZS6ZWZ7lsgjf//I8QOaRN0m6tpixDN7/mouULLWSJd/MrPEauv81S/cu5laDvs3Mji4O
XP8uDV732QgV55WVUS+B5x+IT2w94vnAzZw/0gm6Vk5JDo5J6A/4aQ15U0V3I2WOTvAmzE54F3Cv
EkqGuJ2fwDukKQ9XKSEqqO5HJ0w5T8fmhevlWMMcaqJ4n7up7jnIsp/0xuLnH+ZpmiakCfhLRmMN
l1RILilDLR9xz8HuQu8SZ/9TvilcW9fP3haGWwe3YINKipRUY1lk8wLOLN+cn2BJ3fSSmgMPiTGk
33db8OUGBVOqfxdqTLPpfkA5ZBtdLed8WTzorHSmgT/BkrrqEB4QRpdz/uoYjFceVoMldbLU7FDD
jNrKst+eNWCoNgurAQeqzVFXg4wmFvKwKhbDkz85WA2Y1Mkm/XtAu6GnOdZo/HyQVoaxayGTOrld
hzicC9iMOmFykNaZ8a8JnNRBsObnoM+8fwT+CpgLi6RqUbjq8t711oOmpj/rYUllzMpRHntvOmtp
6D0ek9Sl+4MYu56088rwKO3jkboSMtW3L8LamCU/HoxUSdMI+/LPZgp4EWxGqY2pIEZv6GbVTCuF
myZsPiaJZ1S7WTUy1ccg1Tz0G5vVqcmumrl+3iMwKs3rglg1EcDBFsnvME+62UWXBt4YaPS564du
FaZR/AjoGv65MmhEC7fxbLJxn2GAYNHR7FLQXUyoh2nESqM2Mv22Sve/geYeDN5yB9AfaKL73xBz
D8ZFjrHR4YDJ+nfnmgF2+DhWcqs1rSXV3QQW0Rgmwl1Bf0yYvJigdJKPRvoD7YnSFXEbycPZUj01
0l8etMZFzFYHk3rwfUqodqIgcVFhGCrVTwmCdqJKQfpTQUx8SLyKSbugSxZuKCtbuOaDAf6KIxU6
qUQi1ft5DwH43Tt0EwUpiULfc/mkF1ksNGys8ILec+VbuGaBGZo0EJ5Uv1seJDYcmUHTV4Qm1WdO
CW5JPjT1Muw6PebUpM9DMDTDj5Ck+sup9ah0kWXb9DYN6Rez9DYyybp3aEeqOFK95bSwyOU8Tfqn
qCSJ1dsN2koJRaqvnNpJNCBG4tyonTFObVFIbSklDKmeJgf5BW++RtFZYTNb81tsW/4irgb1M+fA
TOmFT7PurGnBPQO/TSo8u+JjbpA3HbiY8wwN3fBOW2pP6YWS6mNPEmdYujM0UBXTGeNPaweqwCnU
HrpePkptzGlmpLVNagH6mH81cS5Kc2tzmjdcsyPapELUvn+ql4nSnd3Z+EwzXtqkDotD/9q2eSgd
YZT6lGW4VpvUwfU7nxKPBQel+Ui3Haw4Jmy1SF0N/FH/PK85paCpvlxgmPjSilP7Ixr/2vCNUw2j
MnqFOasoUh+P0tEZvcKY1Tapnd7KP8dreLDUCaNXmM4hWDf/YMcR29w7eWRaXAPed2ADprPn2h5V
N8/Z1StrAIO7MS/I3L7DU7PrgjQ+NVH/IuVeJOcw6vlE3oVVlk/7/fNBwct+vy/LV/LvT4y2Vd3v
v165cXsouzVg/r5AIKqHbWyh7/CFy5fDdy/eDu97GrVGDthL0vphkmtYgNxueXz/+Abj8/D8D02s
yWAC/zJ+gzCIYubDT6PcH+B01kz2/QnJq4EC9ry3XvMs7Bnp69PLJ4XQO6/P/zALMTBVH5sXeoC+
kfgPAzvp6xHhbzv98DuGVvKu6l+KqA9TqsfKe+dVnJ4YCL3TWoJXQ+40D8pQqfqo997t8p2L0F8n
fDwBl0OdaDUD/n0fQE0J9qiK09MbL6M3vH8BV0STB752YmtAzB/1pBlOexNV1IcDcGelJVBcM8EG
4ma66AzSX5mdbsMFP4FWRYq3/UvRd4C2mXZOh7fLKIJVQsQdyoQymvTv0v32vG4dHyVkZfhN1b/q
qBa0yLRr8ccxGL3iAMkvFY/J6VBDlR4d6qhkC0cBeAZENlilFAanlDCmQ/CerG+kKj4BEhhJahCc
Ujxvx/jwf2O53QoAB4y7UCYE3UvxvHpKT6S6i7GpHoeXiCE1hBoqwfPqKXVgpL+mOrirYkh1zQcD
CJ5XS+nYO6liqoO7KpzUEHKD+GyDltIvG6ldOJ7ZSA0gh4/PNmgpfXLK6AUfQ1IJSqr/3Sv4PK+O
Upd+947PcohU0FIDqInji4yadOhpzDRDN4b0LyhO9b8kjhdImlTDlyu928S7OakB9JihQ1ONgniS
QullUx0IagaLxAH0gqKLFprdxrk6UkgdUEpF//ICuFwP3XWvid0EqKM6PgcaW/rrqR6Ox2kCm0HS
lMCFUWpGagCUTpGUajyTOEqHY5rO/SYPocEB29fRXrNASi8Y6GrpOPqW+R/F4M20XVeUSen390D2
d5W2dQTymKVUIM+UtPWRVEqHttT2/B3Lo7lGAzLd0B6v5y+lV2zS3wHeu/UsBK97A9JMW9V/vykN
EkgzbeXMIqXygDPT1vzho2vuIqUtIEVvMzIVlRCMlP4AF5s2w5gv19xFStvAmWnT84oprkVKa8Bl
ehueV0gJPFKqAFeQaXreF9fkRUo1QNVNm/dm712TFynVAdXe0Mg2lK7Ji5TqgDrn3xiBepKpj/SU
bmbb7IptGsIhmF5gmgXzRjLUyZEYEqUb5foDe3eiiAAqkGkIJPb80dvhsP/D+4H2ymgo3bQTZY4H
0VoFpvW+UY7hTDa8vegnf5ZPz0hm25R2jMheh1FS0wCjkBqlYq7IdHAuJGbeZJvSzlH2C/8bA7XA
KKRGHMMTxrw9gzTq6QkWCGso7Q6/A+lnaAKjkNQn8MrBKGJm4OR0HD4th6L0HM6onDpWCEobiV5z
zfu5h44LvKMcMNY2pQPHugLoy26hQHCqCkXjAhtwTlUDvfOzNIp36ExiAOcnsEvuNFPTbAPeRu94
7XQQGkqHVb0n55ymxTzL8vMuG7xbAROcqrvpsxmlkFFGnSj1+6qGUsiBWh96ygrF9vLea3sQ6XtV
9JoJJNgguR7oJLcuewQp9ssf2VC038yennKE61XN1KjCtjdf5lcrNtZRCqsiCk8odYTXXcO4EK43
Vz5YGjD6xlMzaZiqNm1fgJYm21A719AxhhXhetXXwiCOeTHZSeso6ypNX4kBBt+S45meHhR9GgzR
Aqq8FAZmOjxmDIzXjwFKJ8C1CZ7E0dtWlGs2VUTCQV022UwhQx7h+Bvw0kEpuBNdrPQt+n+3xv0W
kPX+QNERZDNlbz947/2z4PVJNdQN/ofD23rVQIZqpoOTqPB46ntTwGXEXGgyaTgsaeWr4f2CyoAV
amw6NAeFhKce44eXhmWOoAP4mWbL36BlV1DeY+KBJyuUTib/uv05nNMF4gvHA6S03agWwpesdJad
RFHaB0QLh8SaG8BMW28jPJJRXgZaE9Ln+JRiOF2bfxs7YNG1GqSCF6zmkEhjXJ003GJO1cpTScBI
U6krwVesKOaSZKali6eCqTrJU0nAriKlBAr3TMpmQ1JIpPK3ORD9czvzb2MGlJ/6Z8DbqeJ6SbXw
oRGdtoA5VysulwTlp54OAq9W0Q+UlpUPV48FEa3J63eA1kFrnMLXq6heQuH0kz99BAXC+YoLUaE/
vMYpvM5Wl4SU4JSxFINFgTBUYRU3sM3VOAXvNYp6ILjeg8sngzBUYcoXHJbUOAW3rSjVcLzqdeh5
JyhDFaZ8wWFJjVPwWpUyG171MjQfmQBhqLLSDuAhG9XPhmcc6l+EP8n25vjRIAxV1uEZaChTizTB
EknpwMIfeypdPxu4ocqqjEP3xho/YImkbKfoajhNIH0d94fD4fnIkST2teBGeBPBWSRlOx3DTF/3
VZXg89lYYSGarkRFMwSbAy+0/j2lfTM9Nd270SmMK+AJQknRDFjvVMl4cMlCUfjo7RTdJtjurzfu
8Yafmpa0oRLCU/BHlDQodjtFi17t7MJPw6oOWCVJ2lDBGpbwEUXgY6NTbFawaxxlafR44OMUBUWo
YGlH+EhdIqEbBpFbYWcdzywXBa9WCDoNBSWotjeCZW/9e/4hKcWWTbtrPmY5Y7DzTY2+hhVQgjL8
R4wkElIhlT1/ymhLBStfQZ1mUIJquo60SmTt9BO5jD4FZpRiBCtfQSIJyikhPFW8EXLG1QtuFf27
tUlAA087uGbShCBwKKPIXqTrRfrLfs/+bPKAwHVFOSIJ/4spBVe07EWK1f7g16inCRzNyCnN4Akq
oB+pR2wljlIsCwPBr8kDAm+oYoQveLuoOCVEtOi+FWwkw2v1tCckRviCHWlldISIFh3KYMOPgT9X
mjwiaIQqZlwHmNPqI9DJkcoakWOusErVJqeEpgHvOCVEtOgMPnYZA3/OqORG2mtcwiKnBk0OaKFq
USPRNKFLQDmtZUmgAZtBygGdorUYy9BiN5eA1s1qmyN0iQYpB3QPaP9ZZaOcAyU0cAvoZkHg1KAZ
Cc2pvdwgYsFSZgDI5BQ/3arP+Zoe0ICOmJGSdJDJaYleR8n611SQRKFDWOS03h2JPNJGYKE7AEaW
eNqInP6h/jUlnE/iBth5lar50JbwOSVEtGhOKSvp6DFjGNoCrcxETrk57egFZThiAX1GUpL4AXE6
ObXFL8vkScL+5BQhcTqZHFVT/eQ5vxo5dclpo5ONaXJA5JSDU/ImeIicjsYpsh2ppC7HKadSjkHh
OQWfalO+x2dOoW3b/sYy4JyDUk70mVPfcg5QT1prLoJyOmZd5o7I6YS0O0ZOI6c34IYxk9PuVjiF
LvjROMX1I5HJcMqplD4HAqfQErEytcJy36D+a3g4pQxkdApwZFL9YNL2gpw1SE3T2uDUux4zgmMh
cYrsw6dezWaDU+/6ey1yqqTKkJeQUDv9bHAKPinujMMmoD+42h2ha1Q4LXGcUjtybXAKfYflHBTH
d2BDfZGyRuxQUGLDiQ1OoW+9lBQ+/C2s5lfR9hckp8QN1QKnYNkrJYVP2R3Bh2yVGzqQN0ARbyCx
wGkBXa6UlANld6Rpe2SASpyVYoFTsESS0oYP96TV6UpwSKskHbDzkWhlcQucgodeyZn2StgdoZ9Q
RkjanmP2A35O4fe2uWRRBdiTVq8hNDmoCEGs8MUOvfoBP6fggZmCrq4g7I60w/BITmkT5fg5hU46
ECR74b6lknVg1aB0OmDn95IIYecUPsZMjuyl7I6kWa/4OdsUlcTOaQHmVEwGf0IZFQNep/LqYkUS
SSWxcwp2vYIkEiWdCd6CDa+HJxTcuDmFu15BEolUdoB+Qs1qIyeDkgxVdfBmcxyuKMCciroClbA7
gsNwJTuIHHtF2lHViKk0fjjgoaCCJkhOEOnb6leDh6cr6TL0hkrxnS9mH28AcVexqOunCTeLgE1b
dUhoTgnVmdpxcYaLNuFXBonaTin1wYK2UvzV02/4MurfIdQPhtPE0IyZsO0U8cP/PgF3SUrWgXBP
MUXlPL18fn++GN4VdAP8FihBRZkbwLtjtWXQloq+Yubb8XWZ8AuDREWnmF9OEElqEhQdzZC8Lx/A
yxQzyuEOcOWh2jPAr4EaoSKbB28wnm5kAPh2KiqSmSCEL6F9RS0U41NJ3/h72xgBXqWYMa93EG5Q
gReK1WtB8cr323gCpAHAq5TmehFpIUImSY1mCMqXJc4kAsypNNeLkAKV0cHLFWp+BXth5g0frnQS
eJHSXC8iLVS5GLCuajhffM7XJalQjSTP9cIVT9WMAs86qM6XEqJ+k7t9TQF1YMISDlfAFQ++z6zp
fEkqyRqpX/0OABiyibmEpA4wQfiDUE3nW9I4tUPq12e/Vwc6MGG53h+ARVK1cRRgThvHvQi5pB9S
+ffU6yDRflJhL7uoMtsdYJFEiVAb/emkcOYKdqH0NPxnQd5Iznm2OsCZpFqECu8AaDS+Ig9D1Ujl
jVOPgHcFJAUFKqQJJpNESPmeczV6Ixvq92fJuOZqwEQfqYBdSaaZIoyO0DzYyrKQDZUx9/ta39Z7
SAVsMZL6euuAG12lB+DRTKOvg26o398vPJvqPzWf1UPqoNQQKXqvgNdZKNFM81WmSl8u/3tqZbN6
SB3wvjt5acFfwFUspd7WVEmlAaff38+mplpqnH83qavefSkXSymizlJLV8M5bUZwxGTS3VSNWo1O
+ulbNFJzOeeI24BvqJXggddmmpsOMev7h0NJZnTfVRnqIbXT/cp1vFfAHSklldRyUegzbkysPvVo
brxQEiuPfgCPUGvOF658m4czTwbxDJnV077/W/tCGo2pZlKDmD9QDoYglG/TUEtjTi8cPGHU0tf7
YD2+L/mQNBa7Fs8oJuVLUr6tU9RmMumOd+Dhi9cjKH7qzf2ulvNfa822heiN9A5EWqgSsXC13DLU
E6mLpY3Pl6ehNHD5DA6InXXJ2AF8c6zSDog+9Zah4k+5deLt/VjqyXj9t8eNkQiLVPjmWOV8EQW3
dnROa03qNtjD+37/r7zjuN8fKPmqoEgt4PRUgTZcWbVnzTBoXxsIiVRENFOxg3gR2u0A2ClYkVQ0
4Ad+Kje6QoSo7UIj5fhMJBUDeMtuLUTFqKR2pRF58UEkFQuE4NlRPqQZLn4yqbpFUgFACJ5KJcE9
9lkzvu2LKUqNpHYA4XwrlYTIVZw1XZOla/YCJxXjR6tgE5FL0vVjmTSyRFKHgXC+lRctUIY6a32p
UJ0UCqkI51uTO5hwRtfrEUm1CYzzrcIZeEXnCs2xPqHiNxBSESK2MlRU3kHnfaVGNGGQWiC4qRII
OEPN2yeGIqkWgTG5jPSps3YyXyTVIhDdKGRD1Q2OF0uqw0E+XMBkEMiGqjthIpRURzMHeIHJIJAN
VbOlyiSVYw6le2DYoRuqbtitQFLDoBRXZyEbqvZ+HXGkBkIp6sBEPXuLyvqeOwZ/icoosR5gdgtU
naUy1ALJqf4SQua2MyNK3U055AfG4mr7IqqOeu46ESamShNCYFoBkcivu1BcHfXcdSaslFEktzC4
xyVQGrZWnsGkK5pGXsOrBKW0d00CN1DkVDmhKTKe6bpc8uRcKQWkjv7IwfBSq4di45nOG0Of3Ppf
5jFMMoAJZ+q8YOOZTlK/XPrf4PzuDTi5kxA/d0PHfOqTs6DmrXT99C0BcwqmnnhAy6TuoeOlm8M0
gendGgoULVXjAjbt20eqC1MN1kivQO2MNZmEOTg+ROr4pmo8eEk0cIZaUzooefWL7ukl+zEF8CGk
ZKAOOAlbySSK9+1Svxe8jharms3R8gI4Q12Yed8eUicl7ug+ldF90G73FzhDrblPivc9Zz1jTEZg
NeyN9A84QzX1vv1D3iyz+h5i3kgLnKHWvC8h83AeGsZoj9XH8Lq/QBpqzfuijo5XpPZfefZlRS29
HR+I0Qk6e1vr70SloSqk/b/ndOSOV1/wN9B7DqSh1rwvvur2g/XQwLdyeGQgGB/Hh9lGa0Aaau3A
Gimgub4XwxOOn1jmFL49u0owrJbpOrtiO3MxzhkrdmobIm1LPesOvbVw+mdorR9HZxmjpRLpLebj
XyCFbBurS1dsx9kfBv3vDV9HohB+e0fNh+VF0fZ827FZhd+H+YNagxEtSr29GdC5uOXxBSeaDs//
XG6hU/17npr/ZRSw9dBajm9DJvU8h8/GPZXH58OwJ/542f9znaEvuh5INu4oYLSArW2pBZnT8wI7
wvqrPO6fD4cGux+Hw8t1UqgEfbvq6bAFKENOYNvG6lsqWSfhTNUP9Hq8fNxNFds2Vs/bkrL592XK
vKuQioE++HGvNEFHmrUodUXMJ/0gE3lRLA2DUeG4d8yjg5Kajlvhm0PrCMYBA2TJqG4J1cB9Q00n
GYjfK3JABsIDQPzVwvxrEEB319d1kiGp50VB/+FiANIV4y4U7UDr4+cKM04v8sGDq3n6AQvyxzVU
fI17x0nqOfNbAkMfwLjvLr67vj7R1ZxUrz0wePnj3udHyN3WGwEZSD0vZp5qYHjKfGf+ZRgQyqH1
t46D1HM+egWDAxiNOPJPI2SE6u7SJEtYQ+adC0bly0cWg6Znm1AjInqQbyVf9dx+bKhE2tgC3/Rs
U8FE6rU3wBtakbnR0b0QJR9ff/h8pHpDKzbdPXZxnJS6zW2ReqF1u5QuhNEVjPGTK5TueoukXrCb
J4J5xRelHCTMKOJVIdU096vntcD74VVyheXHhW+ycxGrUaqh1km9IpvPgBa7Sop5dv8VC5uXguNz
b7kDSmmUKF2AU6Mi+RCzWZomid5qp0mSpuustQBbiQxKN8C4ZfE7CtKzrkv0FbntF8eugv7/s43C
O6nBw1GtmDAqp0Eq8U/YBLif2C6lZ0d6j9hgpJBauOawDWYLoT2lrfkX00BUOUoZKbGklAzA+jyJ
L767CkXB8NCsKiUaGFM4xNfemZlOyPuhcn5gJW9TZWulIFKaO82eEI1sp/iWwjWHrWfK5PoK4sbi
tumKemBNncGxMev85QdPdEitKY6evm8Ae4Dxj1RF/orzvxyWQl2Ty830BwX1saldVFQ3ZQkZ8WlU
IB8lGfe0jB7kVhT1pOV0lKQSGKY7KjmbPfKptg6QD6w1TlriB+hbhGHmoSB/sYwCP/3AWmOw1UZQ
qGrkfA3kgZTGOeoApAu26uYhyFRNngf93XQteSsYlEJ3qq+Rs6vSle/S4BV3zWR9GfRn1zyBOBMi
gKm5JJOwbOTm+wEUBk+vMQNJSKxK9IImmkBCFFOHyU7YrFkmErQSjVOjxyCMUsPydrO9QEAGgsKp
kRrIZUQxfKQ2ZyCtUtesEgJUIykgkVKzYTltU5063lbRutdQsss8AG82LOe8aCrNqdlLYghsis4w
tJaSa2Am9bxuPsfEXbSK7K81lXVSKTUntT0txxmrqAqqcfgll1JzUjVzVRI3+yrmKRunSSRTykBq
2wE7UUuIWNE8mpZNKQepedp6nuNHNuDolEHISaeUg1Tt3TLFqLklqJmuGApJ8illIVU7AmmzHc9Y
YQkHFvfhA6U8pGqH0K3GMlZYQZwlgekHpVyVlUyXWZnOR2gbBXneguWH+ELphOu8mpbVyWZu2QcD
Mq8rHkZl5njtkto1WnBp01qHHzSXDPeLUr65Vl2jBTeppb11N/Sgp1x+YuQLKhhQcD3kvOvKq2mx
5vfCQwfF+dJa0roaIDBotWpi3VmI2sxYec0GKl6Mwnvku4GYwDlYpW+662a25VEs235G2ZzuFZI6
BDFgCVSrp9DXybdK0rXJty3WaT+hzLGxnD5eNKm8Ve3ByYJJgWd2l6XFYI/BkjeHlXsUlrbBNKu3
YmA23H+wSpZpmmX9/niRZfMLmZBuBvaA2LcYpomCmVQYrb+4jZ1LVVz/FaIvZcMfCvsoeBsPxcpc
wXHedGaX+4Ot95RyK6U7cpvjAa+4REk2frerAWXc4N5U79jNLd01My14oiPNqyiz5ZMAi2312Zx5
HPPGGp9nXxMNHQ/KauFzsZ2xvP7TZZpZrfmMexGQbdg/rLZbp0v6KIRLZGuXznNwF/NOxjrWdGF2
hglVJpdYZ56NMp4ppFt57xhzsGB+zSiknZHo5T8UabrNxuxb8zcb2Atn0xp2fxOZXQ1M869WCkUi
bQbdWAghz9CFla1QVTTCE0cqGCvlvmAdsJH+gLn+Jh6hG+kPHmpXDd9If/A4u+riIYz0ByKm5diH
jdtqBMP5XBX7yIKNSbvgdgKHfeSBFEpxCForPZjbrSBlXiQ7Hs/tVghTAT+S2tUhvG31MTdSFQ4H
W9lgNH3UjVTFMhyxZOlWXB/Bc+zaOSKjCgJgNTLaguesRka1GHeuVWR0HPipgaPW7cdGxq0VCCws
H9wJAVOvSjbZg+eMwPBlY83jNorAmAMjqdhFp4vEaAMjaci3D1x6MYD1yYJkZNFE6VgKlMEL+ECJ
CC1Whahq3OA8nwgQxNAaCeXEysa8SBzGGvbyULA6tXcA67iH2sLU0oCbAQONuSLLSNIRE/2LbREN
dBwk9idqXOwz8jk2NrOttUxTnqVJzCo4QjLbMnviRWYykyeCCZtlumZgdpHNZ9E6RWGazC7UUrbZ
XTZPk2AGAYaI6XVk7zzLsiEis3WaFpFL7zBNflGk6ez+vyONERERERERERERERERERERERERERER
EREREREREREREREREREREY+L/wv0K1CECEj0AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTEyLTMx
VDAwOjU5OjEzKzAzOjAwWobYyAAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMi0zMVQwMDo1OTox
MyswMzowMCvbYHQAAAAASUVORK5CYII=" />
</svg>

  </a>






</div>






  <div class="sidebar-item">
    <p style="font-size: 0.9em;">
      2018 - 2020 &copy; Adel ALLAM.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Adel ALLAM</a>
            <small>@apges01</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">dgse - richelieu</h1>
  <span class="post-date">07 Jul 2019</span>
  <!--more-->

<hr />
<h2 id="arrivé-sur-la-page-daccueil">Arrivé sur la page d’accueil</h2>
<hr />

<p>On arrive sur une <a href="https://www.challengecybersec.fr/">page</a> avec un compteur indiquant le nombre de jours restants avant la fin du challenge. Cependant, aucune information explicite sur le challenge à résoudre.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"fr"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width,initial-scale=1,shrink-to-fit=no"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"theme-color"</span> <span class="na">content=</span><span class="s">"#000000"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"manifest"</span> <span class="na">href=</span><span class="s">"manifest.json"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Challenge Richelieu<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"static/css/main.ba9d9d7d.chunk.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;noscript&gt;</span>Vous devez activer JavaScript pour utiliser l'application.<span class="nt">&lt;/noscript&gt;</span>			<span class="nt">&lt;script&gt;</span><span class="kd">let</span> <span class="nx">login</span> <span class="o">=</span> <span class="s2">"rien"</span><span class="p">;</span>
        <span class="kd">let</span> <span class="nx">password</span> <span class="o">=</span> <span class="s2">"nothing"</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">login</span> <span class="o">===</span> <span class="nx">password</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="o">=</span><span class="s2">"./Richelieu.pdf"</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>Après un petit tour par le code source du site, on peut vois l’existence d’un <code class="highlighter-rouge">./Richelieu.pdf</code> dans l’arborescence du site.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>wget https://www.challengecybersec.fr/Richelieu.pdf
</code></pre></div></div>

<p>Ce fichier est un PDF assez volumineux avec plus de <strong>9 Mo.</strong></p>

<hr />
<h2 id="pdf">PDF</h2>
<hr />

<p>Composé d’un grand nombre de page (<strong>364</strong>). Cependant, il n’y a du texte (visible) que sur la première page. On se demande alors quelle est l’utilité de toutes les autres pages. On remarque avec notre souris que du texte écrit en très petite police occupe toutes les pages blanches. Il faudrait donc extraire tout le texte de ce PDF.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pdftotext Richelieu.pdf text_extracted.txt
</code></pre></div></div>

<p>Nous allons donc extraire tout le texte du fichier <code class="highlighter-rouge">Richelieu.pdf</code> vers <code class="highlighter-rouge">text_extracted.txt</code> en utilisant <code class="highlighter-rouge">pdftotext</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>text_extracted.txt
Richelieu
L’histoire de la cryptologie serait incomplète sans citer Richelieu qui, dès
1624, sut recruter les meilleurs spécialistes en mathématiques. Il a ainsi pu
fonder, par la suite, ce qui est considéré aujourd’hui comme l<span class="s1">'un des tout
premiers bureaux du chiffre en Europe.
Lors du siège de La Rochelle (1627-1628), la cryptanalyse des messages des
Huguenots lui permit d’anticiper l’arrivée des Anglais venus aider ces derniers
par la mer. En octobre 1628, la ville finira par capituler sans condition.
/9j/2wBDADIiJSwlHzIsKSw4NTI7S31RS0VFS5ltc1p9tZ++u7Kfr6zI4f/zyNT/16yv+v/9////
////wfD/////////////wgALCA20CD4BAREA/8QAGQABAQEBAQEAAAAAAAAAAAAAAAECAwQF/9oA
CAEBAAAAAeFzUWUsiyzUFlgFgChLKud5lms2KluaLBNZs1neNSaRclSxqWLJ0xYVNQFyusxQlA1M
#...
x1x1eAsAAQToAwAABOgDAABQSwECHgMUAAkACACrg51OHIIIsGZHXwCfQ18ADwAYAAAAAAAAAAAA
pIFlCgAAbHNiX1JHQi5wbmcuZW5jVVQFAANCCsdcdXgLAAEE6AMAAAToAwAAUEsFBgAAAAAGAAYA
RAIAACRSXwAAAA==
</span></code></pre></div></div>

<p>On peut retrouver le texte déjà visible sur le PDF, accompagné de tout le texte cachait, qui été en blanc sur le PDF. On a sûrement à faire à de la <code class="highlighter-rouge">base64</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>text_extracted.txt | <span class="nb">wc</span> <span class="nt">-l</span>
117798
<span class="nv">$ </span><span class="nb">cat </span>text_extracted.txt | <span class="nb">sed</span> <span class="nt">-n</span> 9,117797p <span class="o">&gt;</span> file.b64
<span class="nv">$ </span><span class="nb">cat </span>file.b64 | <span class="nb">base64</span> <span class="nt">-di</span> <span class="o">&gt;</span> file.bin
<span class="c"># -i, --ignore-garbage: when decoding, ignore non-alphabet characters</span>
<span class="nv">$ </span>file file.bin
file.bin: JPEG image data, progressive, precision 8, 2110x3508, frames 1
<span class="nv">$ </span><span class="nb">cp </span>file.bin file.jpg
</code></pre></div></div>

<p>On retire les 9 premières lignes et on crée le fichier <code class="highlighter-rouge">file.b64</code>. On le décode avec <code class="highlighter-rouge">base64 -id</code>. On remarque que l’on a à faire à un JPG, on le renomme alors. On voit alors une image de Richelieu. Il y a sûrement d’autres choses dans un fichier si grand.</p>

<hr />
<h2 id="zip">ZIP</h2>
<hr />

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>binwalk file.jpg
DECIMAL       HEXADECIMAL     DESCRIPTION
<span class="nt">--------------------------------------------------------------------------------</span>
445628        0x6CCBC         Zip archive data, encrypted, name: .bash_history
445979        0x6CE1B         Zip archive data, encrypted, name: suite.zip
446405        0x6CFC5         Zip archive data, encrypted, name: prime.txt
446943        0x6D1DF         Zip archive data, encrypted, name: public.key
447670        0x6D4B6         Zip archive data, encrypted, name: motDePasseGPG.txt.enc
448289        0x6D721         Zip archive data, encrypted, name: lsb_RGB.png.enc
6693156       0x662124        End of Zip archive, footer length: 22
</code></pre></div></div>

<p>Avec <code class="highlighter-rouge">binwalk</code> on peut voir la présence d’une archive qui est composée de plusieurs fichiers intéressants.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>binwalk <span class="nt">--dd</span><span class="o">=</span><span class="s2">".*"</span> file.jpg
<span class="nv">$ </span><span class="nb">cd </span>_file.jpg.extracted/
<span class="nv">$ </span>ll
<span class="nt">-rw-r--r--</span> 1 adel adel      22 mai   24 19:58 662124
<span class="nt">-rw-r--r--</span> 1 adel adel 6247550 mai   24 19:58 6CCBC
<span class="nv">$ </span>file 662124 
662124: Zip archive data <span class="o">(</span>empty<span class="o">)</span>
<span class="nv">$ </span>file 6CCBC 
6CCBC: Zip archive data, at least v2.0 to extract
<span class="nv">$ </span><span class="nb">cp </span>6CCBC file.zip
<span class="nv">$ </span>unzip file.zip 
Archive:  file.zip
<span class="o">[</span>file.zip] .bash_history password:
</code></pre></div></div>

<p>Après extraction, on se retrouve avec 2 fichiers, un qui ne sert sûrement à rien (<code class="highlighter-rouge">662124</code>) et un qui parait être utile: <code class="highlighter-rouge">6CCBC</code>. C’est une archive chiffrée bien sûr. Il faut trouver un mot de passe. Après quelques recherches sans succès, revenons aux basiques.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>strings file.zip
<span class="c"># ...</span>
a#W|+
~8!6
.bash_historyUT
Le mot de passePK
suite.zipUT
de cette archivePK
prime.txtUT
est : DGSE<span class="o">{</span>t.D<span class="o">=</span>@Bx^A%n9FQB~_VL7Zn8z<span class="o">=</span>:K^4ikE<span class="o">=</span>j0EGHqI<span class="o">}</span>PK
public.keyUT
motDePasseGPG.txt.encUT
lsb_RGB.png.encUT
</code></pre></div></div>

<p>Le mot de passe est sûrement sous nos yeux…</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">mkdir </span>zip_files
<span class="nv">$ </span>unzip <span class="nt">-P</span> <span class="s2">"DGSE{t.D=@Bx^A%n9FQB~_VL7Zn8z=:K^4ikE=j0EGHqI}"</span> file.zip <span class="nt">-d</span> zip_files
Archive:  file.zip
  inflating: zip_files/.bash_history  
 extracting: zip_files/suite.zip     
  inflating: zip_files/prime.txt     
  inflating: zip_files/public.key    
 extracting: zip_files/motDePasseGPG.txt.enc  
  inflating: zip_files/lsb_RGB.png.enc 
</code></pre></div></div>

<p>Nous avons accès à tous les fichiers du zip.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd </span>zip_files/
<span class="nv">$ </span>ll
<span class="nt">-rw-r--r--</span> 1 adel adel     578 avril 26 17:20 .bash_history
<span class="nt">-rw-r--r--</span> 1 adel adel 6243231 avril 29 16:29 lsb_RGB.png.enc
<span class="nt">-rw-r--r--</span> 1 adel adel     512 avril 29 16:29 motDePasseGPG.txt.enc
<span class="nt">-rw-r--r--</span> 1 adel adel     868 avril 29 16:29 prime.txt
<span class="nt">-rw-r--r--</span> 1 adel adel     800 avril 29 16:29 public.key
<span class="nt">-rw-r--r--</span> 1 adel adel     331 avril 29 16:28 suite.zip
</code></pre></div></div>

<p>Essayons donc de les parcourir et de faire une analyse rapide.</p>

<h4 id="bash_history"><code class="highlighter-rouge">.bash_history</code></h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>file .bash_history 
.bash_history: ASCII text
<span class="nv">$ </span><span class="nb">cat</span> .bash_history
 <span class="c"># gpg encryption</span>
 1337  gpg <span class="nt">-o</span> lsb_RGB.png.enc <span class="nt">--symmetric</span> lsb_RGB.png
 
 <span class="c"># create file with futur GPG password ?</span>
 1338  vim motDePasseGPG.txt
 
 <span class="c"># gen 4096 bits rsa private key</span>
 1339  openssl genrsa <span class="nt">-out</span> priv.key 4096
 
 <span class="c"># gen public key</span>
 1340  openssl rsa <span class="nt">-pubout</span> <span class="nt">-out</span> public.key <span class="nt">-in</span> priv.key
 
 <span class="c"># extract prime 1 from priv key ?</span>
 1341  openssl rsa <span class="nt">-noout</span> <span class="nt">-text</span> <span class="nt">-in</span> priv.key | <span class="nb">grep </span>prime1 <span class="nt">-A</span> 18 <span class="o">&gt;</span> prime.txt
 <span class="c"># -A NUM, --after-context=NUM: Print NUM lines of trailing context after matching lines.</span>
 
 <span class="c"># change file content with sed !!</span>
 1342  <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/7f/fb/g'</span> prime.txt
 1343  <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/e1/66/g'</span> prime.txt
 1344  <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/f4/12/g'</span> prime.txt
 1345  <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/16/54/g'</span> prime.txt
 1346  <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/a4/57/g'</span> prime.txt
 1347  <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/b5/cd/g'</span> prime.txt
 
 <span class="c"># encryption of motDePasseGPG.txt with public.key</span>
 1348  openssl rsautl <span class="nt">-encrypt</span> <span class="nt">-pubin</span> <span class="nt">-inkey</span> public.key <span class="nt">-in</span> motDePasseGPG.txt <span class="nt">-out</span> motDePasseGPG.txt.enc
</code></pre></div></div>

<p>Le fichier <code class="highlighter-rouge">.bash_history</code> sous Linux contient tout l’historique des commandes qui ont étaient exécutaient sur le terminal.</p>

<h4 id="motdepassegpgtxtenc-"><code class="highlighter-rouge">motDePasseGPG.txt.enc </code></h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>file motDePasseGPG.txt.enc 
motDePasseGPG.txt.enc: data
<span class="nv">$ </span><span class="nb">cat </span>motDePasseGPG.txt.enc 
<span class="c"># ciphered data</span>
</code></pre></div></div>

<p>On comprend rapidement que notre but sera de retrouver la clé privée utilisée pour réaliser le déchiffrement du fichier <code class="highlighter-rouge">motDePasseGPG.txt.enc</code>.</p>

<h4 id="primetxt"><code class="highlighter-rouge">prime.txt</code></h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>file prime.txt 
prime.txt: ASCII text
<span class="nv">$ </span><span class="nb">cat </span>prime.txt 
prim66:
    00:fb:40:dc:44:ba:03:d1:53:42:f7:59:08:e0:f9:
    30:05:96:64:4a:de:94:68:5e:08:e2:8c:9a:b1:64:
    0c:2f:62:c2:9a:b9:a2:39:82:4b:9e:be:eb:76:ae:
    6d:87:21:a3:5e:9e:d9:8d:7e:57:38:3e:59:09:34:
    a5:78:cd:f7:2e:89:5d:5c:37:52:ea:fd:f6:31:cc:
    ba:d2:d9:60:e4:45:1d:67:76:d2:1f:12:9c:9d:c9:
    b1:90:45:51:ed:d2:fb:dd:b6:74:b4:99:fb:b1:0a:
    d9:b7:c2:be:8b:57:07:22:0a:8e:3a:36:ff:6d:c1:
    1d:63:93:af:cb:4e:c0:47:9f:65:bf:df:e3:f0:5f:
    1e:98:61:45:74:ec:36:a7:a5:b1:f1:8d:3d:97:6b:
    5a:82:49:09:00:08:0d:9d:c2:74:57:4e:30:a1:39:
    68:2f:22:34:71:13:aa:3b:f2:20:4f:8e:10:eb:d4:
    d0:9b:cd:8c:c2:53:5f:9d:71:13:0c:0f:21:b6:6e:
    13:39:40:d3:a6:b1:eb:74:ad:dd:0a:29:14:81:b1:
    90:ad:e0:53:f0:89:c8:00:fe:dc:ad:56:59:fc:28:
    1d:c0:cf:5e:08:c0:54:33:24:a3:52:bb:f3:25:10:
    43:c3:73:b8:40:4f:fc:6b:6b:77:bd:5f:22:24:eb:
    fb:15
</code></pre></div></div>

<p>Voici donc le fichier manipulé dans le <code class="highlighter-rouge">.bash_history</code>, il ne faut pas oublier que ce dernier à été modifié après avoir été créé. Il faut donc penser à le modifier pour retrouver ses valeurs d’origines.</p>

<h4 id="publickey"><code class="highlighter-rouge">public.key</code></h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>file public.key 
public.key: ASCII text
<span class="nv">$ </span><span class="nb">cat </span>public.key 
<span class="nt">-----BEGIN</span> PUBLIC KEY-----
MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAzV+KJMdgUAiJejySLA6B
Lnad4KRkQsNQy3jHhoU589OKrICz5qUGYFkQ6FmYBrTR0Ujy9rgdoEeWqKWu4Y8p
6D4Wd1oqCgCHBUH2V07RQ4Y2rgoMEW4HEE9I9yCUhjo4aeHI/CIGJyeJYvsihz4x
VvGOVd7JTpcAZOx/Tg6IRUAS4v1d/l+NGb8XD5zLP0bg/RAZvLAtkIOgcDxhf5lj
eeZHg1SnOubmrLzh9DM+z68kNmo+l30808v+jYo4e9h2v9q4SI9vR78fvjMBD9LX
4itNsuVneDzgtgbbhrk3WXFMT2OWp/ufdMQCEEOw89RtJjPr1DqHeGPffWgPUGWH
wRndZBAMqDHOKvM9lRtSTF8GtJ9b8ss4HnQYGTDQaoBQXAar1b9IcPDJ+1gb2A26
iJZgY5+Tbt6o/l0Mnq5YBi7WkyUlg8ccx4K6YT4BQ45ptD+eZOyoT56gToEa17Oe
/Xh20ba1AcT0iszm8kI59sBAKHiBNc2Iw9Fb4PLrt96enBmnqTA3AF7gqaZAutoz
LsDQXunwioMjVKBIepJ9XogGbiVp5sXUaI5CK/oLJ8YXHG178Cm/2RZXUq8ZqnGz
Oh6nC2w3H7IeR/Un2At9BPWCrZ+ZNa9yNoLcAcqYgGIYcN7LetFWSM307xUwFvPm
2HkzuOxUz6H9+HxGcCCj51MCAwEAAQ<span class="o">==</span>
<span class="nt">-----END</span> PUBLIC KEY-----
</code></pre></div></div>

<p>Nous possédons également, la clé publique utilisée pour le chiffrement.</p>

<h4 id="lsb_rgbpngenc"><code class="highlighter-rouge">lsb_RGB.png.enc</code></h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>file lsb_RGB.png.enc 
lsb_RGB.png.enc: GPG symmetrically encrypted data <span class="o">(</span>AES256 cipher<span class="o">)</span>
</code></pre></div></div>

<p>D’après le <code class="highlighter-rouge">.bash_history</code>, ce fichier a été chiffré, avec GPG.</p>

<h4 id="suitezip"><code class="highlighter-rouge">suite.zip</code></h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>file suite.zip 
suite.zip: Zip archive data, at least v2.0 to extract
<span class="nv">$ </span>unzip suite.zip 
Archive:  suite.zip
<span class="o">[</span>suite.zip] suite.txt password:
</code></pre></div></div>

<p>Prochaine étape du challenge.</p>

<hr />
<h2 id="attaque-sur-rsa">Attaque sur RSA</h2>
<hr />

<p>Commençons par essayer d’attaquer la clé publique, même si je pense qu’il y a peu de chances d’y arriver.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>rsactftool.py <span class="nt">--publickey</span> ./public.key <span class="nt">--private</span>
Killed
<span class="nv">$ </span>rsactftool.py <span class="nt">--publickey</span> ./public.key <span class="nt">--uncipherfile</span> ./motDePasseGPG.txt.enc
Killed 
</code></pre></div></div>

<p>Pas possible d’attaquer la clé publique (module bien trop grand).</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>prime.txt 
prim66:
    00:fb:40:dc:44:ba:03:d1:53:42:f7:59:08:e0:f9:
    30:05:96:64:4a:de:94:68:5e:08:e2:8c:9a:b1:64:
    0c:2f:62:c2:9a:b9:a2:39:82:4b:9e:be:eb:76:ae:
    6d:87:21:a3:5e:9e:d9:8d:7e:57:38:3e:59:09:34:
    a5:78:cd:f7:2e:89:5d:5c:37:52:ea:fd:f6:31:cc:
    ba:d2:d9:60:e4:45:1d:67:76:d2:1f:12:9c:9d:c9:
    b1:90:45:51:ed:d2:fb:dd:b6:74:b4:99:fb:b1:0a:
    d9:b7:c2:be:8b:57:07:22:0a:8e:3a:36:ff:6d:c1:
    1d:63:93:af:cb:4e:c0:47:9f:65:bf:df:e3:f0:5f:
    1e:98:61:45:74:ec:36:a7:a5:b1:f1:8d:3d:97:6b:
    5a:82:49:09:00:08:0d:9d:c2:74:57:4e:30:a1:39:
    68:2f:22:34:71:13:aa:3b:f2:20:4f:8e:10:eb:d4:
    d0:9b:cd:8c:c2:53:5f:9d:71:13:0c:0f:21:b6:6e:
    13:39:40:d3:a6:b1:eb:74:ad:dd:0a:29:14:81:b1:
    90:ad:e0:53:f0:89:c8:00:fe:dc:ad:56:59:fc:28:
    1d:c0:cf:5e:08:c0:54:33:24:a3:52:bb:f3:25:10:
    43:c3:73:b8:40:4f:fc:6b:6b:77:bd:5f:22:24:eb:
    fb:15
</code></pre></div></div>

<p>Nous devons donc travailler sur ce fichier.</p>

<p>Rappels sur RSA:
<script type="math/tex">p*q = n \\
p: prime 1 \\
q: prime 2 \\
n: modulus \\</script>
Tout d’abord, nous devons nettoyer <code class="highlighter-rouge">prime.txt</code> afin de retrouver la valeur de $p$.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1341  openssl rsa <span class="nt">-noout</span> <span class="nt">-text</span> <span class="nt">-in</span> priv.key | <span class="nb">grep </span>prime1 <span class="nt">-A</span> 18 <span class="o">&gt;</span> prime.txt
1342  <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/7f/fb/g'</span> prime.txt
1343  <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/e1/66/g'</span> prime.txt
1344  <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/f4/12/g'</span> prime.txt
1345  <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/16/54/g'</span> prime.txt
1346  <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/a4/57/g'</span> prime.txt
1347  <span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/b5/cd/g'</span> prime.txt
</code></pre></div></div>

<p>La première commande permet de récupérer les 18 lignes se trouvant après la chaîne <code class="highlighter-rouge">prime1</code>, ce qui correspond donc à notre $p$.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cp </span>prime.txt prime_good.txt
<span class="nv">$ </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/cd/b5/g'</span> prime_good.txt
<span class="nv">$ </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/57/a4/g'</span> prime_good.txt
<span class="nv">$ </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/54/16/g'</span> prime_good.txt
<span class="nv">$ </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/12/f4/g'</span> prime_good.txt
<span class="nv">$ </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/66/e1/g'</span> prime_good.txt
<span class="nv">$ </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/fb/7f/g'</span> prime_good.txt
</code></pre></div></div>

<p>Les lignes suivantes, réalisent des substitutions sur le fichier à l’aide de la commande <code class="highlighter-rouge">sed</code>, il faut donc les inverser pour connaître le contenu originel de <code class="highlighter-rouge">prime.txt</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>prime_good.txt 
prime1:
    00:7f:40:dc:44:ba:03:d1:53:42:f7:59:08:e0:f9:
    30:05:96:64:4a:de:94:68:5e:08:e2:8c:9a:b1:64:
    0c:2f:62:c2:9a:b9:a2:39:82:4b:9e:be:eb:76:ae:
    6d:87:21:a3:5e:9e:d9:8d:7e:a4:38:3e:59:09:34:
    a5:78:b5:f7:2e:89:5d:5c:37:52:ea:fd:f6:31:cc:
    ba:d2:d9:60:e4:45:1d:67:76:d2:1f:f4:9c:9d:c9:
    b1:90:45:51:ed:d2:7f:dd:b6:74:b4:99:7f:b1:0a:
    d9:b7:c2:be:8b:a4:07:22:0a:8e:3a:36:ff:6d:c1:
    1d:63:93:af:cb:4e:c0:47:9f:65:bf:df:e3:f0:5f:
    1e:98:61:45:74:ec:36:a7:a5:b1:f1:8d:3d:97:6b:
    5a:82:49:09:00:08:0d:9d:c2:74:a4:4e:30:a1:39:
    68:2f:22:34:71:13:aa:3b:f2:20:4f:8e:10:eb:d4:
    d0:9b:b5:8c:c2:53:5f:9d:71:13:0c:0f:21:b6:6e:
    13:39:40:d3:a6:b1:eb:74:ad:dd:0a:29:14:81:b1:
    90:ad:e0:53:f0:89:c8:00:fe:dc:ad:56:59:fc:28:
    1d:c0:cf:5e:08:c0:16:33:24:a3:52:bb:f3:25:10:
    43:c3:73:b8:40:4f:fc:6b:6b:77:bd:5f:22:24:eb:
    7f:15
</code></pre></div></div>

<p>Voici donc la vrai valeur de notre nombre $prime1$ ou $p$. Nous devons maintenant trouver $q$, qui vaut:
<script type="math/tex">q = \frac{n}{p}</script>
Nous avons le clé publique <code class="highlighter-rouge">public.key</code>, nous pouvons donc facilement extraire $n$.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openssl rsa <span class="nt">-pubin</span> <span class="nt">-inform</span> PEM <span class="nt">-text</span> <span class="nt">-noout</span> <span class="nt">-in</span> public.key <span class="o">&gt;</span> modulus.txt
RSA Public-Key: <span class="o">(</span>4096 bit<span class="o">)</span>
Modulus:
    00:cd:5f:8a:24:c7:60:50:08:89:7a:3c:92:2c:0e:
    81:2e:76:9d:e0:a4:64:42:c3:50:cb:78:c7:86:85:
    39:f3:d3:8a:ac:80:b3:e6:a5:06:60:59:10:e8:59:
    98:06:b4:d1:d1:48:f2:f6:b8:1d:a0:47:96:a8:a5:
    ae:e1:8f:29:e8:3e:16:77:5a:2a:0a:00:87:05:41:
    f6:57:4e:d1:43:86:36:ae:0a:0c:11:6e:07:10:4f:
    48:f7:20:94:86:3a:38:69:e1:c8:fc:22:06:27:27:
    89:62:fb:22:87:3e:31:56:f1:8e:55:de:c9:4e:97:
    00:64:ec:7f:4e:0e:88:45:40:12:e2:fd:5d:fe:5f:
    8d:19:bf:17:0f:9c:cb:3f:46:e0:fd:10:19:bc:b0:
    2d:90:83:a0:70:3c:61:7f:99:63:79:e6:47:83:54:
    a7:3a:e6:e6:ac:bc:e1:f4:33:3e:cf:af:24:36:6a:
    3e:97:7d:3c:d3:cb:fe:8d:8a:38:7b:d8:76:bf:da:
    b8:48:8f:6f:47:bf:1f:be:33:01:0f:d2:d7:e2:2b:
    4d:b2:e5:67:78:3c:e0:b6:06:db:86:b9:37:59:71:
    4c:4f:63:96:a7:fb:9f:74:c4:02:10:43:b0:f3:d4:
    6d:26:33:eb:d4:3a:87:78:63:df:7d:68:0f:50:65:
    87:c1:19:dd:64:10:0c:a8:31:ce:2a:f3:3d:95:1b:
    52:4c:5f:06:b4:9f:5b:f2:cb:38:1e:74:18:19:30:
    d0:6a:80:50:5c:06:ab:d5:bf:48:70:f0:c9:fb:58:
    1b:d8:0d:ba:88:96:60:63:9f:93:6e:de:a8:fe:5d:
    0c:9e:ae:58:06:2e:d6:93:25:25:83:c7:1c:c7:82:
    ba:61:3e:01:43:8e:69:b4:3f:9e:64:ec:a8:4f:9e:
    a0:4e:81:1a:d7:b3:9e:fd:78:76:d1:b6:b5:01:c4:
    f4:8a:cc:e6:f2:42:39:f6:c0:40:28:78:81:35:cd:
    88:c3:d1:5b:e0:f2:eb:b7:de:9e:9c:19:a7:a9:30:
    37:00:5e:e0:a9:a6:40:ba:da:33:2e:c0:d0:5e:e9:
    f0:8a:83:23:54:a0:48:7a:92:7d:5e:88:06:6e:25:
    69:e6:c5:d4:68:8e:42:2b:fa:0b:27:c6:17:1c:6d:
    7b:f0:29:bf:d9:16:57:52:af:19:aa:71:b3:3a:1e:
    a7:0b:6c:37:1f:b2:1e:47:f5:27:d8:0b:7d:04:f5:
    82:ad:9f:99:35:af:72:36:82:dc:01:ca:98:80:62:
    18:70:de:cb:7a:d1:56:48:cd:f4:ef:15:30:16:f3:
    e6:d8:79:33:b8:ec:54:cf:a1:fd:f8:7c:46:70:20:
    a3:e7:53
Exponent: 65537 <span class="o">(</span>0x10001<span class="o">)</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># autre façon</span>
<span class="nv">$ </span>rsactftool.py <span class="nt">--dumpkey</span> <span class="nt">--key</span> ./public.key
<span class="o">[</span><span class="k">*</span><span class="o">]</span> n: 837849563862443268467145186974119695264713699736869090645354954749227901572347301978135797019317859500555501198030540582269024532041297110543579716921121054608494680063992435808708593796476251796064060074170458193997424535149535571009862661106986816844991748325991752241516736019840401840150280563780565210071876568736454876944081872530701199426927496904961840225828224638335830986649773182889291953429581550269688392460126500500241969200245489815778699333733762961281550873031692933566002822719129034336264975002130651771127313980758562909726233111335221426610990708111420561543408517386750898610535272480495075060087676747037430993946235792405851007090987857400336566798760095401096997696558611588264303087788673650321049503980655866936279251406742641888332665054505305697841899685165810087938256696223326430000379461379116517951965921710056451210314300437093481577578273495492184643002539393573651797054497188546381723478952017972346925020598375000908655964982541016719356586602781209943943317644547996232516630476025321795055805235006790200867328602560320883328523659710885314500874028671969578391146701739515500370268679301080577468316159102141953941314919039404470348112690214065442074200255579004452618002777227561755664967507
<span class="o">[</span><span class="k">*</span><span class="o">]</span> e: 65537
</code></pre></div></div>

<p>Nous connaissons maintenant la valeur de $n$, not:re $modulus$. C’est la forme en base 10 qui va nous intéresser.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python3
<span class="o">&gt;&gt;&gt;</span> p <span class="o">=</span> <span class="s1">''</span>.join<span class="o">(</span>open<span class="o">(</span><span class="s1">'prime_good.txt'</span><span class="o">)</span>.readlines<span class="o">())</span>
<span class="o">&gt;&gt;&gt;</span> import re
<span class="o">&gt;&gt;&gt;</span> p <span class="o">=</span> int<span class="o">(</span>re.sub<span class="o">(</span><span class="s1">'[^0-9a-f]'</span>,<span class="s1">''</span>,p[6:]<span class="o">)</span>, 16<span class="o">)</span>
<span class="o">&gt;&gt;&gt;</span> import gmpy
<span class="o">&gt;&gt;&gt;</span> gmpy.is_prime<span class="o">(</span>p<span class="o">)</span>
0
</code></pre></div></div>

<p>Sauf que, problème, on se rend compte qu’après avoir passé notre <code class="highlighter-rouge">prime_good.txt</code> en base 10, celui-ci n’est pas premier… :(</p>

<p>Après réflexions, l’inversion des <code class="highlighter-rouge">sed</code> que l’on a fait plus haut n’est peut-être pas suffisante. Par exemple, si nous avons la chaîne ; <code class="highlighter-rouge">xxxxbbxx</code> et que l’on applique <code class="highlighter-rouge">sed -i s/bb/xx/g</code>, ce qui nous donne <code class="highlighter-rouge">xxxxxxxx</code>. On pense alors qu’il suffit d’inverser le <code class="highlighter-rouge">sed</code> en <code class="highlighter-rouge">sed -i s/xx/bb/g</code> pour retrouver le message originel. Sauf que non, on se retrouve avec <code class="highlighter-rouge">bbbbbbbb</code>. C’est sûrement le même problème avec notre <code class="highlighter-rouge">prime_good.txt</code>, l’inversion du <code class="highlighter-rouge">sed</code> ne garantis pas de retrouver le vrai $prime$ d’origine.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/cd/b5/g'</span> prime_good.txt <span class="c"># 2 occurrences de 'b5'</span>
<span class="nv">$ </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/57/a4/g'</span> prime_good.txt <span class="c"># 3 occurrences de 'a4'</span>
<span class="nv">$ </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/54/16/g'</span> prime_good.txt <span class="c"># 1 occurrence de '16'</span>
<span class="nv">$ </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/12/f4/g'</span> prime_good.txt <span class="c"># 1 occurrence de 'f4'</span>
<span class="nv">$ </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/66/e1/g'</span> prime_good.txt <span class="c"># on ignore car présent au début</span>
<span class="nv">$ </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/fb/7f/g'</span> prime_good.txt <span class="c"># 4 occurrences de '7f' dans godd_prime.txt</span>
</code></pre></div></div>

<p>Il faut donc tester toutes les combinaisons possibles, chaque occurrence peut prendre 2 valeurs, soit garder sa valeur actuelle, soit revenir à sa valeur d’origine. Nous allons tester toutes les combinaisons possibles appliquées au fichier <code class="highlighter-rouge">prime_good.txt</code> puis tester à chaque fois si notre $q$ est premier.</p>

<p>Voici le script qui va effectuer cette tâche :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#/usr/bin/env python3
</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">subprocess</span> <span class="k">as</span> <span class="n">sp</span>
<span class="kn">import</span> <span class="nn">gmpy</span>

<span class="c1"># read modulus (n)
</span><span class="n">n</span> <span class="o">=</span> <span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">'[0-9a-f]{2}:.*:[0-9a-f]{2}'</span><span class="p">,</span> <span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">'modulus.txt'</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()),</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">' '</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># read prime to ajust
</span><span class="n">f</span> <span class="o">=</span> <span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">'prime_good.txt'</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">())</span>

<span class="c1"># hex to ajust
</span><span class="n">tab_reg</span> <span class="o">=</span> <span class="p">[</span><span class="s">'7f'</span><span class="p">,</span> <span class="s">'f4'</span><span class="p">,</span> <span class="s">'16'</span><span class="p">,</span> <span class="s">'a4'</span><span class="p">,</span> <span class="s">'b5'</span><span class="p">]</span>

<span class="c1"># find position for each previous hex
</span><span class="n">positions_occ</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">reg</span> <span class="ow">in</span> <span class="n">tab_reg</span><span class="p">:</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">())</span>
    <span class="n">positions_occ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
 <span class="c1"># we ill use binary to find all combinaisons
</span><span class="n">combinaisons_7f</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">repeat</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">positions_occ</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
<span class="n">combinaisons_f4</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">repeat</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">positions_occ</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
<span class="n">combinaisons_16</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">repeat</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">positions_occ</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>
<span class="n">combinaisons_a4</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">repeat</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">positions_occ</span><span class="p">[</span><span class="mi">3</span><span class="p">])))</span>
<span class="n">combinaisons_b5</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">repeat</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">positions_occ</span><span class="p">[</span><span class="mi">4</span><span class="p">])))</span>

<span class="c1"># adapt '7f'
</span><span class="k">for</span> <span class="n">c_7f</span> <span class="ow">in</span> <span class="n">combinaisons_7f</span><span class="p">:</span>
    <span class="n">pos_7f</span> <span class="o">=</span> <span class="n">positions_occ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">new_7f_0</span> <span class="o">=</span> <span class="s">'7f'</span> <span class="k">if</span> <span class="n">c_7f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">'fb'</span>
    <span class="n">new_7f_1</span> <span class="o">=</span> <span class="s">'7f'</span> <span class="k">if</span> <span class="n">c_7f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">'fb'</span>
    <span class="n">new_7f_2</span> <span class="o">=</span> <span class="s">'7f'</span> <span class="k">if</span> <span class="n">c_7f</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">'fb'</span>
    <span class="n">new_7f_3</span> <span class="o">=</span> <span class="s">'7f'</span> <span class="k">if</span> <span class="n">c_7f</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">'fb'</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">pos_7f</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">new_7f_0</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="n">pos_7f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">pos_7f</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="n">new_7f_1</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="n">pos_7f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">pos_7f</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">+</span> <span class="n">new_7f_2</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="n">pos_7f</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">pos_7f</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">+</span> <span class="n">new_7f_3</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="n">pos_7f</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">:]</span>
    
    <span class="c1"># adapt 'f4'
</span>    <span class="k">for</span> <span class="n">c_f4</span> <span class="ow">in</span> <span class="n">combinaisons_f4</span><span class="p">:</span>
        <span class="n">pos_f4</span> <span class="o">=</span> <span class="n">positions_occ</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">new_f4_0</span> <span class="o">=</span> <span class="s">'f4'</span> <span class="k">if</span> <span class="n">c_f4</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">'12'</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">pos_f4</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">new_f4_0</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="n">pos_f4</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">:]</span>
        
        <span class="c1"># adapt '16'
</span>        <span class="k">for</span> <span class="n">c_16</span> <span class="ow">in</span> <span class="n">combinaisons_16</span><span class="p">:</span>
            <span class="n">pos_16</span> <span class="o">=</span> <span class="n">positions_occ</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">new_16_0</span> <span class="o">=</span> <span class="s">'16'</span> <span class="k">if</span> <span class="n">c_16</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">'54'</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">pos_16</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">new_16_0</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="n">pos_16</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">:]</span>
            
            <span class="c1"># adapt 'a4'
</span>            <span class="k">for</span> <span class="n">c_a4</span> <span class="ow">in</span> <span class="n">combinaisons_a4</span><span class="p">:</span>
                <span class="n">pos_a4</span> <span class="o">=</span> <span class="n">positions_occ</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">new_a4_0</span> <span class="o">=</span> <span class="s">'a4'</span> <span class="k">if</span> <span class="n">c_a4</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">'57'</span>
                <span class="n">new_a4_1</span> <span class="o">=</span> <span class="s">'a4'</span> <span class="k">if</span> <span class="n">c_a4</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">'57'</span>
                <span class="n">new_a4_2</span> <span class="o">=</span> <span class="s">'a4'</span> <span class="k">if</span> <span class="n">c_a4</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">'57'</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">pos_a4</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">new_a4_0</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="n">pos_a4</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">pos_a4</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="n">new_a4_1</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="n">pos_a4</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">pos_a4</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">+</span> <span class="n">new_a4_2</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="n">pos_a4</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">:]</span>
                	
                    <span class="c1"># adapt 'b5'
</span>                <span class="k">for</span> <span class="n">c_b5</span> <span class="ow">in</span> <span class="n">combinaisons_b5</span><span class="p">:</span>
                    <span class="n">pos_b5</span> <span class="o">=</span> <span class="n">positions_occ</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                    <span class="n">new_b5_0</span> <span class="o">=</span> <span class="s">'b5'</span> <span class="k">if</span> <span class="n">c_b5</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">'cd'</span>
                    <span class="n">new_b5_1</span> <span class="o">=</span> <span class="s">'b5'</span> <span class="k">if</span> <span class="n">c_b5</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">'cd'</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">pos_b5</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">new_b5_0</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="n">pos_b5</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">pos_b5</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="n">new_b5_1</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="n">pos_b5</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">:]</span>

                    <span class="c1"># final test
</span>                    <span class="n">p</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">' '</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'prime1'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">':'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">gmpy</span><span class="o">.</span><span class="n">is_prime</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">gmpy</span><span class="o">.</span><span class="n">is_prime</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">q</span> <span class="o">=</span> <span class="n">n</span><span class="o">//</span><span class="n">p</span>
                        <span class="k">if</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
                            <span class="k">print</span><span class="p">(</span><span class="s">'p</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
                            <span class="k">print</span><span class="p">(</span><span class="s">'q</span><span class="se">\n</span><span class="s">'</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
                            <span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<p>Code pas du tout optimal, mais fonctionnel :)</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python3 ./find_good_prime.py 
p
 31717798413454838971739311391870214101486054474438584033384974797696836002786889741922328038249283935148167589396475764515984792248325276562635675483085593307632384945480084324354199386711259069590701728377654610059849152461565385315663116675949927841648944186909571007960100266136674008112969369512988507367569334838093403144731951113528040013763615354283491955226704334394856253005551393545293491547587439064269735583121706098798182168292621767902095641352443871167789104818694502605762517497996162527138366803593402358312011933528177646501311411008602369245268966975849244259437732574655956250792264392115994984213
q
 26415754111957012456882978698568998595543408604540679602012008905307229528398419508696699258861541673208334031720118065722015191735056250991124159829757615035331104814626815428071461389740988358621575175288995137250131479702118666935818278843603742157096854979085966659730153703721295913600711482578441198179188796849780101926878867272222747848775311501107737838687624647749187764563156054858429897018261077616060929102880860789449995240869652963349913062375402021334173237153511868665597034141167420444312865576543827395764456254276820652449103574192677537410783040227047254038577626347718324544296319787177388746439
</code></pre></div></div>

<p>Nous avons maintenant notre $p$ et $q$ qui sont premiers.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>rsatool.py <span class="nt">-o</span> priv.key <span class="nt">-p</span> 3171779841... <span class="nt">-q</span> 2641575411...
<span class="c"># ...</span>
Saving PEM as priv.key
</code></pre></div></div>

<p>Avec <code class="highlighter-rouge">rsatool.py</code>nous créons notre clé privée connaissant $p$ et $q$.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>openssl rsautl <span class="nt">-decrypt</span> <span class="nt">--inkey</span> priv.key <span class="nt">-in</span> motDePasseGPG.txt.enc <span class="nt">-out</span> motDePasseGPG.txt
<span class="nv">$ </span><span class="nb">cat </span>motDePasseGPG.txt
DGSE<span class="o">{</span>Ti,%yei3<span class="o">=</span>stlh_,5@pIrrMU.^mJC:luYbt1Qe_-Y<span class="o">}</span>
</code></pre></div></div>

<p>On déchiffre ensuite avec <code class="highlighter-rouge">openssl</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 1337  gpg <span class="nt">-o</span> lsb_RGB.png.enc <span class="nt">--symmetric</span> lsb_RGB.png
</code></pre></div></div>

<p>À ce stade nous n’avons toujours pas utilisé cette commande, étrange…</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>unzip <span class="nt">-d</span> suite_files/ <span class="nt">-P</span> <span class="s2">"DGSE{Ti,%yei3=stlh_,5@pIrrMU.^mJC:luYbt1Qe_-Y}"</span> suite.zip
Archive:  suite.zip
   skipping: suite.txt               incorrect password
</code></pre></div></div>

<p>Et non, ce mot de passe ne permet pas de déchiffrer le zip <code class="highlighter-rouge">suite.zip</code>.</p>

<hr />
<h2 id="gpg">GPG</h2>
<hr />

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> 1337  gpg <span class="nt">-o</span> lsb_RGB.png.enc <span class="nt">--symmetric</span> lsb_RGB.png
</code></pre></div></div>

<p>En regardant la commande, on se rend compte, que nous avons à faire à un chiffrement <code class="highlighter-rouge">symetric</code>. Alors que naturellement, <strong>GPG</strong> est un système de chiffrement asymétrique avec une notion de clé privée et publique. Pour du symétrique, il ne faut que le mot de passe pour déchiffrer, pas besoin de clé privée.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gpg <span class="nt">--batch</span> <span class="nt">--yes</span> <span class="nt">--passphrase</span> <span class="s2">"DGSE{Ti,%yei3=stlh_,5@pIrrMU.^mJC:luYbt1Qe_-Y}"</span> <span class="nt">-o</span> lsb_RGB.png <span class="nt">--decrypt</span> lsb_RGB.png.enc
gpg: AES256 encrypted data
gpg: encrypted with 1 passphrase
</code></pre></div></div>

<p>En cherchant un peu, on trouve comment déchiffrer du symétrique issu de GPG. On peut alors utiliser notre mot de passe que nous avions trouvé. Le fichier déchiffré est une autre image de Richelieu encore une fois.</p>

<p>Le nom est assez explicite pour comprendre que la prochaine étape consiste à extraire des données en <strong>LSB</strong>.</p>

<hr />
<h2 id="lsb">LSB</h2>
<hr />

<blockquote>
  <p>In digital steganography, sensitive messages may be concealed by manipulating and storing  information in the least significant bits of an image or a sound file. In the context of an image, if a user were to manipulate the last two bits of a color in a pixel, the value of the color would change at most +/- 3 value places, which is likely to be indistinguishable by the human eye. The user may later recover this information by extracting the  least significant bits of the manipulated pixels to recover the original message. This allows for the storage or transfer of digital information to be kept concealed.</p>
</blockquote>

<p>Pour cette étape, nous devons utiliser l’image <code class="highlighter-rouge">lsb_RGB.png</code> afin d’extraire des données de celle-ci. Le LSB utilise la valeur des bits de poids faible des couleurs Rouge, Vert et Bleue. La difficulté du LSB réside dans la bonne sélection des bits de poids faibles. Nous utiliserons la librairie <code class="highlighter-rouge">PIL(Python Imaging Library)</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="nb">open</span><span class="p">(</span><span class="s">'lsb_RGB.png'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span>
<span class="p">(</span><span class="mi">1562</span><span class="p">,</span> <span class="mi">2424</span><span class="p">)</span> <span class="c1"># (y,x)
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">img</span><span class="o">.</span><span class="n">mode</span>
<span class="s">'RGB'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">img_data</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">img_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
</code></pre></div></div>

<p>On peut tout d’abord voir que l’on a affaire à un PNG de type <strong>RGB</strong> (et non <strong>RGBA</strong>, car pas de valeur alpha). Chaque pixel correspond alors à un tuple de taille 3, par exemple <code class="highlighter-rouge">(60, 180, 75)</code> correspond à la valeur du pixel en position <code class="highlighter-rouge">[y=0,x=0]</code>. La valeur <code class="highlighter-rouge">60</code> correspond à la quantité de rouge (Red) du pixel (valeur maximale de 255), <code class="highlighter-rouge">180</code> est la quantité de vert (Green) et <code class="highlighter-rouge">75</code> la quantité de bleu (Blue).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="nb">bin</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">img_data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]]</span>
<span class="p">[</span><span class="s">'00111100'</span><span class="p">,</span> <span class="s">'10110100'</span><span class="p">,</span> <span class="s">'01001011'</span><span class="p">]</span>
<span class="c1"># zfill(8): prefix with "0" to fixing size
</span></code></pre></div></div>

<p>Chacune de ces valeurs est codée sur 8 bits. Par exemple, la valeur <code class="highlighter-rouge">63</code> en base 10, est défini par <code class="highlighter-rouge">00111100</code> en base 2.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">'00111100'</span> -&gt; <span class="s1">'.......0'</span>
<span class="s1">'10110100'</span> -&gt; <span class="s1">'.......0'</span>
<span class="s1">'01001011'</span> -&gt; <span class="s1">'.......1'</span>
</code></pre></div></div>

<p>Pour ce premier pixel, la valeur LSB du RED est <code class="highlighter-rouge">0</code>, celle du GREEN est <code class="highlighter-rouge">0</code> et celle du BLUE est <code class="highlighter-rouge">1</code>.</p>

<p>La difficulté réside maintenant dans le fait de savoir si nous devons utiliser les 3 bits précédents ou simplement le LSB du RED, ou du GREEN, … ou même seulement le LSB du GREEN et BLUE.</p>

<p>Également, nous devons savoir dans quelle direction parcourir les pixels de notre image, soit ligne par ligne (de gauche à droite) ou en colonnes (haut en bas).</p>

<p>Après pas mal de tests, on sait qu’il faut utiliser les 3 LSB, le RED, GREEN et BLUE, de plus on doit parcourir les pixels de notre image en colonne, de haut en bas.</p>

<p>Voici notre extracteur LSB:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
    
    <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="nb">open</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
    
    <span class="n">dimX</span><span class="p">,</span><span class="n">dimY</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
    <span class="n">all_bits</span> <span class="o">=</span> <span class="s">''</span>
    
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimX</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimY</span><span class="p">):</span>
            <span class="n">r</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">]</span>
            <span class="n">r_bit</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">r</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">8</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># RED last bit
</span>            <span class="n">g_bit</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">g</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">8</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># GREEN last bit
</span>            <span class="n">b_bit</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">b</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">8</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># BLUE last bit
</span>            <span class="n">all_bits</span> <span class="o">+=</span> <span class="n">r_bit</span> <span class="o">+</span> <span class="n">g_bit</span> <span class="o">+</span> <span class="n">b_bit</span>
    
    <span class="n">tab_all_bits</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_bits</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_bits</span><span class="p">),</span> <span class="mi">8</span><span class="p">)]</span>
    
    <span class="k">return</span><span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tab_all_bits</span><span class="p">])</span>

<span class="k">print</span><span class="p">(</span><span class="s">'Start'</span><span class="p">)</span>
<span class="nb">open</span><span class="p">(</span><span class="s">'lsb_data'</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">extract</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s">'lsb_RGB.png'</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Done'</span><span class="p">)</span>
</code></pre></div></div>

<p>Ce script se charge de parcourir les pixels de l’image en colonne de haut en bas. Pour chaque pixel, on récupère le dernier bit des 3 composantes (RED, GREEN, BLUE). On construit ensuite un tableau d’octets (8 bits) sur lesquels on récupère leur caractère ASCII. Pour terminer, on enregistre tout ça dans le fichier <code class="highlighter-rouge">lsb_data</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># autre manière de trouver les infos LSB</span>
<span class="nv">$ </span>zsteg <span class="nt">-a</span> ./lsb_RGB.png
...
b1,rgb,lsb,yx       .. text: <span class="s2">"00000000: 7f45 4c46 0201 0103 0000 0000 0000 0000  .ELF............</span><span class="se">\n</span><span class="s2">00000010: 0200 3e00 0100 0000 107f 4400 0000 0000  ..&gt;.......D.....</span><span class="se">\n</span><span class="s2">00000020
...
</span></code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python3 ./lsb.py 
Start
Done
<span class="nv">$ </span>file lsb_data 
lsb_data: ASCII text
<span class="nv">$ </span><span class="nb">head </span>lsb_data 
00000000: 7f45 4c46 0201 0103 0000 0000 0000 0000  .ELF............
00000010: 0200 3e00 0100 0000 107f 4400 0000 0000  ..&gt;.......D.....
00000020: 4000 0000 0000 0000 0000 0000 0000 0000  @...............
00000030: 0000 0000 4000 3800 0200 4000 0000 0000  ....@.8...@.....
00000040: 0100 0000 0500 0000 0000 0000 0000 0000  ................
00000050: 0000 4000 0000 0000 0000 4000 0000 0000  ..@.......@.....
00000060: 2487 0400 0000 0000 2487 0400 0000 0000  <span class="nv">$.</span>......<span class="nv">$.</span>......
00000070: 0000 2000 0000 0000 0100 0000 0600 0000  .. .............
00000080: 2854 0b00 0000 0000 2854 6b00 0000 0000  <span class="o">(</span>T......<span class="o">(</span>Tk.....
00000090: 2854 6b00 0000 0000 0000 0000 0000 0000  <span class="o">(</span>Tk.............
</code></pre></div></div>

<p>Notre <code class="highlighter-rouge">lsb_data</code> correspond à la vue d’un éditeur hex d’un binaire, plus précisément un <code class="highlighter-rouge">ELF</code> (Executable and Linkable Format). La prochaine étape est sûrement d’extraire ce binaire et de l’analyser.</p>

<p>Mais avant de continuer, on doit se rappeler que notre script python précédent va réaliser l’extraction des bits LSB sur <strong>TOUS</strong> les pixels de l’image. Mais il y a de grande chance que notre extraction va trop loin. Essayons de voir cela en ouvrant <code class="highlighter-rouge">lsb_data</code> avec <code class="highlighter-rouge">vim</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sed</span> <span class="nt">-n</span> 18592,18595p lsb_data
000489f0: 414c 4421 0d16 0807 f3b9 2205 c301 7d67  ALD!......<span class="s2">"...}g # ligne 18592
00048a00: 0009 0000 9a02 0000 5044 0b00 4918 006b  ........PD..I..k # ligne 18593
00048a10: bc00 0000                                ....				# ligne 18594
q?Ð qdG/A§Ge¿{</span><span class="sb">`</span>Üø<span class="o">)</span>í÷Ö°Ú@¾ïÄt¤#&amp;óP_WlòÛ&lt;7_&amp;f|á<span class="o">}</span>ª						<span class="c"># ligne 18595</span>
                                               oDî<span class="nv">$õ</span>¬ËÕzµ<span class="s1">'ßØQ
</span></code></pre></div></div>

<p>On peut donc voir que nous devons couper en ligne 18594 pour ne pas polluer notre extraction.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sed</span> <span class="nt">-n</span> 1,18594p lsb_data <span class="o">&gt;</span> lsb_data_clean
<span class="nv">$ </span><span class="nb">cat </span>lsb_data_clean | less
00000000: 7f45 4c46 0201 0103 0000 0000 0000 0000  .ELF............
00000010: 0200 3e00 0100 0000 107f 4400 0000 0000  ..&gt;.......D.....
00000020: 4000 0000 0000 0000 0000 0000 0000 0000  @...............
</code></pre></div></div>

<p>Nous avons maintenant une vision en hex propre. Pour continuer nous devons extraire toutes les valeurs hexadécimal des colonnes du milieu. La colonne de gauche représente les positions des valeurs hexa et la colonne de droite, leur traduction ASCII, ces deux informations ne nous sont pas utiles, nous devons les retirer.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>lsb_data_clean | <span class="nb">cut</span> <span class="nt">-d</span><span class="s1">' '</span> <span class="nt">-f2-9</span> <span class="o">&gt;</span> lsb_data_clean_center
<span class="nv">$ </span>python3
<span class="o">&gt;&gt;&gt;</span> content <span class="o">=</span> open<span class="o">(</span><span class="s1">'lsb_data_clean_center'</span><span class="o">)</span>.read<span class="o">()</span>
<span class="o">&gt;&gt;&gt;</span> clean_content <span class="o">=</span> content.replace<span class="o">(</span><span class="s1">' '</span>, <span class="s1">''</span><span class="o">)</span>.replace<span class="o">(</span><span class="s1">'\n'</span>, <span class="s1">''</span><span class="o">)</span>
<span class="o">&gt;&gt;&gt;</span> import binascii
<span class="o">&gt;&gt;&gt;</span> final <span class="o">=</span> binascii.unhexlify<span class="o">(</span>clean_content<span class="o">)</span>
<span class="o">&gt;&gt;&gt;</span> open<span class="o">(</span><span class="s1">'elf.bin'</span>, <span class="s1">'wb'</span><span class="o">)</span>.write<span class="o">(</span>final<span class="o">)</span>
<span class="nv">$ </span>file elf.bin
elf.bin: ELF 64-bit LSB executable, x86-64, version 1 <span class="o">(</span>GNU/Linux<span class="o">)</span>, statically linked, no section header
<span class="nv">$ </span><span class="nb">chmod</span> +x elf.bin
<span class="nv">$ </span>./elf.bin 
usage : ./elf.bin &lt;mot de passe&gt;
<span class="nv">$ </span>./elf.bin <span class="nb">test
</span>Mauvais mot de passe
</code></pre></div></div>

<p>Nous avons maintenant le fichier caché dans le PNG, c’est un exécutable ELF qui prend en paramètre un mot de passe que nous devons sûrement trouver.</p>

<hr />
<h2 id="reverse">Reverse</h2>
<hr />

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>file elf.bin
elf.bin: ELF 64-bit LSB executable, x86-64, version 1 <span class="o">(</span>GNU/Linux<span class="o">)</span>, statically linked, no section header
<span class="nv">$ </span>r2 <span class="nt">-d</span> ./elf.bin
Process with PID 3036 started...
<span class="o">=</span> attach 3036 3036
bin.baddr 0x00400000
Using 0x400000
Warning: Cannot initialize section headers
Warning: Cannot initialize strings table
Warning: Cannot initialize dynamic strings
asm.bits 64
<span class="o">[</span>0x00447f10]&gt; afl
0x00447f10    3 50           entry0
0x00447f80   28 203          fcn.00447f80
0x00448125   15 107  -&gt; 230  fcn.00448125
0x00448190    3 38   -&gt; 40   fcn.00448190
</code></pre></div></div>

<p>On peut voir qu’il n’y a pas de <code class="highlighter-rouge">main()</code> dans notre ELF, sûrement parce que ce dernier a été packé, il faut trouver le packer utilisé.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>strings ./elf.bin | <span class="nb">grep </span>upx
<span class="nv">$Info</span>: This file is packed with the ALD executable packer http://upx.sf.net
</code></pre></div></div>

<p>On a donc à faire à un packer UPX, il faut réussir à le unpacker.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>upx <span class="nt">-d</span> ./elf.bin <span class="nt">-o</span> elf_unpacked.bin
<span class="c"># -d: decompress</span>
                       Ultimate Packer <span class="k">for </span>eXecutables
                          Copyright <span class="o">(</span>C<span class="o">)</span> 1996 - 2017
UPX 3.94        Markus Oberhumer, Laszlo Molnar &amp; John Reiser   May 12th 2017

        File size         Ratio      Format      Name
   <span class="nt">--------------------</span>   <span class="nt">------</span>   <span class="nt">-----------</span>   <span class="nt">-----------</span>
upx: ./elf.bin: NotPackedException: not packed by UPX

Unpacked 0 files.
</code></pre></div></div>

<p>Sauf que, <code class="highlighter-rouge">upx -d</code> n’y arrive pas. La décompression ne fonctionne pas.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>strings <span class="nt">-a</span> ./elf.bin | <span class="nb">grep</span> <span class="nt">-i</span> upx
<span class="nv">$Info</span>: This file is packed with the ALD executable packer http://upx.sf.net <span class="err">$</span>
</code></pre></div></div>

<p>Si nous revenons à cette étape, on peut remarquer que l’URL <code class="highlighter-rouge">http://upx.sf.net</code> correspond bien à une preuve d’UPX, mais il y a un problème sur <code class="highlighter-rouge">This file is packed with the ALD executable packer</code>. En effet, à la place de <code class="highlighter-rouge">ALD</code> on est censé avoir <code class="highlighter-rouge">UPX</code>. Également, notre <code class="highlighter-rouge">grep -i upx</code> est censé trouvé la chaîne <code class="highlighter-rouge">UPX!</code> plusieurs fois.</p>

<p>Après un peu de réflexion, peut-être que la chaîne <code class="highlighter-rouge">UPX</code> a été remplacé par <code class="highlighter-rouge">ALD</code> ?</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>strings <span class="nt">-a</span> ./elf.bin | <span class="nb">grep</span> <span class="nt">-i</span> ald
ALD! 
<span class="p">;</span>AlD
<span class="nv">$Info</span>: This file is packed with the ALD executable packer http://upx.sf.net <span class="err">$</span>
<span class="nv">$Id</span>: ALD 3.91 Copyright <span class="o">(</span>C<span class="o">)</span> 1996-2013 the ALD Team. All Rights Reserved. <span class="err">$</span>
ALD!
ALD!
</code></pre></div></div>

<p>Donc oui, tous les <code class="highlighter-rouge">UPX</code> ont été remplacé par des <code class="highlighter-rouge">ALD</code>. Nous devons donc faire l’inverse pour continuer.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>file elf.bin 
elf.bin: ELF 64-bit LSB executable, x86-64, version 1 <span class="o">(</span>GNU/Linux<span class="o">)</span>, statically linked, no section header
<span class="nv">$ </span><span class="nb">cat </span>elf.bin | <span class="nb">sed </span>s/ALD/UPX/g <span class="o">&gt;</span> elf_upx.bin
<span class="nv">$ </span>upx <span class="nt">-d</span> ./elf_upx.bin <span class="nt">-o</span> ./elf_upx_unpacked.bin
<span class="c"># -d: decompress</span>
                       Ultimate Packer <span class="k">for </span>eXecutables
                          Copyright <span class="o">(</span>C<span class="o">)</span> 1996 - 2017
UPX 3.94        Markus Oberhumer, Laszlo Molnar &amp; John Reiser   May 12th 2017

        File size         Ratio      Format      Name
   <span class="nt">--------------------</span>   <span class="nt">------</span>   <span class="nt">-----------</span>   <span class="nt">-----------</span>
    738384 &lt;-    297492   40.29%   linux/amd64   elf_upx_unpacked.bin

Unpacked 1 file.
<span class="nv">$ </span>file ./elf_upx_unpacked.bin 
./elf_upx_unpacked.bin: ELF 64-bit LSB executable, x86-64, version 1 <span class="o">(</span>GNU/Linux<span class="o">)</span>, statically linked, <span class="k">for </span>GNU/Linux 2.6.32, BuildID[sha1]<span class="o">=</span>280771ce69bcde48b3a996331811768a49c7c120, stripped
<span class="nv">$ </span><span class="nb">chmod</span> +x ./elf_upx_unpacked.bin
<span class="nv">$ </span>./elf_upx_unpacked.bin 
usage : ./elf_upx_unpacked.bin &lt;mot de passe&gt;
<span class="nv">$ </span>./elf_upx_unpacked.bin <span class="nb">test
</span>Mauvais mot de passe
</code></pre></div></div>

<p>Nous avons donc réussi à décompresser (unpacker) notre <code class="highlighter-rouge">elf.bin</code> en <code class="highlighter-rouge">elf_upx_unpacked</code>. Nous pouvons maintenant commencer une analyse classique du binaire.</p>

<pre><code class="language-assembly">$ r2 -d ./elf_upx_unpacked.bin
&gt; aaaa
&gt; afl
0x00400990    1 43           entry0
0x00400aae    9 114          sub.w0c__:_aae
0x00400b20    6 83           main
0x00401080   66 828          fcn.00401080
0x00407840    3 158          fcn.00407840
0x00408010   30 445  -&gt; 417  fcn.00408010
0x004440f0  296 11505 -&gt; 7157 sub.n_in_writable_segment_detected_f0
&gt; s main
&gt; pdf
/ (fcn) main 83
|   main (int arg2);
|           ; arg int arg2 @ rsi
|           ; DATA XREF from entry0 (0x4009ad)
|           0x00400b20      53             push rbx
|           0x00400b21      83ff01         cmp edi, 1                  ; 1
|       ,=&lt; 0x00400b24      7e1f           jle 0x400b45 # on s'assure d'un argv[1]
|       |   0x00400b26      488b7e08       mov rdi, qword [rsi + 8]    ; arg2
|       |   0x00400b2a      e87fffffff     call sub.w0c__:_aae # appel de fonction
|       |   0x00400b2f      89c3           mov ebx, eax # on récupére une valeur de
|       |   0x00400b31      85c0           test eax, eax # retour qui va nous dire si mdp
|      ,==&lt; 0x00400b33      752b           jne 0x400b60 # OK ou NOT OK
|      ||   0x00400b35      488d3d238d08.  lea rdi, qword str.Mauvais_mot_de_passe
|      ||   0x00400b3c      e8cf740000     call fcn.00408010 # NOT OK
|      ||   ; CODE XREFS from main (0x400b5e, 0x400b71)
|    ..---&gt; 0x00400b41      89d8           mov eax, ebx
|    ::||   0x00400b43      5b             pop rbx
|    ::||   0x00400b44      c3             ret
|    ::||   ; CODE XREF from main (0x400b24) # si pas d'argument
|    ::|`-&gt; 0x00400b45      488b36         mov rsi, qword [rsi]        ; arg2
|    ::|    0x00400b48      488d3df58c08.  lea rdi, qword str.usage_:__s__mot_de_passe
|    ::|    0x00400b4f      b800000000     mov eax, 0
|    ::|    0x00400b54      e8e76c0000     call fcn.00407840 # OK
|    ::|    0x00400b59      bb02000000     mov ebx, 2
|    `====&lt; 0x00400b5e      ebe1           jmp 0x400b41
|     :|    ; CODE XREF from main (0x400b33)
|     :`--&gt; 0x00400b60      488d3d118d08.  lea rdi, qword str.Bravo___Vous_pouvez_utiliser_ce_mot_passe_pour_la_suite
|     :     0x00400b67      e8a4740000     call fcn.00408010
|     :     0x00400b6c      bb00000000     mov ebx, 0
\     `===&lt; 0x00400b71      ebce           jmp 0x400b41
</code></pre>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0x00400b20      53             push rbx
0x00400b21      83ff01         cmp edi, 1
0x00400b24      7e1f           jle 0x400b45 <span class="c"># on s'assure d'un argv[1]</span>
</code></pre></div></div>

<p>Rapidement, on peut dire que notre programme s’assure de la présence d’un <code class="highlighter-rouge">argv[1]</code>, si <code class="highlighter-rouge">rdi &lt;= 1</code> alors on envoi le message d’erreur <code class="highlighter-rouge">usage: ./elf_upx_unpacked.bin &lt;mot de passe&gt;</code> avec un <code class="highlighter-rouge">jle 0x400b45</code>. Le registre <code class="highlighter-rouge">rdi</code> contient le nombre d’arguments du programme. Lorsque <code class="highlighter-rouge">rdi = 0x00000001</code> alors message d’erreur, lorsque <code class="highlighter-rouge">rdi = 0x00000002</code> on continu l’exécution.</p>

<blockquote>
  <p><code class="highlighter-rouge">rdi</code> et <code class="highlighter-rouge">edi</code> sont la même entité.</p>
</blockquote>

<pre><code class="language-assembly">0x00400b26      488b7e08       mov rdi, qword [rsi + 8]    ; arg2
0x00400b2a      e87fffffff     call sub.w0c__:_aae
</code></pre>

<p>Ensuite, on se charge de récupérer le <code class="highlighter-rouge">argv[1]</code> et d’appeler la fonction <code class="highlighter-rouge">sub.w0c__:_aae</code> juste derrière.</p>

<pre><code class="language-assembly">0x00400b2a      e87fffffff     call sub.w0c__:_aae
0x00400b2f      89c3           mov ebx, eax 
0x00400b31      85c0           test eax, eax # test de la valeur de retour de la fonction
0x00400b33      752b           jne 0x400b60 # prise de décision succès ? ou échec ?
0x00400b35      488d3d238d08.  lea rdi, qword str.Mauvais_mot_de_passe # échec
0x00400b3c      e8cf740000     call fcn.00408010
0x00400b41      89d8           mov eax, ebx
0x00400b43      5b             pop rbx
0x00400b44      c3             ret
...
0x00400b60      488d3d118d08.  lea rdi, qword str.Bravo___Vous_pouvez_utiliser_ce_mot_passe_pour_la_suite # succès
0x00400b67      e8a4740000     call fcn.00408010
0x00400b6c      bb00000000     mov ebx, 0
0x00400b71      ebce           jmp 0x400b41
</code></pre>

<p>On peut voir que cette fonction est très importante, en effet, c’est elle qui décide quel message afficher. Lors d’un succès, on affiche <code class="highlighter-rouge">Vous pouvez utiliser ce mot de passe pour la suite</code> et lors d’un échec, on affiche <code class="highlighter-rouge">Mauvais mot de passe</code>.</p>

<p>Nous allons donc passer à l’analyse de la fonction <code class="highlighter-rouge">sub.w0c__:_aae</code>.</p>

<pre><code class="language-assembly">&gt; s sub.w0c__:_aae
&gt; pdf
/ (fcn) sub.w0c__:_aae 114
|   sub.w0c__:_aae (int arg1);
|           ; arg int arg1 @ rdi
|           ; CALL XREF from main (0x400b2a)
|           0x00400aae      4889fe         mov rsi, rdi                ; arg1
|           0x00400ab1      b800000000     mov eax, 0
|           0x00400ab6      48c7c1ffffff.  mov rcx, -1
|           0x00400abd      f2ae           repne scasb al, byte [rdi]
|           0x00400abf      b800000000     mov eax, 0
|           0x00400ac4      4883f9e0       cmp rcx, -0x20
|       ,=&lt; 0x00400ac8      7402           je 0x400acc
|       |   ; CODE XREF from sub.w0c__:_aae (0x400b1e)
|      .--&gt; 0x00400aca      f3c3           ret
|      :|   ; CODE XREF from sub.w0c__:_aae (0x400ac8)
|      :`-&gt; 0x00400acc      0fb60e         movzx ecx, byte [rsi]
|      :    0x00400acf      84c9           test cl, cl
|      :,=&lt; 0x00400ad1      7446           je 0x400b19
|      :|   0x00400ad3      488d15e68d08.  lea rdx, qword str.w0c__:   ; 0x4898c0 ; "w0c&amp;]:\x0e;\rM*\x1f.\x1f-O(Q7z\x14v x\x0f!M!l\x11"
|      :|   0x00400ada      488d7e01       lea rdi, qword [rsi + 1]    ; r11
|      :|   0x00400ade      b801000000     mov eax, 1
|      :|   0x00400ae3      be33000000     mov esi, 0x33               ; '3' ; 51
|      :|   0x00400ae8      41b900000000   mov r9d, 0
|     ,===&lt; 0x00400aee      eb16           jmp 0x400b06
|     |:|   ; CODE XREFS from sub.w0c__:_aae (0x400b0b, 0x400b15)
|   ..----&gt; 0x00400af0      410fb6c0       movzx eax, r8b
|   ::|:|   0x00400af4      0fb632         movzx esi, byte [rdx]
|   ::|:|   0x00400af7      0fb60f         movzx ecx, byte [rdi]
|   ::|:|   0x00400afa      4883c201       add rdx, 1
|   ::|:|   0x00400afe      4883c701       add rdi, 1
|   ::|:|   0x00400b02      84c9           test cl, cl
|  ,======&lt; 0x00400b04      7411           je 0x400b17
|  |::|:|   ; CODE XREF from sub.w0c__:_aae (0x400aee)
|  |::`---&gt; 0x00400b06      4589c8         mov r8d, r9d
|  |:: :|   0x00400b09      85c0           test eax, eax
|  |`=====&lt; 0x00400b0b      74e3           je 0x400af0
|  | : :|   0x00400b0d      31f1           xor ecx, esi
|  | : :|   0x00400b0f      3a0a           cmp cl, byte [rdx]
|  | : :|   0x00400b11      410f94c0       sete r8b
|  | `====&lt; 0x00400b15      ebd9           jmp 0x400af0
|  `------&gt; 0x00400b17      f3c3           ret
|      :|   ; CODE XREF from sub.w0c__:_aae (0x400ad1)
|      :`-&gt; 0x00400b19      b801000000     mov eax, 1
\      `==&lt; 0x00400b1e      ebaa           jmp 0x400aca
</code></pre>

<pre><code class="language-assembly">0x00400aae      4889fe         mov rsi, rdi
0x00400ab1      b800000000     mov eax, 0
0x00400ab6      48c7c1ffffff.  mov rcx, -1
0x00400abd      f2ae           repne scasb al, byte [rdi]
0x00400abf      b800000000     mov eax, 0
0x00400ac4      4883f9e0       cmp rcx, -0x20
0x00400ac8      7402           je 0x400acc
0x00400aca      f3c3           ret
</code></pre>

<p>Les premières instructions servent sûrement à gérer l’argument de la fonction (qui est notre mot de passe). Après cela, on compare <code class="highlighter-rouge">rcx</code> à <code class="highlighter-rouge">0x20</code>. Si cette comparaison et vraie, alors on continue le l’exécution (on évite le <code class="highlighter-rouge">ret</code>). Sinon on va sur le <code class="highlighter-rouge">ret</code> qui va nous faire quitter la fonction avec un <code class="highlighter-rouge">eax</code> à 0, ce qui va nous afficher <code class="highlighter-rouge">Mauvais mot de passe</code>.</p>

<p>Pour faire simple, le <code class="highlighter-rouge">cmp rcx, -0x20</code> va s’assurer que le <code class="highlighter-rouge">argv[1]</code> fourni au programme va avoir une taille de 32 caractères.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center"><code class="highlighter-rouge">argv[1]</code></th>
      <th style="text-align: center"><code class="highlighter-rouge">rcx</code></th>
      <th style="text-align: center"><code class="highlighter-rouge">-0x20</code></th>
      <th style="text-align: center"><code class="highlighter-rouge">cmp rcx, -0x20</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">AAAA</code></td>
      <td style="text-align: center"><code class="highlighter-rouge">0xfffffffffffffffa</code></td>
      <td style="text-align: center"><code class="highlighter-rouge">0xffffffffffffffdf</code></td>
      <td style="text-align: center">NOT EQUAL</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">AAAAAA</code></td>
      <td style="text-align: center"><code class="highlighter-rouge">0xfffffffffffffff8</code></td>
      <td style="text-align: center"><code class="highlighter-rouge">0xffffffffffffffdf</code></td>
      <td style="text-align: center">NOT EQUAL</td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="highlighter-rouge">A</code>*32</td>
      <td style="text-align: center"><code class="highlighter-rouge">0xffffffffffffffdf</code></td>
      <td style="text-align: center"><code class="highlighter-rouge">0xffffffffffffffdf</code></td>
      <td style="text-align: center"><strong>EQUAL</strong></td>
    </tr>
  </tbody>
</table>

<p>Nous devons donc avoir un <code class="highlighter-rouge">argv[1]</code> de taille 0x20, soit 32 caractères pour respecter cette condition.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> ood AAAA
<span class="o">&gt;</span> db 0x00400ac8
<span class="o">&gt;</span> dc
hit breakpoint at: 400ac8
<span class="o">&gt;</span> dr rip
0x00400ac8
<span class="o">&gt;</span> dr <span class="nv">rip</span><span class="o">=</span>0x00400acc
0x00400ac8 -&gt;0x00400acc
</code></pre></div></div>

<p>Normalement, nous devons fournir un argument de taille 32 octets, mais nous allons juste donner <code class="highlighter-rouge">ABCD</code> au programme, placer un breakpoint sur <code class="highlighter-rouge">je 0x400acc</code> afin de modifier la valeur de <code class="highlighter-rouge">rip</code> pour passer outre la condition des 32 caractères.</p>

<pre><code class="language-assembly">0x00400acc      0fb60e         movzx ecx, byte [rsi]
0x00400acf      84c9           test cl, cl
0x00400ad1      7446           je 0x400b19
0x00400ad3      488d15e68d08.  lea rdx, qword str.w0c__:   ; 0x4898c0 ; "w0c&amp;]:\x0e;\rM*\x1f.\x1f-O(Q7z\x14v x\x0f!M!l\x11"
0x00400ada      488d7e01       lea rdi, qword [rsi + 1]
0x00400ade      b801000000     mov eax, 1
0x00400ae3      be33000000     mov esi, 0x33               ; '3' ; 51
0x00400ae8      41b900000000   mov r9d, 0
0x00400aee      eb16           jmp 0x400b06
</code></pre>

<p>Dans ce bloc on peut remarquer que l’on va manipuler la chaîne <code class="highlighter-rouge">w0c&amp;]:\x0e;\rM*\x1f.\x1f-O(Q7z\x14v x\x0f!M!l\x11</code>.</p>

<pre><code class="language-assembly">0x00400af0      410fb6c0       movzx eax, r8b
0x00400af4      0fb632         movzx esi, byte [rdx]
0x00400af7      0fb60f         movzx ecx, byte [rdi]
0x00400afa      4883c201       add rdx, 1
0x00400afe      4883c701       add rdi, 1
0x00400b02      84c9           test cl, cl
0x00400b04      7411           je 0x400b17
0x00400b06      4589c8         mov r8d, r9d
0x00400b09      85c0           test eax, eax
0x00400b0b      74e3           je 0x400af0
0x00400b0d      31f1           xor ecx, esi
0x00400b0f      3a0a           cmp cl, byte [rdx]
0x00400b11      410f94c0       sete r8b
0x00400b15      ebd9           jmp 0x400af0
0x00400b17      f3c3           ret
0x00400b19      b801000000     mov eax, 1
0x00400b1e      ebaa           jmp 0x400aca
</code></pre>

<p>Dans la suite on observe une ligne intéressante <code class="highlighter-rouge">xor ecx, esi</code>.</p>

<pre><code class="language-assembly">0x00400b0d      31f1           xor ecx, esi
0x00400b0f      3a0a           cmp cl, byte [rdx]
</code></pre>

<p>On réalise un <strong>XOR</strong> puis un comparaison, c’est sûrement une partie importante du prgramme. Pour ce xor on utilise <code class="highlighter-rouge">ecx</code> et <code class="highlighter-rouge">esi</code>.</p>

<pre><code class="language-assembly">0x00400af4      0fb632         movzx esi, byte [rdx]
0x00400af7      0fb60f         movzx ecx, byte [rdi]
0x00400afa      4883c201       add rdx, 1
0x00400afe      4883c701       add rdi, 1
</code></pre>

<p>Après pas mal de debug sur le programme sur les instructions importantes, on comprend comment fonctionne la vérification du mot de passe.</p>

<p>On peut retrouver ce dernier avec le script suivant :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span>
<span class="n">string</span> <span class="o">=</span> <span class="s">'3w0c&amp;]:</span><span class="se">\x0e</span><span class="s">;</span><span class="se">\r</span><span class="s">M*</span><span class="se">\x1f</span><span class="s">.</span><span class="se">\x1f</span><span class="s">-O(Q7z</span><span class="se">\x14</span><span class="s">v x</span><span class="se">\x0f</span><span class="s">!M!l</span><span class="se">\x11</span><span class="s">'</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)):</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">string</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="n">string</span><span class="p">[</span><span class="n">i</span><span class="p">])),</span> <span class="n">end</span><span class="o">=</span><span class="s">''</span><span class="p">)</span>
<span class="k">print</span><span class="p">()</span>
<span class="c1"># DGSE{g456@g5112bgyfMnbVXw.llM}
</span></code></pre></div></div>

<hr />
<h2 id="zip-1">ZIP</h2>
<hr />

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>unzip <span class="nt">-d</span> suite_files/ <span class="nt">-P</span> <span class="s2">"DGSE{g456@g5112bgyfMnbVXw.llM}"</span> suite.zip 
Archive:  suite.zip
  inflating: suite_files/suite.txt

<span class="nv">$ </span><span class="nb">cat </span>suite_files/suite.txt 
Suite <span class="nb">du </span>challenge Richelieu :

ssh defi1.challengecybersec.fr <span class="nt">-l</span> defi1 <span class="nt">-p</span> 2222

mot de passe : DGSE<span class="o">{</span>2f77c517b06f1cd1ce864f79f41f25ca8874413c8c1204f7ec9c6728c87f270a<span class="o">}</span>
</code></pre></div></div>

<p>C’est ici que le challenge se termine pour moi.</p>

</div>


<div class="related">
  <h2>Related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/linux/2019/12/23/ctf-santhacklaus/">
            santhacklaus ctf v2
            <small>23 Dec 2019</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/ctf/2019/12/05/sigsegv2/">
            sigsegv2
            <small>05 Dec 2019</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/ctf/2019/07/29/linux/">
            linux
            <small>29 Jul 2019</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='/public/js/script.js'></script>
  </body>
</html>
